"use strict";(globalThis.webpackChunkvknext=globalThis.webpackChunkvknext||[]).push([[1110],{36072:(t,e,n)=>{n.d(e,{A:()=>i});var a=n(65578);const i=()=>(0,a.A)("uiActionsMenu")},67078:(t,e,n)=>{n.d(e,{A:()=>l});var a=n(74848),i=n(3068),o=n(75511);const s=document.createElement("div");s.className=o.A.Snackbars;const l=async t=>{const e=(await Promise.all([n.e(2551),n.e(7983),n.e(2020),n.e(3543),n.e(7759)]).then(n.bind(n,28582))).default;document.body.contains(s)||document.body.appendChild(s);const o=document.createElement("div");s.appendChild(o);const{unmount:l}=await(0,i.A)({root:o,content:(0,a.jsx)(e,{onClose:()=>{l(),o.remove(),0===s.children.length&&s.remove()},...t}),disableParentTransformForPositionFixedElements:!0,noStyling:!0})}},78105:(t,e,n)=>{n.d(e,{A:()=>p});var a=n(82050),i=n(60962),o=n(14943),s=n(67992),l=n(4107);const r=new s.A,c=t=>t.replace("audio_playlist","").replace("/","_");let d=!1;const u=async()=>{if(d)return;d=!0;const t=await(0,l.A)();t.onLocationChange((async()=>{const e=t.objLoc.z;e&&e.startsWith("audio_playlist")&&(await(0,a.A)(1e3),await(0,o.A)(),(t=>{const e=c(t);for(const t of r.listeners)t(e)})(e))}))},p=t=>{const e=r.addListener(t);return(0,i.A)((()=>{const e=new URLSearchParams(window.location.search).get("z");e&&e.startsWith("audio_playlist")&&requestAnimationFrame((()=>t(c(e)))),u()})),e}},88213:(t,e,n)=>{n.d(e,{A:()=>u});var a=n(82050),i=n(60962),o=n(14943),s=n(67992),l=n(4107);const r=new s.A;let c=!1;const d=async()=>{if(c)return;c=!0;(await(0,l.A)()).onLocationChange((async t=>{(t.startsWith("music/album")||t.startsWith("music/playlist"))&&(await(0,a.A)(1e3),await(0,o.A)(),(()=>{for(const t of r.listeners)t()})())}))},u=t=>{const e=r.addListener(t);return(0,i.A)((()=>{(window.location.pathname.startsWith("/music/album")||window.location.pathname.startsWith("/music/playlist"))&&requestAnimationFrame((()=>t())),d()})),e}},5024:(t,e,n)=>{n.a(t,(async(t,a)=>{try{n.d(e,{A:()=>w,u:()=>y});var i=n(97992),o=n(63499),s=n(88908),l=n(93819),r=n(67078),c=n(43024),d=n(88298),u=n(84896),p=n(14692),m=n(15991),_=t([d]);d=(_.then?(await _)():_)[0];const y=async({event:t,audio:e,lastModified:n,signal:a,playlist:i,audioIndex:s})=>{if(a.aborted)return null;if(!e.url)return null;try{const l=await(0,p.G)({audio:e,playlist:i,signal:a,playlistEvent:t}),r=[];return c.default.getValue("numTracksInPlaylist")&&r.push(`${s}. `),r.push(`${e.artist} - ${e.title}`),e.subtitle&&r.push(` (${e.subtitle})`),r.push(".mp3"),t&&(t.progress=(t.progress||0)+1),{name:(0,o.A)(r.join("")),lastModified:e.date?new Date(1e3*e.date):n,input:l}}catch(t){return console.error("error download audio",t),null}},w=async t=>{const[e,a,o]=t.split("_"),c=await l.A;await(0,r.A)({text:c.use("vkcom_downloading")});const p=await(0,m.A)({owner_id:parseInt(e),playlist_id:parseInt(a),access_key:o,fixAudioUrl:!0});if(!p)return void await(0,r.A)({text:"Playlist not found",type:"error"});if(p?.error?.error_msg)return void await(0,r.A)({text:p.error.error_msg,type:"error"});if(!p.audios?.length)return void await(0,r.A)({text:c.use("vkcom_playlist_is_empty"),type:"error"});const _=new AbortController,{signal:w}=_,A=(p.main_artists||[]).map((t=>t.name)),h=[];A.length&&h.push(`${A.join(", ")} - `),p.title?h.push(p.title):h.push("playlist");const f=new d.j({icon:"playlist_music",title:(0,s.A)(`${h.join("")}.zip`),onCancel:()=>_.abort(),progress:0,progressTotal:p.audios.length,iconUrl:(0,u.Z)(p)||void 0}),v=d.N.addEvent(f),k=new Date,g=[];let b=1;for(const t of(0,i.A)(p.audios,8)){if(w.aborted)return;for(const e of t)g.push(y({event:f,audio:e,lastModified:k,signal:w,audioIndex:b++,playlist:p}));await Promise.all(g)}f.clearIndicator(),f.indicator=c.use("vkcom_processing");const x=(await Promise.all(g)).filter(Boolean);if(!w.aborted){if(1===x.length){const t=x[0],e=URL.createObjectURL(t.input);await d.N.downloadFileFromLink(e,t.name),URL.revokeObjectURL(e)}else{f.indicator=c.use("vkcom_archivation");const{downloadZip:t}=await n.e(1941).then(n.bind(n,71941)),e=await t(x).blob(),a=URL.createObjectURL(e);await d.N.downloadFileFromLink(a,f.title),URL.revokeObjectURL(a)}v(),f.stopSpeed()}};a()}catch(t){a(t)}}))},48229:(t,e,n)=>{n.a(t,(async(t,a)=>{try{n.d(e,{A:()=>u});var i=n(88908),o=n(93819),s=n(67078),l=(n(43024),n(88298)),r=n(84896),c=(n(14692),n(15991)),d=t([l]);l=(d.then?(await d)():d)[0];const u=async t=>{const[e,n,a]=t.split("_"),d=await(0,c.A)({owner_id:parseInt(e),playlist_id:parseInt(n),access_key:a,fixAudioUrl:!1}),u=await o.A;if(!d)return void await(0,s.A)({text:"Playlist not found",type:"error"});const p=(0,r.Z)(d);if(!p)return void await(0,s.A)({text:u.use("vkcom_playlist_cover_is_none"),type:"error"});const m=(d.main_artists||[]).map((t=>t.name)),_=[];m.length&&_.push(`${m.join(", ")} - `),d.title?_.push(d.title):_.push("playlist"),l.N.downloadFileFromLink(p,(0,i.A)(_.join(""))+".jpg")};a()}catch(t){a(t)}}))},95963:(t,e,n)=>{n.a(t,(async(t,a)=>{try{n.r(e);var i=n(74848),o=n(53644),s=n(82050),l=n(94229),r=n(98570),c=n(36072),d=n(93819),u=n(67078),p=n(78105),m=n(88213),_=n(3068),y=n(12550),w=n(5024),A=n(48229),h=n(70459),f=t([w,A]);[w,A]=f.then?(await f)():f;const v=async t=>{if((0,r.A)()?.vms_installed)return;if(!t.classList.contains("audio_pl_snippet__action_btn"))return;const e=t.querySelector(".ui_actions_menu");if(!e||e.vkn_down_inj)return;e.vkn_down_inj=!0;const n=await d.A,a=document.createElement("div");a.className="ui_actions_menu_item",a.innerText=n.use("global_download"),a.addEventListener("click",(async()=>{const e=t.closest(".audio_pl_snippet2");e?.dataset?.playlistId?await(0,w.A)(e.dataset.playlistId.replace("playlist_","")):await(0,u.A)({type:"error",text:"playlist id not found"})}));const i=document.createElement("div");i.className="ui_actions_menu_item",i.innerText=n.use("vkcom_download_cover"),i.addEventListener("click",(async()=>{const e=t.closest(".audio_pl_snippet2");e?.dataset?.playlistId?await(0,A.A)(e.dataset.playlistId.replace("playlist_","")):await(0,u.A)({type:"error",text:"playlist id not found"})})),e.prepend(a,i)},k=async()=>{const t=await(0,c.A)(),e=t.show;t.show=function(...t){try{v(t[0])}catch(t){console.error(t)}return Reflect.apply(e,this,t)}},g=async()=>{if((0,r.A)()?.vms_installed)return;const t=document.querySelector(".AudioPlaylistSnippet");if(!t)return;const{playlistId:e}=t.dataset;if(!e)return;const n=t.querySelector(".AudioPlaylistSnippet__header");if(!n||n.vkn_down_inj)return;n.vkn_down_inj=!0;const a=document.createElement("div");a.className=h.A.AudioPlaylistSnippet__actions;const i=document.createElement("button");i.className=h.A.AudioPlaylistSnippet__actionButton,i.addEventListener("click",(()=>{(0,w.A)(e.replace("playlist_","")).catch(console.error)}));const s=document.createElement("div");s.className=h.A.ActionButton__icon,s.appendChild((0,o.A)(l.A));const c=await d.A,u=document.createElement("span");u.className=h.A.ActionButton__text,u.innerText=c.use("vkcom_download_playlist"),i.append(s,u),a.appendChild(i),n.appendChild(a)},b=t=>{const e=t.closest(".AudioPlaylistSnippet");if(!e?.dataset?.playlistId)return null;let[n,a,i]=e.dataset.playlistId.replace("playlist_","").split("_");!i&&window.location.pathname.startsWith(`/music/playlist/${n}_${a}_`)&&(i=window.location.pathname.split("/music/playlist/")[1].split("_")[2]);const o=[n,a];return i&&o.push(i),o.join("_")},x=async()=>{if((0,r.A)()?.vms_installed)return;const t=document.querySelector(".AudioPlaylistSnippet__actionButton .ActionsMenu__inner");if(!t)return void g();if(t.vkn_down_inj)return;t.vkn_down_inj=!0;const e=await d.A,n=document.createElement("button");n.className="ActionsMenu__item",n.innerText=e.use("global_download"),n.addEventListener("click",(async()=>{const e=b(t);e?await(0,w.A)(e):await(0,u.A)({type:"error",text:"playlist id not found"})})),t.prepend(n)},j=async(t=0)=>{if((0,r.A)()?.vms_installed)return;if(t>10)throw new Error("[VK Next/audioPlaylist] Failed to inject");const e=document.getElementById("spa_root");if(!e)return;if(e.querySelector('[class*="Skeleton__skeleton"]'))return await(0,s.A)(1e3),j(t+1);const a=e.querySelector('[class*="AudioListHeader__actions--"]');if(!a)return;if(a.vkn_down_inj)return;a.vkn_down_inj=!0;const{default:o}=await Promise.all([n.e(2551),n.e(7983),n.e(2020),n.e(3947)]).then(n.bind(n,74682)),l=document.createElement("div");a.appendChild(l),await(0,_.A)({root:l,disableConfig:!0,content:(0,i.jsx)(o,{})})},S=async(t,e=0)=>{if(!(0,r.A)()?.vms_installed){if(document.querySelector('.vkui__root .vkuiFlex [class*="Skeleton__skeleton"]'))return await(0,s.A)(1e3),S(t,e+1);for(const e of document.querySelectorAll('[class*="AudioListModalHeader__actions--"]')){if(!e)return;if(e.vkn_down_inj)return;e.vkn_down_inj=!0;const a=e.querySelector(".vkuiFlex"),{default:o}=await Promise.all([n.e(2551),n.e(7983),n.e(2020),n.e(3947)]).then(n.bind(n,74682)),s=document.createElement("div");(a||e).appendChild(s),await(0,_.A)({root:s,disableConfig:!0,content:(0,i.jsx)(o,{playlistFullId:t,isModal:!0})})}}},E=()=>{k().catch(console.error),(0,m.A)((()=>{x().catch(console.error),j().catch(console.error)})),(0,p.A)(S)};(0,y.A)()&&E(),a()}catch(t){a(t)}}))},53644:(t,e,n)=>{n.d(e,{A:()=>i});let a=0;const i=t=>{const e=!!document.importNode;let n=(new DOMParser).parseFromString(t,"image/svg+xml").documentElement;e&&(n=document.importNode(n,!0));for(const t of n.querySelectorAll("title,desc"))t.remove();for(const t of n.querySelectorAll("[id]")){if(!t.id)continue;const e="vknext_icon-"+a++;let i=!1;for(const a of n.querySelectorAll(`[fill="url(#${t.id})"]`))a.setAttribute("fill",`url(#${e})`),i=!0;i&&(t.id=e)}return n}},97992:(t,e,n)=>{n.d(e,{A:()=>a});const a=(t,e=100)=>{const n=[...t],a=[];for(;n.length;)a.push(n.splice(0,e||n.length));return a}},63499:(t,e,n)=>{n.d(e,{A:()=>i});const a=/\/|\\|:|\*|\?|"|<|>|\||\+|%|@|@\\0/g;function i(t){return t.replaceAll(a,"_")}},75511:(t,e,n)=>{n.d(e,{A:()=>a});const a={Snackbars:"fuEF5ymRhcBAxInE",BaseSnackbar:"Fu47p889xWCKEooV"}},94229:(t,e,n)=>{n.d(e,{A:()=>a});const a='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M12.002 2a.9.9 0 0 1 .9.9v11.002l4.562-4.631a.9.9 0 1 1 1.283 1.263l-6.104 6.195a.9.9 0 0 1-1.284-.001l-6.09-6.206a.9.9 0 1 1 1.286-1.26l4.547 4.633V2.9a.9.9 0 0 1 .9-.9Zm-8 18.1a.9.9 0 0 1 .9-.9h14.2a.9.9 0 1 1 0 1.8h-14.2a.9.9 0 0 1-.9-.9Z" clip-rule="evenodd"/></svg>\n'}}]);