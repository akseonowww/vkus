"use strict";(globalThis.webpackChunkvknext=globalThis.webpackChunkvknext||[]).push([[4412],{9794:(t,e,r)=>{r.a(t,(async(t,s)=>{try{r.d(e,{A:()=>u});var n=r(387),i=r(26555),a=r(52352),o=r(93819);const t=await o.A;let l=0;class c{id;listeners=new Map;icon;title;subtitle;progressTotal;progress;onCancel;timeLeft;indicator;progressText;iconUrl;_bytesPerSecond;startTime;interval;constructor(t){const e=t;this.id=`${l++}_${(0,n.A)()}`;const r=this.notifyListeners.bind(this),s=["title","subtitle","progress","progressTotal","onCancel","icon","timeLeft","indicator","progressText","iconUrl"];for(const t of s)Object.defineProperty(this,t,{get:()=>e[t],set(s){e[t]=s,r(t,s)}});this._bytesPerSecond=0,this.startTime=Date.now()}notifyListeners=(t,e)=>{if(this.listeners.has(t))for(const r of this.listeners.get(t))r(e)};addChangePropertyListener=(t,e)=>{const r=this.listeners.get(t)||new Set;return r.add(e),this.listeners.set(t,r),()=>{r.delete(e),this.listeners.set(t,r)}};updateBytesPerSecond=t=>{this._bytesPerSecond+=t};updateTimeLeft=(e,r=this.progress,s=this.progressTotal,n=0)=>{if(void 0===r)return;n||(n=(0,a.A)(r,0,s||100)),this.updateBytesPerSecond(e);const i=Date.now()-this.startTime;let o=`0${t.use("vkcom_time_s")}`;n<100&&(o=new Date(100*i/n-i),o=[[o.getUTCFullYear()-1970,t.use("vkcom_time_y")],[o.getUTCMonth(),t.use("vkcom_time_mo")],[o.getUTCDate()-1,t.use("vkcom_time_d")],[o.getUTCHours(),t.use("vkcom_time_h")],[o.getUTCMinutes(),t.use("vkcom_time_m")],[o.getUTCSeconds(),t.use("vkcom_time_s")]].filter((t=>!!t[0])).slice(0,2).map((t=>t.join(""))).join(" ")||`0${t.use("vkcom_time_s")}`),this.timeLeft=o};startSpeed(){return this.stopSpeed(),this.indicator=(0,i.A)(0),this.interval=setInterval((()=>{this.indicator=(0,i.A)(this._bytesPerSecond)+"/s",this._bytesPerSecond=0}),1e3),()=>{this.stopSpeed()}}clearIndicator(){this.stopSpeed(),this.progress=this.progressTotal=this.timeLeft=this.indicator=void 0}stopSpeed(){this.interval&&(clearInterval(this.interval),delete this.interval)}}const u=c;s()}catch(t){s(t)}}),1)},4336:(t,e,r)=>{r.d(e,{A:()=>o});var s=r(74848),n=r(1145),i=r(3068),a=r(70459);const o=new class{wrapper=document.createElement("li");_unsafeUnmount=null;listeners=[];events=[];getEvents(){return[...this.events]}addEvent(t){return this.events.push(t),this.onEventsChange(),()=>{this.events=this.events.filter((e=>e!==t)),this.onEventsChange()}}removeEvent(t){this.events=this.events.filter((e=>e.id!==t)),this.onEventsChange()}addEventsChangeListener(t){return this.listeners.push(t),()=>{this.listeners=this.listeners.filter((e=>e!==t))}}onEventsChange(){for(const t of this.listeners)t(this.getEvents());this.events.length>=1?(0,n.A)((()=>this.renderManager())):this.removeManager()}async downloadFileFromLink(t,e){const s=(await r.e(7746).then(r.bind(r,37746))).default;await s(t,e)}async renderManager(){if(this.wrapper.parentElement)return;this.wrapper.className="HeaderNav__item";const t=document.querySelector(".HeaderNav,#top_nav");if(!t)return void console.error("HeaderNav not found");const e=t.querySelector(".HeaderNav__audio");e?(e.insertAdjacentElement("afterend",this.wrapper),this.wrapper.style.order=""):(t.appendChild(this.wrapper),this.wrapper.style.order="-1"),this._unsafeUnmount&&this._unsafeUnmount();const{default:n}=await Promise.all([r.e(2551),r.e(7983),r.e(2020),r.e(3543),r.e(9452),r.e(2477),r.e(6052)]).then(r.bind(r,86052)),{unmount:o}=await(0,i.A)({root:this.wrapper,content:(0,s.jsx)(n,{}),disableParentTransformForPositionFixedElements:!0,disablePortal:!0,wrapperProps:{className:a.A.DownloadManagerPopup}});this._unsafeUnmount=o}removeManager(){0===this.events.length&&(this.wrapper.parentElement&&this.wrapper.remove(),this._unsafeUnmount&&(this._unsafeUnmount(),this._unsafeUnmount=null))}}},88298:(t,e,r)=>{r.a(t,(async(t,s)=>{try{r.d(e,{N:()=>i.A,j:()=>n.A});var n=r(9794),i=r(4336),a=t([n]);n=(a.then?(await a)():a)[0],s()}catch(t){s(t)}}))},42791:(t,e,r)=>{r.d(e,{A:()=>s});const s=t=>{if(t.album&&!Array.isArray(t.album)){const e=t.album;return e?.access_key?[e.owner_id,e.id,e.access_key]:[e.owner_id,e.id]}return t.album?t.album:[]}},84896:(t,e,r)=>{r.d(e,{A:()=>a,Z:()=>i});var s=r(42791);const n=new Map,i=t=>{if(t.coverUrl_l)return t.coverUrl_l;if(t.coverUrl_m)return t.coverUrl_m;if(t.coverUrl_s)return t.coverUrl_s;if(Array.isArray(t.album))return null;const e=t.album?.thumb||t.photo;if(!e)return null;let r=0,s=null;for(const t of Object.keys(e)){const[,n]=t.split("_");n&&(Number(n)>r&&(r=+n,s=e[t]))}return s},a=t=>{const e=(t=>{const[e,r]=(0,s.A)(t);return[e,r].join("_")})(t);if(n.has(e))return n.get(e);const r=i(t);if(!r)return null;const a=fetch(r).then((t=>t.arrayBuffer()));return n.set(e,a),a}},14692:(t,e,r)=>{r.d(e,{G:()=>_});var s=r(57054),n=r(8596);const i=t=>new Promise(((e,r)=>{const s=new FileReader;s.onload=t=>{if(t.target&&t.target.result instanceof ArrayBuffer){const r=t.target.result,s=new Uint8Array(r);e(s)}else r(new Error("Invalid result"))},s.onerror=t=>{r(t)},s.readAsArrayBuffer(t)}));var a=r(93819),o=r(67078),l=r(2921),c=r(43024);const u=t=>{if(!t)return"";const e=new Date(1e3*t);return`${String(e.getUTCDate()).padStart(2,"0")}${String(e.getUTCMonth()+1).padStart(2,"0")}`},d=t=>`${Math.round(100*t)}%`;var p=r(42791),h=r(84896),m=r(15991);const _=async({audio:t,playlist:e,signal:r,event:_})=>{if(!t.url)throw await(0,o.A)({text:"Audio URL not found",type:"error"}),console.error("Audio URL not found",t),new Error("Audio URL not found");const f=await(0,s.H)({url:t.url,onProgress(t){_&&(_.progressText=d(t))},forceHls:"hlsjs"===c.default.getValue("audioConvertMethod")});if(!c.default.getValue("id3"))return f;if(!e){const[r,s,n]=(0,p.A)(t);r&&s&&(e=await(0,m.A)({owner_id:r,playlist_id:s,access_key:n}))}const g=await a.A;_&&(_.indicator=g.use("vkcom_writing_id3_tags"));const y=(0,h.A)(t);try{const s=new n.Q(await i(f));if(s.setFrame("COMM",{description:"vknext.net",text:"Track downloaded from VK via VK Next: https://vknext.net",language:"eng"}),null!==y&&s.setFrame("APIC",{type:3,data:await y,description:"vknext.net",useUnicodeEncoding:!0}),t.title){let e=t.title;(t.subTitle||t.subtitle)&&(e+=`(${t.subTitle||t.subtitle})`),s.setFrame("TIT2",e)}(t.subTitle||t.subtitle)&&s.setFrame("TIT3",t.subTitle||t.subtitle),s.setFrame("TLEN",1e3*t.duration);const a=t.main_artists||t.mainArtists||[];if(t.featured_artists?a.push(...t.featured_artists):t.featArtists&&a.push({name:t.featArtists}),a.length){const t=a.map((t=>t.name))||[];s.setFrame("TPE1",t)}else t.artist?s.setFrame("TPE1",t.artist.split(",").map((t=>t.trim()))):t.performer&&s.setFrame("TPE1",t.performer.split(",").map((t=>t.trim())));if(e){if(s.setFrame("TALB",e.title),s.setFrame("TYER",e.year),e.genres){const t=e.genres.map((t=>t.name));s.setFrame("TCON",t)}if(e.audios){const r=e.audios.findIndex((({id:e})=>e===t.id));-1!==r&&s.setFrame("TRCK",`${r+1}/${e.audios.length}`)}if(e.create_time){const t=u(e.create_time);s.setFrame("TDAT",t)}if(e.main_artists){const t=e.main_artists.map((t=>t.name));s.setFrame("TPE2",t)}}if("string"==typeof t.title&&c.default.getValue("genius"))try{const e=await(0,l.A)({title:t.title,performer:t.performer||"",mainArtists:a,signal:r});e?.length&&s.setFrame("USLT",{description:"vknext.net",lyrics:e,language:""})}catch(t){console.error("error add lyrics to audio",t)}return s.addTag(),_&&(_.indicator=void 0),s.getBlob()}catch(t){console.error("Ошибка записи id3 тегов",t)}return f}},15991:(t,e,r)=>{r.d(e,{A:()=>a});var s=r(96058),n=r(43883);const i=async t=>{const e=await(0,n.A)();try{const{playlist:r}=await e.api("audio.getPlaylistById",{playlist_id:t.playlist_id,owner_id:t.owner_id,access_key:t.access_key,extra_fields:"owner, duration"});return r.photo&&(r.coverUrl_l=(t=>{let e,r=0;for(const[s,n]of Object.entries(t))if(s.startsWith("photo_")){const t=parseInt(s.split("photo_")[1],10);t>r&&(r=t,e=n)}return e})(r.photo)),r}catch(t){console.error(t)}try{const r=await(0,s.A)(),[n]=await r.promisifiedPost("/al_audio.php?act=load_section",{access_hash:t.access_key||"",al:"1",claim:"0",is_loading_all:"0",is_preload:"0",offset:"0",owner_id:t.owner_id,playlist_id:t.playlist_id,type:"playlist"});if(!n)return null;const i=await e.api("audio.get",{owner_id:n.ownerId,playlist_id:n.id,access_key:t.access_key,count:1e4});return{id:n.id,owner_id:n.ownerId,title:n.title,description:n.rawDescription,type:0,count:n.totalCount||n.list?.length||0,followers:0,no_discover:Boolean(n.noDiscover),plays:0,create_time:n.lastUpdated,update_time:n.lastUpdated,audios:i.items,subtitle:`${n.subTitle||""}`,main_artists:n.authorName.split(",").map((t=>({name:t.trim()}))),coverUrl_l:n.coverUrl}}catch(t){console.error(t)}return null},a=async t=>{const e=await i(t);if(!e)return null;try{const r=await vkApi.api("audio.get",{owner_id:e.owner_id||e.ownerId,playlist_id:e.id,access_key:t.access_key,count:1e4});e.audios=r.items}catch(t){console.error(t)}return e}},2921:(t,e,r)=>{r.d(e,{A:()=>i});const s=new Map,n=t=>t.trim().toLowerCase().replaceAll("ё","е"),i=async({title:t,mainArtists:e,featuredArtists:r,performer:i,signal:a})=>{const o=((t,e,r=[])=>{const s=n(t)+" "+e.map((t=>n(t.name))).concat(r).join(" ");return n(s)})(t,i?[{name:i}]:"string"==typeof e?[{name:e}]:e,r);if(s.has(o))return s.get(o);let l;try{const t=await fetch("https://api.genius.com/search?"+new URLSearchParams({q:o}),{signal:a});if(200!==t.status)return"";l=await t.json()}catch(t){return console.error("Error fetching search results:",t),""}const c=l?.response?.hits||[];let u=c.find((e=>n(e?.result?.title)===n(t)));if(!u){const t=[],e=c.filter((e=>{if(e?.result?.title){const r=n(e.result.full_title||[e.result.title,e.result.artist_names].filter((t=>t)).join(" ")),s=o.split(" ").filter((t=>!r.includes(t))).length,i=s<3;return i&&t.push(s),i}return!1}));let r=4;for(const[s,n]of Object.entries(t))r>n&&(r=n,u=e[s])}if(!u)return s.set(o,""),"";const d=u.result?.id;if(!d)return s.set(o,""),"";try{l=await fetch(`https://api.genius.com/songs/${d}?text_format=plain`,{signal:a}),l=await l.json()}catch(t){return console.error("Error fetching song details:",t),""}const p=l?.response?.song?.lyrics?.plain?.trim()||"";return s.set(o,p),p}},52352:(t,e,r)=>{r.d(e,{A:()=>s});const s=(t,e,r)=>t<e?0:t>r?100:(t-e)/(r-e)*100},88908:(t,e,r)=>{r.d(e,{A:()=>n});const s=document.createElement("textarea"),n=t=>(s.innerHTML=t,s.innerText)},70459:(t,e,r)=>{r.d(e,{A:()=>s});const s={AudioPageMainTabBtn:"XYzoAKWs2KhH02Ye",AudioArtistHeaderActions:"v8VBorduCtZgTyyi",VideoPlayerDownloadIcon:"eaSw45y_1KLlo4Gw",SecondaryAttachment__afterItem:"RZ6NWD1WvjAOxG2Y",DownloadManagerPopup:"o9vy1XhnZrkvykUb",VideoPlayerHlsWarning__tooltip:"P9MhdlrtilEQt7Am",VideoPlayerHlsWarning__text:"Xq2PVks6OK6Z74Al",AudioPlaylistSnippet__actions:"FawmW4_Zd1R1BI1E",AudioPlaylistSnippet__actionButton:"ZPr5mXzL52VUPaRe",ActionButton__icon:"_5bFyslOmNjqqP7y",ActionButton__text:"o7YAH98fI9KVToa5",AudioPlayerUserControlsContainer__userButton:"e47qq1XqMPp6oTp7",AudioPlayerPlaybackButton:"wqb5e3cgYZFgHCc1",AudioRowReact__button:"q7d6KTdMjs6HYpKm"}}}]);