"use strict";(globalThis.webpackChunkvknext=globalThis.webpackChunkvknext||[]).push([[7486],{39854:(e,s,t)=>{t.a(e,(async(e,n)=>{try{t.d(s,{A:()=>m});var a=t(74848),o=t(89230),r=t(4255),i=t(39107),c=t(96540),d=t(74225),l=t.n(d),u=t(55517),h=t(87675),g=t(1003),w=t(30948),f=t(40473),_=e([h,f]);[h,f]=_.then?(await _)():_;const m=()=>{const e=(0,h.A)(),[s,n]=(0,c.useState)(!1),[d,_]=(0,c.useState)(null),[m,p]=(0,c.useState)([]),{messages:A,setIsPopoverShown:v}=(0,w.$)(),x=(0,u.A)(),j=(0,g.A)();return l()((async e=>{if(null===A)return;const s=(await t.e(1691).then(t.bind(t,31691))).default;if(!e())return;const a=Object.keys(A);if(!a.length)return n(!0);const o=[],i=new Set,c=new Set,d=[];for(const e of a){const t=await s.getMessages(`${j}_${e}`,[]);if(!t.length)continue;d.push(e);const n=t.at(-1);n&&(n.peer_id===x&&((r.A.isUserId(n.from_id)?i:c).add(Math.abs(n.from_id)),n.time=A[n.id].time,o.push(n)))}if(!e())return;if(!o.length)return n(!0);const l=[...i],u=[...c];let h=[],g=[];try{if(l.length>0&&(h=await window.vkApi.api("users.get",{user_ids:l.join(","),fields:"photo_50,image_status,screen_name"})),u.length>0){const e=await window.vkApi.api("groups.getById",{group_ids:u.join(","),fields:"photo_50,screen_name"});e.groups&&(g=e.groups)}}catch(e){console.error(e)}const w={};for(const e of h)e.name=`${e.first_name} ${e.last_name}`,e.screen_name||(e.screen_name=`id${e.id}`),w[e.id]=e;for(const e of g)e.screen_name||(e.screen_name=`club${e.id}`),w[-e.id]=e;e()&&(_(w),p(o))}),[A,x]),(0,c.useEffect)((()=>{v(!s)}),[s]),s?(0,a.jsx)(i.OrA,{children:e.use("global_not_found")}):m.length?(0,a.jsx)(f.A,{messages:m,users:d}):(0,a.jsx)(i.YJl,{children:[...Array(8).keys()].map((e=>(0,a.jsx)(o.A,{},e)))})};n()}catch(e){n(e)}}))},30948:(e,s,t)=>{t.d(s,{$:()=>d,H:()=>l});var n=t(74848),a=t(96540),o=t(74225),r=t.n(o),i=t(1003);const c=(0,a.createContext)(null),d=()=>{const e=(0,a.useContext)(c);if(!e)throw new Error("useDeletedMessages must be used within a DeletedMessagesContext");return e},l=({children:e})=>{const[s,o]=(0,a.useState)(!1),[d,l]=(0,a.useState)(null);return r()((async e=>{const s=(0,i.A)(),n=(await t.e(367).then(t.bind(t,40367))).default,a=await n.getMessages(s,{});e()&&l(a)}),[]),(0,n.jsx)(c.Provider,{value:{messages:d,setMessages:l,isPopoverShown:s,setIsPopoverShown:o},children:e})}},70668:(e,s,t)=>{t.a(e,(async(e,n)=>{try{t.d(s,{A:()=>_});var a=t(74848),o=t(3178),r=t(39107),i=t(90275),c=t(99381),d=t(67078),l=t(55517),u=t(87675),h=t(1003),g=t(44497),w=t(30948),f=e([u]);u=(f.then?(await f)():f)[0];const _=()=>{const{setMessages:e,isPopoverShown:s,setIsPopoverShown:n}=(0,w.$)(),f=(0,u.A)(),_=(0,l.A)();return s?(0,a.jsx)(i.Ku,{actions:(0,a.jsx)(i.vH,{onClick:async()=>{const{default:s}=await t.e(367).then(t.bind(t,40367)),a=(await t.e(1691).then(t.bind(t,31691))).default,o=_||(0,g.A)(),r=(0,h.A)(),i=await a.getStorage(),c=await s.getMessages(r);for(const[e,s]of Object.entries(i))if(e.startsWith(r.toString())&&s[0]?.peer_id===o){delete i[e];for(const e of s)delete c[e.id]}await s.setMessages(r,c),await a.saveStorage(i),e({}),await(0,d.A)({type:"done",text:f.use("vkcom_deleted_messages_cleared")}),n(!1)},children:f.use("vkcom_deleted_messages_clear")}),trigger:"hover",placement:"bottom-end",children:(0,a.jsx)(r.qAe,{"aria-label":f.use("global_close"),onClick:c.A,hasActive:!1,children:(0,a.jsx)(o.o,{})})}):null};n()}catch(e){n(e)}}))},81922:(e,s,t)=>{t.a(e,(async(e,n)=>{try{t.d(s,{default:()=>g});var a=t(74848),o=t(39107),r=t(96540),i=t(84833),c=t(87675),d=t(39854),l=t(30948),u=t(70668),h=e([c,d,u]);[c,d,u]=h.then?(await h)():h;const g=()=>{const e=(0,c.A)();return(0,r.useLayoutEffect)((()=>{window.stManager&&window.stManager.add(window.stDeps["/css/al/im.css"])}),[]),(0,a.jsx)(l.H,{children:(0,a.jsx)(i.A,{size:600,header:(0,a.jsx)(o.aO9,{after:(0,a.jsx)(u.A,{}),children:e.use("vkcom_action_item_deleted_msg")}),children:(0,a.jsx)(d.A,{})})})};n()}catch(e){n(e)}}))}}]);