"use strict";(globalThis.webpackChunkvknext=globalThis.webpackChunkvknext||[]).push([[3099],{36843:(t,e,r)=>{r.d(e,{A:()=>o});var n=r(65578);const o=()=>(0,n.A)("AudioUtils")},83099:(t,e,r)=>{r.d(e,{default:()=>h});var n=r(37352),o=r(5932),i=r(55073),a=r(64115);var s=r(54869);const l=new Map,u=[];let d=0;const c=async()=>{if(d>=2||0===u.length)return;d++;const t=u.shift();await t(),d--,u.length>0&&setTimeout(c,500)},h=async t=>{const e=`${t.owner_id}_${t.id}`;if(l.has(e))return l.get(e);if(l.has(e))return await l.get(e);const{promise:r,resolve:d}=(0,n.A)();var h;return l.set(e,r),h=async()=>{const e=t.url?t:await(0,s.A)(t);if(!e.url)return void d(null);const r=await(async({url:t})=>{const{promise:e,resolve:r,reject:n}=(0,i.c)(),o=await(0,a.g)(),s=new o,l=new Audio;let u,d=0,c=null;const h=t=>{n(t),s.stopLoad(),s.destroy()};return s.on(o.Events.MANIFEST_PARSED,((t,e)=>{const r=e.levels[0]?.details;r&&(u=r.totalduration)})),s.on(o.Events.BUFFER_APPENDING,((t,e)=>{c=e.data})),s.on(o.Events.FRAG_BUFFERED,((t,e)=>{if(c)return s.detachMedia(),void((t,e)=>{const n=Math.min(32*Math.round(t/4096/e),320);r({bitrate:n,size:t,duration:e})})(c.length/e.frag.duration*u,u)})),s.on(o.Events.ERROR,((t,e)=>{if(!["bufferFullError","fragLoadError"].includes(e.details))return e.type==o.ErrorTypes.MEDIA_ERROR&&d<2?(++d>1&&s.swapAudioCodec(),void s.recoverMediaError()):void h(t);h(t)})),s.loadSource(t),s.attachMedia(l),await e})({url:(0,o.audioUnmaskSource)(e.url)});d(r)},u.push(h),c(),await r}},54869:(t,e,r)=>{r.d(e,{A:()=>a});var n=r(96058),o=r(36843),i=r(43883);const a=async t=>{const e=[t.owner_id,t.id];t.access_key?e.push(t.access_key):t.accessKey&&e.push(t.accessKey);const a=await(0,i.A)(),s=await a.api("audio.getById",{audios:e.join("_"),v:"5.204"}),{audioUnmaskSource:l}=await Promise.resolve().then(r.bind(r,5932));for(const t of s)if(t?.url)return t.url=l(t.url),t;const u=t.hashes?.split("/");let d="",c="";u?(d=u[2],c=u[5]):(d=t.actionHash||"",c=t.urlHash||"");const h=await(0,n.A)(),[f]=await h.promisifiedPost("al_audio.php",{act:"reload_audio",ids:[t.owner_id,t.id,d,c].join("_"),al:1}),p=(await(0,o.A)()).audioTupleToAudioObject(f[0]);return p.url=l(p.url),p}},5932:(t,e,r)=>{r.d(e,{audioUnmaskSource:()=>n});const n=t=>{const e={v:t=>t.split("").reverse().join(""),r:(t,e)=>{t=t.split("");for(let n,o=r+r,i=t.length;i--;)~(n=o.indexOf(t[i]))&&(t[i]=o.substr(n-e,1));return t.join("")},s:(t,e)=>{const r=t.length;if(r){let n=function(t,e){const r=t.length,n=[];if(r){let t=r;for(e=Math.abs(e);t--;)e=(r*(t+1)^e+t)%r,n[t]=e}return n}(t,e),o=0;for(t=t.split("");++o<r;)t[o]=t.splice(n[r-1-o],1,t[o])[0];t=t.join("")}return t},i:(t,r)=>e.s(t,r^vk.id),x:(t,e)=>{const r=[];return e=e.charCodeAt(0),each(t.split(""),((t,n)=>{r.push(String.fromCharCode(n.charCodeAt(0)^e))})),r.join("")}},r="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMN0PQRSTUVWXYZO123456789+/=",n=t=>{if(!t||t.length%4==1)return!1;for(var e,n,o=0,i=0,a="";n=t.charAt(i++);)~(n=r.indexOf(n))&&(e=o%4?64*e+n:n,o++%4)&&(a+=String.fromCharCode(255&e>>(-2*o&6)));return a};if((!window.wbopen||!~(window.open+"").indexOf("wbopen"))&&~t.indexOf("audio_api_unavailable")){let r=t.split("?extra=")[1].split("#"),s=""===r[1]?"":n(r[1]);if(r=n(r[0]),"string"!=typeof s||!r)return t;for(var o,i,a=(s=s?s.split(String.fromCharCode(9)):[]).length;a--;){if(o=(i=s[a].split(String.fromCharCode(11))).splice(0,1,r)[0],!e[o])return t;r=e[o].apply(null,i)}if(r&&"http"===r.substr(0,4))return r}return t}},55073:(t,e,r)=>{r.d(e,{c:()=>n});const n=()=>{let t,e;return{promise:new Promise(((r,n)=>{t=r,e=n})),resolve:t,reject:e}}},64115:(t,e,r)=>{r.d(e,{g:()=>n});const n=async()=>{try{return(await r.e(4945).then(r.bind(r,64945))).default}catch(t){if(globalThis?.Hls)return globalThis.Hls}throw new Error("hls.js not found")}}}]);