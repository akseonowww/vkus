"use strict";(globalThis.webpackChunkvknext=globalThis.webpackChunkvknext||[]).push([[1157,5544,2760],{29620:(e,t,n)=>{n.d(t,{A:()=>b});var o=n(39107);const a="xNhcCq_UNVqKQEib",r="u9AKScaRWsIKN7qd",s="Lli6CPLXkovauI7n",c="Cc4GXP80VVMTfPd4",i="c913ig6Ezz3GVTdC",l="IE60yzaGkHX5daO2",d="raJj9IYn99N3ACXp",u="X2ua3r3TQNQvwbXJ",m="LK9FQ0Pv500X3dYq",f="y41wlJ_6fta4bTJz",p={s:"mojeiuk_7TzO9VSV",m:"CXscUFfSjR7lXqQI",l:"nX2YiCQaNJkb1qHH"},h={primary:"AIOZvvr4uGYhBuP3",secondary:"Go6BE_VQ2GfVAQ6r",tertiary:"YgaW59UgTFahy9oF",outline:"uSRUc48whtn46Je_",link:"wX7UgKZQHRLzOBsB"},w={accent:"Y1sbzl9FIKHeDajP",positive:"VQfF8MKnxI3AwZTZ",negative:"T2iqqDcm93cAZn77",neutral:"yZi0auJaXofQNSQl",overlay:"uIXRefk1cdt_J8vy","accent-invariable":"qUAuu6PmeQ8YbMlz"},_={left:"H03Ea3gr3reCTz1g",right:"F09BLvr4K1N2MaU2"},b=({size:e="s",mode:t="primary",appearance:n="accent",stretched:b=!1,align:v,before:A,after:y,content:g,rounded:L,className:k,onClick:E})=>{const C=document.createElement("button");C.className=(0,o.xWm)(k,a,p[e],h[t],w[n],v&&_[v],s,f,b&&c,L&&r);const N=document.createElement("span");if(N.className=i,A){const e=document.createElement("span");e.className=u,e.appendChild(A),N.appendChild(e)}if(g){const e=document.createElement("span");e.className=l,"string"==typeof g?e.textContent=g:e.appendChild(g),N.appendChild(e)}if(y){const e=document.createElement("span");e.className=d,e.appendChild(y),N.appendChild(e)}return E&&C.addEventListener("click",E),C.addEventListener("mouseover",(()=>{C.classList.add(m)})),C.addEventListener("mouseout",(()=>{C.classList.remove(m)})),C.appendChild(N),C}},39201:(e,t,n)=>{n.d(t,{A:()=>_});var o=n(1145),a=n(67992),r=n(38729),s=n(4107);const c=new a.A,i=(0,r.NS)(),l=(0,r.NS)(),d=(0,r.sr)(),u="vkui__root",m=`.${u}`,f=e=>{if(!e[d]){e[d]=!0;for(const t of c.listeners)t(e)}},p=e=>{if(e.classList.contains(u))return f(e);for(const t of e.querySelectorAll(m))f(t);e[i]||(e[i]=new MutationObserver((async e=>{for(const t of e)if("childList"===t.type)for(const e of t.addedNodes)e instanceof HTMLElement&&e.classList.contains(u)&&f(e)})),e[i].observe(e,{childList:!0}))},h=()=>{const e=document.getElementById("spa_root");if(e){for(const t of e.querySelectorAll(m))p(t);e[l]||(e[l]=new MutationObserver((e=>{for(const t of e)if("childList"===t.type)for(const e of t.addedNodes)e instanceof HTMLElement&&e.classList.contains(u)&&p(e)})),e[l].observe(e,{childList:!0}))}};let w=!1;const _=async e=>{const t=c.addListener(e);if((0,o.A)(h),w)return t;w=!0;return(await(0,s.A)()).subscribeOnModuleEvaluated((()=>{setTimeout(h,100)})),t}},67078:(e,t,n)=>{n.d(t,{A:()=>c});var o=n(74848),a=n(3068),r=n(75511);const s=document.createElement("div");s.className=r.A.Snackbars;const c=async e=>{const t=(await Promise.all([n.e(2551),n.e(7983),n.e(2020),n.e(3543),n.e(7759)]).then(n.bind(n,28582))).default;document.body.contains(s)||document.body.appendChild(s);const r=document.createElement("div");s.appendChild(r);const{unmount:c}=await(0,a.A)({root:r,content:(0,o.jsx)(t,{onClose:()=>{c(),r.remove(),0===s.children.length&&s.remove()},...e}),disableParentTransformForPositionFixedElements:!0,noStyling:!0})}},26833:(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{A:()=>b});var a=n(97992),r=n(82050),s=n(88908),c=n(93819),i=n(67078),l=n(43024),d=n(88298),u=n(57448),m=n(46746),f=n(29219),p=e([d]);d=(p.then?(await p)():p)[0];const h=async(e,t,n,o)=>{const a={owner_id:e,album_id:t,photo_size:1,rev:1,offset:n,count:o};return await window.vkApi.api("photos.get",a,{grouping:!1})},w=async(e,t,n)=>{const o=1e3,a=Math.ceil(n/o),r=[];for(let s=0;s<a;s++){const a=s*o,c=Math.min(o,n-a),i=h(e,t,a,c);r.push(i)}try{const e=await Promise.all(r);return e.reduce(((e,t)=>e.concat(t.items)),[])}catch(e){throw await(0,i.A)({text:`Error fetching photos: ${e.message}`}),e}},_=async(e,t,n,o,a)=>{if(o?.aborted)return null;if(!t.sizes)return console.warn("No sizes in photo",t),null;const{url:s}=(0,m.A)(t.sizes);if(!s)return console.warn("No url in photo",t),null;try{const r=await fetch(s,{signal:o});if(!r.body)return null;const c=r.body.getReader(),i=+(r.headers.get("Content-Length")||"0"),d=new Uint8Array(i);let m=0;for(;;){const{done:t,value:n}=await c.read();if(t)break;d.set(n,m),m+=n.length,e.updateTimeLeft(n.length)}e.progress=(e.progress||0)+1;const f=[t.owner_id,t.id].join("_");return{name:(()=>{const e=l.default.getValue("keepOriginalPhotoNamesDownload"),t=l.default.getValue("numPhotosOnAlbumDownload"),n=e?(0,u.A)(s):`${f}.jpg`;return t&&a?`${a}. ${n}`:n})(),lastModified:t.date?new Date(1e3*t.date):n,input:new Blob([d])}}catch(s){return console.error(s),await(0,r.A)(1e3),_(e,t,n,o,a)}},b=async e=>{const t=new AbortController,{signal:o}=t,r=await c.A,i=new d.j({icon:"album",title:(0,s.A)(`${e}.zip`),subtitle:r.use("vkcom_downloading"),onCancel:()=>t.abort()}),l=d.N.addEvent(i),{ownerId:u,albumId:m}=(0,f.A)(e),{items:p}=await window.vkApi.api("photos.getAlbums",{owner_id:u,album_ids:m}),b=p.find((e=>e.id===m)),v=b?.title||e,{count:A}=await h(u,m,0,1),y=await w(u,m,A);i.title=(0,s.A)(`${v}.zip`),i.progress=0,i.progressTotal=A,i.subtitle="";const g=new Date,L=[];let k=1;for(const e of(0,a.A)(y,100)){if(o.aborted)return;for(const t of e)L.push(_(i,t,g,o,k++));await Promise.all(L)}i.clearIndicator(),i.indicator=r.use("vkcom_archivation");const E=(await Promise.all(L)).filter(Boolean);if(o.aborted)return;const{downloadZip:C}=await n.e(1941).then(n.bind(n,71941)),N=await C(E).blob(),T=URL.createObjectURL(N);await d.N.downloadFileFromLink(T,i.title),URL.revokeObjectURL(T),l(),i.stopSpeed()};o()}catch(e){o(e)}}))},63077:(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.r(t);var a=n(53644),r=n(43027),s=n(82050),c=n(14943),i=n(37445),l=n(29620),d=n(4107),u=n(39201),m=n(93819),f=n(26833),p=e([f]);f=(p.then?(await p)():p)[0];const h='.vkui__root div[class*="Photos__root"] .vkuiInternalGroup div[class*="GradientGroup__headerContent"] > div[class*="HeaderLayout__container"]',w=(e=window.nav?.strLoc||window.location.pathname.slice(1))=>/^album-?\d+/.test(e),_=async e=>{if(!w())return;const t=e.querySelector(".vkuiButtonGroup");if(!t||t.vkn_down_inj)return;if(t.querySelector('[class*="Skeleton__skeleton"]'))return;t.vkn_down_inj=!0;const n=t.querySelector(".vkuiIcon--more_20")?.closest(".vkuiButton,button"),o=await m.A;t.insertBefore((0,l.A)({mode:"secondary",content:o.use("global_download"),before:(0,a.A)(i.A),onClick:()=>(0,f.A)(nav.strLoc)}),n||null)},b=async()=>{if(!w())return;const e=document.querySelector(".photos_album_intro_info");if(!e||e?.vkn_down_inj)return;e.vkn_down_inj=!0;const t=document.createElement("span");t.className="divide",t.innerText="|";const n=document.createElement("span");n.className="photos_album_info";const o=document.createElement("a");o.addEventListener("click",(e=>{(0,r.A)(e),(0,f.A)(nav.strLoc)}));const a=await m.A;o.innerText=a.use("global_download")||"Download",n.appendChild(o),e.append(t,n)},v=async()=>{await(0,s.A)(1e3),await(0,c.A)();for(const e of document.querySelectorAll(h))_(e).catch(console.error)};(async()=>{b().catch(console.error),v().catch(console.error);(await(0,d.A)()).onLocationChange((async()=>{w()&&(await(0,c.A)(),b().catch(console.error),v().catch(console.error))})),w()&&await b(),(0,u.A)((e=>{for(const t of e.querySelectorAll(h))_(t).catch(console.error)}))})().catch(console.error),o()}catch(e){o(e)}}))},46746:(e,t,n)=>{n.d(t,{A:()=>a});var o=n(62493);const a=e=>{let t=null,n=0;for(const a of e){const e=a.type;if(o.B.includes(e)){const e=(a.width||0)*(a.height||0);e>n&&(n=e,t=a)}}return t||e[0]}},29219:(e,t,n)=>{n.d(t,{A:()=>a});const o={0:"-6","00":"-7","000":"-15","0000":"-23","00000":"-62","000000":"-10","0000000":"-7000","00000000":"-165","000000000":"-183","0000000000":"-185"},a=e=>{const t=e.match(/album(-?\d+)_(\d+)/);if(t){const e=Number(t[1]),n=t[2];return{ownerId:e,albumId:Number(o[n]||n)}}throw new Error("Failed to extract owner and album ids from album string")}},97992:(e,t,n)=>{n.d(t,{A:()=>o});const o=(e,t=100)=>{const n=[...e],o=[];for(;n.length;)o.push(n.splice(0,t||n.length));return o}},43027:(e,t,n)=>{n.d(t,{A:()=>o});const o=e=>{e.preventDefault?.(),e.stopPropagation?.(),e.stopImmediatePropagation?.()}},88908:(e,t,n)=>{n.d(t,{A:()=>a});const o=document.createElement("textarea"),a=e=>(o.innerHTML=e,o.innerText)},75511:(e,t,n)=>{n.d(t,{A:()=>o});const o={Snackbars:"fuEF5ymRhcBAxInE",BaseSnackbar:"Fu47p889xWCKEooV"}},40961:(e,t,n)=>{!function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(e){console.error(e)}}(),e.exports=n(22551)}}]);