"use strict";(globalThis.webpackChunkvknext=globalThis.webpackChunkvknext||[]).push([[3250,5544],{3881:(e,t,s)=>{s.d(t,{T:()=>n});var n=(0,s(93543).mT)("Icon24AddOutline","add_outline_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="add_outline_24"><g fill="none" fill-rule="evenodd"><path d="M0 0h24v24H0z" /><path fill="currentColor" fill-rule="nonzero" d="M12 3a.9.9 0 0 1 .9.9v7.2h7.2a.9.9 0 1 1 0 1.8l-7.2-.001V20.1a.9.9 0 1 1-1.8 0V12.9l-7.2.001a.9.9 0 1 1 0-1.8h7.2V3.9A.9.9 0 0 1 12 3" /></g></symbol>',24,24,!1,void 0)},84833:(e,t,s)=>{s.d(t,{A:()=>i});var n=s(74848),o=s(39107),a=s(96540),r=s(17100);const i=({children:e,noClose:t=!1,...s})=>{const{open:i,setOpen:c,onClose:d,onClosed:l,onOpen:u,onOpened:h}=(0,r.Fs)(),p=(0,a.useId)();return(0,n.jsx)(o.VWm,{nav:p,open:i,onClose:(e,s)=>{t||(c(!1),d?.(e,s))},onClosed:l,onOpen:u,onOpened:h,...s,children:(0,n.jsx)(a.Suspense,{fallback:(0,n.jsx)(o.qBl,{}),children:e})})}},67078:(e,t,s)=>{s.d(t,{A:()=>i});var n=s(74848),o=s(3068),a=s(75511);const r=document.createElement("div");r.className=a.A.Snackbars;const i=async e=>{const t=(await Promise.all([s.e(2551),s.e(7983),s.e(2020),s.e(3543),s.e(7759)]).then(s.bind(s,28582))).default;document.body.contains(r)||document.body.appendChild(r);const a=document.createElement("div");r.appendChild(a);const{unmount:i}=await(0,o.A)({root:a,content:(0,n.jsx)(t,{onClose:()=>{i(),a.remove(),0===r.children.length&&r.remove()},...e}),disableParentTransformForPositionFixedElements:!0,noStyling:!0})}},39576:(e,t,s)=>{s.a(e,(async(e,n)=>{try{s.d(t,{A:()=>l});var o=s(74848),a=s(39107),r=s(87675),i=s(36520),c=s(22798),d=e([r,i,c]);[r,i,c]=d.then?(await d)():d;const l=()=>{const e=(0,r.A)();return(0,o.jsxs)(a.iau,{children:[(0,o.jsx)(a.lZ$,{title:e.use("vkcom_choose_video_frame"),subtitle:e.use("vkcom_choose_video_frame_description")}),(0,o.jsx)(i.A,{}),(0,o.jsx)(a.KzX,{size:12}),(0,o.jsx)(c.A,{})]})};n()}catch(e){n(e)}}))},36520:(e,t,s)=>{s.a(e,(async(e,n)=>{try{s.d(t,{A:()=>p});var o=s(74848),a=s(39107),r=s(96540),i=s(74225),c=s.n(i),d=s(79705),l=s(23606),u=s(79010),h=e([l]);l=(h.then?(await h)():h)[0];const p=()=>{const[e]=(0,d.A)("videoMessageShapeId"),[t,s]=(0,r.useState)(null);return c()((async t=>{const{shapes:n}=await window.vkApi.api("messages.getVideoMessageShapes",{shape_id:e});t()&&s(n||[])}),[]),null!==t?(0,o.jsx)("div",{className:(0,a.xWm)(u.A.VideoMessage__wrapper),children:t.map((e=>(0,o.jsx)(l.A,{shapeRawPath:e.raw_path,shapeId:e.id},e.id)))}):(0,o.jsx)("div",{className:(0,a.xWm)(u.A.VideoMessage__wrapper),children:[1,2,3].map((e=>(0,o.jsx)(l.A,{shapeId:e},e)))})};n()}catch(e){n(e)}}))},23606:(e,t,s)=>{s.a(e,(async(e,n)=>{try{s.d(t,{A:()=>h});var o=s(74848),a=s(39107),r=s(96540),i=s(87675),c=s(79705),d=s(79010),l=e([i]);i=(l.then?(await l)():l)[0];const u=({isSelect:e,onClick:t})=>{const s=(0,i.A)();return(0,o.jsx)(a.$nd,{onClick:t,disabled:e,children:e?s.use("vkcom_video_frame_selected"):s.use("vkcom_video_frame_select")})},h=({shapeId:e,shapeRawPath:t})=>{const s=(0,r.useId)(),[n,i]=(0,c.A)("videoMessageShapeId");return(0,o.jsxs)("div",{className:(0,a.xWm)(d.A.VideoMessageForm),children:[t&&(0,o.jsx)("svg",{width:0,height:0,children:(0,o.jsx)("defs",{children:(0,o.jsx)("clipPath",{id:s,children:(0,o.jsx)("path",{transform:"scale(0.7)",d:t})})})}),(0,o.jsx)("div",{className:(0,a.xWm)(d.A.VideoMessage),style:{clipPath:t?`url(#${s})`:void 0},children:(0,o.jsx)("video",{src:"https://vknext.net/static/squirrel-squirrel-eating-snickers.mp4",autoPlay:!0,muted:!0,loop:!0,className:(0,a.xWm)(d.A.VideoMessage__video)})}),(0,o.jsx)(u,{isSelect:n===e,onClick:()=>i(e)})]})};n()}catch(e){n(e)}}))},22798:(e,t,s)=>{s.a(e,(async(e,n)=>{try{s.d(t,{A:()=>f});var o=s(74848),a=s(82050),r=s(3881),i=s(39107),c=s(96540),d=s(17100),l=s(67078),u=s(55517),h=s(87675),p=s(79705),v=s(96330),_=e([h]);h=(_.then?(await _)():_)[0];const f=()=>{const e=(0,h.A)(),[t,s]=(0,c.useState)(null),n=(0,c.useRef)(null),[_]=(0,p.A)("videoMessageShapeId"),f=(0,u.A)(),{closeModal:A}=(0,d.Hb)();return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(i.DzN,{centered:!0,before:(0,o.jsx)(r.T,{}),onClick:()=>{n.current&&n.current.click()},children:[e.use("vkcom_upload_video"),(0,o.jsx)(i.s6o,{Component:"input",getRootRef:n,type:"file",accept:"video/mp4",onChange:async({target:t})=>{if(!t.files)return s((0,o.jsx)(i.WHT,{state:"error"})),await(0,a.A)(1e3),void s(null);try{const[n]=t.files;s((0,o.jsx)(i.WHT,{}));const{upload_url:r}=await window.vkApi.api("video.getVideoMessageUploadInfo",{shape_id:_}),c=new FormData;c.append("file",n,n.name);const d=await fetch(r,{method:"POST",body:c}).then((e=>e.text()));if(d.includes("error"))return s((0,o.jsx)(i.WHT,{state:"error"})),await(0,l.A)({type:"error",text:`${e.use("global_error")}: ${d}`}),await(0,a.A)(1e3),void s(null);const u=JSON.parse(d);if(!u)return void s((0,o.jsx)(i.WHT,{state:"error"}));const h=`video_message${u.owner_id}_${u.video_id}_${u.video_hash}`;await(0,v.A)(h,f),s((0,o.jsx)(i.WHT,{state:"done"})),A(),await(0,a.A)(1e3),s(null)}catch(t){console.error(t),s((0,o.jsx)(i.WHT,{state:"error"})),await(0,l.A)({type:"error",text:e.use("global_error")}),await(0,a.A)(1e3),s(null)}}})]}),t]})};n()}catch(e){n(e)}}))},65539:(e,t,s)=>{s.a(e,(async(e,n)=>{try{s.d(t,{default:()=>l});var o=s(74848),a=s(39107),r=s(84833),i=s(87675),c=s(39576),d=e([i,c]);[i,c]=d.then?(await d)():d;const l=()=>{const e=(0,i.A)();return(0,o.jsx)(r.A,{size:845,header:(0,o.jsx)(a.aO9,{children:e.use("vkcom_send_video_message")}),children:(0,o.jsx)(c.A,{})})};n()}catch(e){n(e)}}))},96330:(e,t,s)=>{s.d(t,{A:()=>o});var n=s(52968);const o=async(e,t)=>await window.vkApi.api("messages.send",{random_id:0,peer_id:t,group_id:Math.abs((0,n.A)()),attachment:e})},55517:(e,t,s)=>{s.d(t,{A:()=>c});var n=s(22440),o=s(96540),a=s(5679),r=s(44497);const i=(0,n.A)(),c=()=>{const[e,t]=(0,o.useState)(i.cur?.peer||(0,r.A)());return(0,o.useEffect)((()=>{if(i.vkmeIntegration)return(0,a.A)((e=>{"UserOpenedConvo"===e.type&&t(e.peerId),"UserClosedConvo"===e.type&&t(0)}))}),[]),(0,o.useEffect)((()=>{if(i.vkmeIntegration)return;return i.nav.onLocationChange((()=>{e!==i.cur.peer&&i.cur.peer&&t(i.cur.peer)}))}),[]),e}},87675:(e,t,s)=>{s.a(e,(async(e,n)=>{try{s.d(t,{A:()=>a});var o=s(93819);const e=await o.A,a=()=>e;n()}catch(e){n(e)}}),1)},79705:(e,t,s)=>{s.d(t,{A:()=>a});var n=s(96540),o=s(43024);const a=function(e){const[t,s]=(0,n.useState)(o.default.getValue(e));return(0,n.useEffect)((()=>{const t=o.default.addChangeKeyListener(e,((e,t)=>s(t)));return()=>t.remove()}),[e]),[t,t=>{o.default.setValue(e,t)}]}},52968:(e,t,s)=>{s.d(t,{A:()=>a});var n=s(4255),o=s(1003);const a=()=>{if(window.cur.gid&&n.A.isGroupId(window.cur.gid))return window.cur.gid;const e=(0,o.A)();return n.A.isGroupId(e)?e:0}},5679:(e,t,s)=>{s.d(t,{A:()=>c});var n=s(67992),o=s(2519);const a=new n.A,r=new n.A,i=async()=>{(e=>{if(e._meAppHooked)return;e._meAppHooked=!0;const t=e.store.dispatch;let s=e.store.getState()?.ownerId;e.store.dispatch=function(...n){const[o]=n;s||(s=e.store.getState()?.ownerId);let i=!1;for(const e of r.listeners)try{const t=e(o);"boolean"==typeof t&&t&&(i=!0)}catch(e){console.error(e)}if(i)return;const c=Reflect.apply(t,e.store,n);for(const e of a.listeners)try{e(o)}catch(e){console.error(e)}return c}})(await(0,o.A)())},c=(e,t=!1)=>{const s=(t?a:r).addListener(e);return i(),s}},44497:(e,t,s)=>{s.d(t,{A:()=>n});const n=()=>{const e=window.location.pathname.match(/\/convo\/(-?\d+)/);if(e)return Number(e[1])||0;const t=new URLSearchParams(window.location.search),s=Number(t.get("sel"));return s||0}},75511:(e,t,s)=>{s.d(t,{A:()=>n});const n={Snackbars:"fuEF5ymRhcBAxInE",BaseSnackbar:"Fu47p889xWCKEooV"}},79010:(e,t,s)=>{s.d(t,{A:()=>n});const n={VideoMessage__wrapper:"eiaxbfhcfLM4i1FR",VideoMessage__list:"hXigv7_M0qhQRVPW",VideoMessageForm:"iZLrrekju7vdSXJV",VideoMessage:"TAEwP4XRuJ9aWZj0",VideoMessage__video:"hJjCJB_Xf75fRzKB"}},40961:(e,t,s)=>{!function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(e){console.error(e)}}(),e.exports=s(22551)},74225:(e,t,s)=>{var n=s(96540);function o(e,t,s){var o="function"==typeof t;n.useEffect((function(){var s,n=!0,a=e((function(){return n}));return Promise.resolve(a).then((function(e){s=e})),function(){n=!1,o&&t(s)}}),o?s:t)}e.exports=o,e.exports.useAsyncEffect=o}}]);