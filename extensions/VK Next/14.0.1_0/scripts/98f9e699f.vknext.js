"use strict";(globalThis.webpackChunkvknext=globalThis.webpackChunkvknext||[]).push([[6085],{67078:(t,e,a)=>{a.d(e,{A:()=>s});var o=a(74848),n=a(3068),i=a(75511);const r=document.createElement("div");r.className=i.A.Snackbars;const s=async t=>{const e=(await Promise.all([a.e(2551),a.e(7983),a.e(2020),a.e(3543),a.e(7759)]).then(a.bind(a,28582))).default;document.body.contains(r)||document.body.appendChild(r);const i=document.createElement("div");r.appendChild(i);const{unmount:s}=await(0,n.A)({root:i,content:(0,o.jsx)(e,{onClose:()=>{s(),i.remove(),0===r.children.length&&r.remove()},...t}),disableParentTransformForPositionFixedElements:!0,noStyling:!0})}},5024:(t,e,a)=>{a.a(t,(async(t,o)=>{try{a.d(e,{A:()=>f,u:()=>m});var n=a(97992),i=a(63499),r=a(88908),s=a(93819),l=a(67078),c=a(43024),d=a(88298),u=a(84896),p=a(14692),y=a(15991),h=t([d]);d=(h.then?(await h)():h)[0];const m=async({event:t,audio:e,lastModified:a,signal:o,playlist:n,audioIndex:r})=>{if(o.aborted)return null;if(!e.url)return null;try{const s=await(0,p.G)({audio:e,playlist:n,signal:o,playlistEvent:t}),l=[];return c.default.getValue("numTracksInPlaylist")&&l.push(`${r}. `),l.push(`${e.artist} - ${e.title}`),e.subtitle&&l.push(` (${e.subtitle})`),l.push(".mp3"),t&&(t.progress=(t.progress||0)+1),{name:(0,i.A)(l.join("")),lastModified:e.date?new Date(1e3*e.date):a,input:s}}catch(t){return console.error("error download audio",t),null}},f=async t=>{const[e,o,i]=t.split("_"),c=await s.A;await(0,l.A)({text:c.use("vkcom_downloading")});const p=await(0,y.A)({owner_id:parseInt(e),playlist_id:parseInt(o),access_key:i,fixAudioUrl:!0});if(!p)return void await(0,l.A)({text:"Playlist not found",type:"error"});if(p?.error?.error_msg)return void await(0,l.A)({text:p.error.error_msg,type:"error"});if(!p.audios?.length)return void await(0,l.A)({text:c.use("vkcom_playlist_is_empty"),type:"error"});const h=new AbortController,{signal:f}=h,A=(p.main_artists||[]).map((t=>t.name)),w=[];A.length&&w.push(`${A.join(", ")} - `),p.title?w.push(p.title):w.push("playlist");const _=new d.j({icon:"playlist_music",title:(0,r.A)(`${w.join("")}.zip`),onCancel:()=>h.abort(),progress:0,progressTotal:p.audios.length,iconUrl:(0,u.Z)(p)||void 0}),b=d.N.addEvent(_),v=new Date,g=[];let k=1;for(const t of(0,n.A)(p.audios,8)){if(f.aborted)return;for(const e of t)g.push(m({event:_,audio:e,lastModified:v,signal:f,audioIndex:k++,playlist:p}));await Promise.all(g)}_.clearIndicator(),_.indicator=c.use("vkcom_processing");const S=(await Promise.all(g)).filter(Boolean);if(!f.aborted){if(1===S.length){const t=S[0],e=URL.createObjectURL(t.input);await d.N.downloadFileFromLink(e,t.name),URL.revokeObjectURL(e)}else{_.indicator=c.use("vkcom_archivation");const{downloadZip:t}=await a.e(1941).then(a.bind(a,71941)),e=await t(S).blob(),o=URL.createObjectURL(e);await d.N.downloadFileFromLink(o,_.title),URL.revokeObjectURL(o)}b(),_.stopSpeed()}};o()}catch(t){o(t)}}))},50130:(t,e,a)=>{a.a(t,(async(t,o)=>{try{a.r(e);var n=a(74848),i=a(95728),r=a(14943),s=a(58354),l=a(67767),c=a(67078),d=a(3068),u=a(98570),p=a(5024),y=t([p]);p=(y.then?(await y)():y)[0];const h=async(t,e,o)=>{if((0,u.A)()?.vms_installed)return;if(t.vkn_down_inj)return;t.vkn_down_inj=!0;const i=t.querySelector('.SecondaryAttachment__after,[data-testid="secondaryattachment-after"],[class*="SecondaryAttachment__after"]');if(!i)return;await(0,r.A)();const s=document.createElement("div"),l=i.querySelector('[data-task-click="SecondaryAttachment/addAudio"]');l?i.insertBefore(s,l):i.prepend(s);const{default:c}=await Promise.all([a.e(2551),a.e(7983),a.e(2020),a.e(3543),a.e(1434),a.e(7858)]).then(a.bind(a,50150));await(0,d.A)({root:s,content:(0,n.jsx)(c,{type:"secondary_attachment",onClick:e,audioObject:o,tooltipProps:{placement:"top",appearance:"black",enableInteractive:!0}}),disableAppRoot:!0,disableConfig:!0,disableParentTransformForPositionFixedElements:!0})},m=t=>{const e=t.dataset.audio;if(!e)return;const a=window.AudioUtils.audioTupleToAudioObject(JSON.parse(e));a&&!a?.restrictionStatus&&h(t,void 0,a)},f=t=>{h(t,(async()=>{const e=[];t.dataset.ownerId&&e.push(t.dataset.ownerId),t.dataset.playlistId&&e.push(t.dataset.playlistId),t.dataset.accessKey&&e.push(t.dataset.accessKey),e.length?await(0,p.A)(e.join("_")):await(0,c.A)({type:"error",text:"playlist id not found"})})).catch(console.error)},A=t=>{for(const e of t.querySelectorAll(".SecondaryAttachment[data-audio]"))m(e);for(const e of t.querySelectorAll(".SecondaryAttachment[data-playlist-id]"))f(e);for(const e of t.querySelectorAll('[class*="SecondaryAttachment__root"]'))try{const{fiber:t}=(0,i.A)(e),a=t.return.return.return.return.return.return.memoizedProps.originalAttachment;if(a?.audio){const t=window.AudioUtils.audioTupleToAudioObject(a.audio);if(!t||t?.restrictionStatus)continue;h(e,void 0,t)}if(a?.audio_playlist){const t=a.audio_playlist;h(e,(async()=>{const e=[];t.owner_id&&e.push(t.owner_id),t.id&&e.push(t.id),t.access_key&&e.push(t.access_key),e.length?await(0,p.A)(e.join("_")):await(0,c.A)({type:"error",text:"playlist id not found"})})).catch(console.error)}}catch(t){console.error(t)}};(0,u.A)()?.vms_installed||((0,l.A)(A),(0,s.A)(A)),o()}catch(t){o(t)}}))},97992:(t,e,a)=>{a.d(e,{A:()=>o});const o=(t,e=100)=>{const a=[...t],o=[];for(;a.length;)o.push(a.splice(0,e||a.length));return o}},63499:(t,e,a)=>{a.d(e,{A:()=>n});const o=/\/|\\|:|\*|\?|"|<|>|\||\+|%|@|@\\0/g;function n(t){return t.replaceAll(o,"_")}},75511:(t,e,a)=>{a.d(e,{A:()=>o});const o={Snackbars:"fuEF5ymRhcBAxInE",BaseSnackbar:"Fu47p889xWCKEooV"}}}]);