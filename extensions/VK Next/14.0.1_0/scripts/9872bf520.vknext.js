"use strict";(globalThis.webpackChunkvknext=globalThis.webpackChunkvknext||[]).push([[9381],{57054:(e,t,r)=>{r.d(t,{H:()=>i});var a=r(35277),n=r(55073),s=r(64115);const i=async({url:e,filename:t,onProgress:r,forceHls:i})=>{if(!i)try{return await(0,a._)({url:e,filename:t,type:"convertHlsToMp3",onProgress:r})}catch(e){console.error(e)}const{promise:o,resolve:c,reject:l}=(0,n.c)(),u=await(0,s.g)(),h=new u,g=new Audio;let m=null;const d=[];let f,p,y=0;const T=e=>{l(e),h.stopLoad(),h.destroy()};return h.on(u.Events.MANIFEST_PARSED,((e,t)=>{const r=t.levels[0]?.details;r&&(p=r.fragments.length)})),h.on(u.Events.BUFFER_CODECS,((e,t)=>{t.audio&&"audio/mp4"!==t.audio.container||(f=t.audio)})),h.on(u.Events.BUFFER_APPENDING,((e,t)=>{m=t.data})),h.on(u.Events.ERROR,((e,t)=>{if(!["bufferFullError","fragLoadError"].includes(t.details))return t.type==u.ErrorTypes.MEDIA_ERROR&&y<2?(++y>1&&h.swapAudioCodec(),void h.recoverMediaError()):void T(e);T(e)})),h.on(u.Events.FRAG_BUFFERED,(async(e,t)=>{m&&d.push(f?m.slice(8,m.length):m),g.currentTime=t.frag.start+t.frag.duration;try{r&&r(d.length/p)}catch(e){console.error(e)}if(d.length>=p){h.stopLoad(),h.destroy();const e=new Blob(d,{type:"audio/mp3"});c(e)}})),h.loadSource(e),h.attachMedia(g),await o}},55073:(e,t,r)=>{r.d(t,{c:()=>a});const a=()=>{let e,t;return{promise:new Promise(((r,a)=>{e=r,t=a})),resolve:e,reject:t}}},64115:(e,t,r)=>{r.d(t,{g:()=>a});const a=async()=>{try{return(await r.e(4945).then(r.bind(r,64945))).default}catch(e){if(globalThis?.Hls)return globalThis.Hls}throw new Error("hls.js not found")}},35277:(e,t,r)=>{r.d(t,{_:()=>l});var a=r(55073);const n=e=>new Promise((t=>setTimeout(t,e)));let s,i=null,o=0;const c=async()=>{s||(s=(async()=>{if(await n(6e4),!i)return;const e=await i;e&&(0===o&&await n(1e4),0===o&&(i=null,e.remove()))})(),s.finally((()=>{s=null})))},l=async({onProgress:e,type:t,iframeURL:n="https://vknext.net/ffmpeg",...s})=>{const{promise:l,reject:u,resolve:h}=(0,a.c)(),g="request-"+Math.random().toString(36).substr(2,9),m=await(e=>{if(i)return i;const{promise:t,resolve:r,reject:n}=(0,a.c)();i=t;const s=document.querySelector(`iframe[src="${e}"]`);if(s)return r(s),t;const o=document.createElement("iframe");return o.src=e,o.style.setProperty("display","none","important"),o.onload=()=>r(o),o.onerror=n,(document.body||document.documentElement).appendChild(o),t})(n),{Bridge:d}=await r.e(2692).then(r.bind(r,42692)),f=new d(m.contentWindow,{prefix:"vknext-net-bridge"});return o++,e&&f.on("progress",(t=>{const r=t;r?.requestId===g&&e(r.progress,r.total)})),f.on("error",(e=>{const t=e;t?.requestId===g&&(u(t?.error||"unknown error"),f.destroy(),o--,c())})),f.on("response",(e=>{const t=e;t?.requestId===g&&(h(t.response),f.destroy(),o--,c())})),f.on("getBlob",(e=>{const t=e;if(t?.requestId===g)return fetch(t.url).then((e=>e.blob()))})),f.post(t,{...s,requestId:g}),l}},8596:(e,t,r)=>{function a(e){return String(e).split("").map((e=>e.charCodeAt(0)))}function n(e){return new Uint8Array(a(e))}function s(e){const t=new ArrayBuffer(2*e.length),r=new Uint8Array(t);return new Uint16Array(t).set(a(e)),r}function i(e){const t=255;return[e>>>24&t,e>>>16&t,e>>>8&t,e&t]}function o(e){return 11+e}function c(e,t,r,a){return 11+t+1+1+(a?2+2*(r+1):r+1)+e}function l(e){let t=0;return e.forEach((e=>{t+=2+2*e[0].length+2+2+2*e[1].length+2})),11+t}function u(e,t){const r=2*t;let a=0;return e.forEach((e=>{a+=2+2*e[0].length+2+4})),18+r+2+a}r.d(t,{Q:()=>h});class h{_setIntegerFrame(e,t){const r=parseInt(t,10);this.frames.push({name:e,value:r,size:o(r.toString().length)})}_setStringFrame(e,t){const r=t.toString();let a=13+2*r.length;"TDAT"===e&&(a=o(r.length)),this.frames.push({name:e,value:r,size:a})}_setPictureFrame(e,t,r,a){const n=function(e){if(!e||!e.length)return null;if(255===e[0]&&216===e[1]&&255===e[2])return"image/jpeg";if(137===e[0]&&80===e[1]&&78===e[2]&&71===e[3])return"image/png";if(71===e[0]&&73===e[1]&&70===e[2])return"image/gif";if(87===e[8]&&69===e[9]&&66===e[10]&&80===e[11])return"image/webp";const t=73===e[0]&&73===e[1]&&42===e[2]&&0===e[3],r=77===e[0]&&77===e[1]&&0===e[2]&&42===e[3];return t||r?"image/tiff":66===e[0]&&77===e[1]?"image/bmp":0===e[0]&&0===e[1]&&1===e[2]&&0===e[3]?"image/x-icon":null}(new Uint8Array(t)),s=r.toString();if(!n)throw new Error("Unknown picture MIME type");r||(a=!1),this.frames.push({name:"APIC",value:t,pictureType:e,mimeType:n,useUnicodeEncoding:a,description:s,size:c(t.byteLength,n.length,s.length,a)})}_setLyricsFrame(e,t,r){const a=e.split("").map((e=>e.charCodeAt(0))),n=t.toString(),s=r.toString();var i,o;this.frames.push({name:"USLT",value:s,language:a,description:n,size:(i=n.length,o=s.length,16+2*i+2+2+2*o)})}_setCommentFrame(e,t,r){const a=e.split("").map((e=>e.charCodeAt(0))),n=t.toString(),s=r.toString();var i,o;this.frames.push({name:"COMM",value:s,language:a,description:n,size:(i=n.length,o=s.length,16+2*i+2+2+2*o)})}_setPrivateFrame(e,t){const r=e.toString();var a,n;this.frames.push({name:"PRIV",value:t,id:r,size:(a=r.length,n=t.byteLength,10+a+1+n)})}_setUserStringFrame(e,t){const r=e.toString(),a=t.toString();var n,s;this.frames.push({name:"TXXX",description:r,value:a,size:(n=r.length,s=a.length,13+2*n+2+2+2*s)})}_setUrlLinkFrame(e,t){const r=t.toString();var a;this.frames.push({name:e,value:r,size:(a=r.length,10+a)})}_setPairedTextFrame(e,t){this.frames.push({name:e,value:t,size:l(t)})}_setSynchronisedLyricsFrame(e,t,r,a,n){const s=n.toString(),i=a.split("").map((e=>e.charCodeAt(0)));this.frames.push({name:"SYLT",value:t,language:i,description:s,type:e,timestampFormat:r,size:u(t,s.length)})}constructor(e){if(!e||"object"!=typeof e||!("byteLength"in e))throw new Error("First argument should be an instance of ArrayBuffer or Buffer");this.arrayBuffer=e,this.padding=4096,this.frames=[],this.url=""}setFrame(e,t){switch(e){case"TPE1":case"TCOM":case"TCON":{if(!Array.isArray(t))throw new Error(`${e} frame value should be an array of strings`);const r="TCON"===e?";":"/",a=t.join(r);this._setStringFrame(e,a);break}case"TLAN":case"TIT1":case"TIT2":case"TIT3":case"TALB":case"TPE2":case"TPE3":case"TPE4":case"TRCK":case"TPOS":case"TMED":case"TPUB":case"TCOP":case"TKEY":case"TEXT":case"TDAT":case"TSRC":this._setStringFrame(e,t);break;case"TBPM":case"TLEN":case"TYER":this._setIntegerFrame(e,t);break;case"USLT":if(t.language=t.language||"eng","object"!=typeof t||!("description"in t)||!("lyrics"in t))throw new Error("USLT frame value should be an object with keys description and lyrics");if(t.language&&!t.language.match(/[a-z]{3}/i))throw new Error("Language must be coded following the ISO 639-2 standards");this._setLyricsFrame(t.language,t.description,t.lyrics);break;case"APIC":if("object"!=typeof t||!("type"in t)||!("data"in t)||!("description"in t))throw new Error("APIC frame value should be an object with keys type, data and description");if(t.type<0||t.type>20)throw new Error("Incorrect APIC frame picture type");this._setPictureFrame(t.type,t.data,t.description,!!t.useUnicodeEncoding);break;case"TXXX":if("object"!=typeof t||!("description"in t)||!("value"in t))throw new Error("TXXX frame value should be an object with keys description and value");this._setUserStringFrame(t.description,t.value);break;case"WCOM":case"WCOP":case"WOAF":case"WOAR":case"WOAS":case"WORS":case"WPAY":case"WPUB":this._setUrlLinkFrame(e,t);break;case"COMM":if(t.language=t.language||"eng","object"!=typeof t||!("description"in t)||!("text"in t))throw new Error("COMM frame value should be an object with keys description and text");if(t.language&&!t.language.match(/[a-z]{3}/i))throw new Error("Language must be coded following the ISO 639-2 standards");this._setCommentFrame(t.language,t.description,t.text);break;case"PRIV":if("object"!=typeof t||!("id"in t)||!("data"in t))throw new Error("PRIV frame value should be an object with keys id and data");this._setPrivateFrame(t.id,t.data);break;case"IPLS":if(!Array.isArray(t)||!Array.isArray(t[0]))throw new Error("IPLS frame value should be an array of pairs");this._setPairedTextFrame(e,t);break;case"SYLT":if("object"!=typeof t||!("type"in t)||!("text"in t)||!("timestampFormat"in t))throw new Error("SYLT frame value should be an object with keys type, text and timestampFormat");if(!Array.isArray(t.text)||!Array.isArray(t.text[0]))throw new Error("SYLT frame text value should be an array of pairs");if(t.type<0||t.type>6)throw new Error("Incorrect SYLT frame content type");if(t.timestampFormat<1||t.timestampFormat>2)throw new Error("Incorrect SYLT frame time stamp format");t.language=t.language||"eng",t.description=t.description||"",this._setSynchronisedLyricsFrame(t.type,t.text,t.timestampFormat,t.language,t.description);break;default:throw new Error(`Unsupported frame ${e}`)}return this}removeTag(){if(this.arrayBuffer.byteLength<10)return;const e=new Uint8Array(this.arrayBuffer),t=e[3],r=((a=[e[6],e[7],e[8],e[9]])[0]<<21)+(a[1]<<14)+(a[2]<<7)+a[3]+10;var a,n;73!==(n=e)[0]||68!==n[1]||51!==n[2]||t<2||t>4||(this.arrayBuffer=new Uint8Array(e.subarray(r)).buffer)}addTag(){this.removeTag();const e=[255,254],t=10+this.frames.reduce(((e,t)=>e+t.size),0)+this.padding,r=new ArrayBuffer(this.arrayBuffer.byteLength+t),a=new Uint8Array(r);let o=0,c=[];return c=[73,68,51,3],a.set(c,o),o+=c.length,o++,o++,c=function(e){const t=127;return[e>>>21&t,e>>>14&t,e>>>7&t,e&t]}(t-10),a.set(c,o),o+=c.length,this.frames.forEach((t=>{switch(c=n(t.name),a.set(c,o),o+=c.length,c=i(t.size-10),a.set(c,o),o+=c.length,o+=2,t.name){case"WCOM":case"WCOP":case"WOAF":case"WOAR":case"WOAS":case"WORS":case"WPAY":case"WPUB":c=n(t.value),a.set(c,o),o+=c.length;break;case"TPE1":case"TCOM":case"TCON":case"TLAN":case"TIT1":case"TIT2":case"TIT3":case"TALB":case"TPE2":case"TPE3":case"TPE4":case"TRCK":case"TPOS":case"TKEY":case"TMED":case"TPUB":case"TCOP":case"TEXT":case"TSRC":c=[1].concat(e),a.set(c,o),o+=c.length,c=s(t.value),a.set(c,o),o+=c.length;break;case"TXXX":case"USLT":case"COMM":c=[1],"USLT"!==t.name&&"COMM"!==t.name||(c=c.concat(t.language)),c=c.concat(e),a.set(c,o),o+=c.length,c=s(t.description),a.set(c,o),o+=c.length,c=[0,0].concat(e),a.set(c,o),o+=c.length,c=s(t.value),a.set(c,o),o+=c.length;break;case"TBPM":case"TLEN":case"TDAT":case"TYER":o++,c=n(t.value),a.set(c,o),o+=c.length;break;case"PRIV":c=n(t.id),a.set(c,o),o+=c.length,o++,a.set(new Uint8Array(t.value),o),o+=t.value.byteLength;break;case"APIC":c=[t.useUnicodeEncoding?1:0],a.set(c,o),o+=c.length,c=n(t.mimeType),a.set(c,o),o+=c.length,c=[0,t.pictureType],a.set(c,o),o+=c.length,t.useUnicodeEncoding?(c=[].concat(e),a.set(c,o),o+=c.length,c=s(t.description),a.set(c,o),o+=c.length,o+=2):(c=n(t.description),a.set(c,o),o+=c.length,o++),a.set(new Uint8Array(t.value),o),o+=t.value.byteLength;break;case"IPLS":c=[1],a.set(c,o),o+=c.length,t.value.forEach((t=>{c=[].concat(e),a.set(c,o),o+=c.length,c=s(t[0].toString()),a.set(c,o),o+=c.length,c=[0,0].concat(e),a.set(c,o),o+=c.length,c=s(t[1].toString()),a.set(c,o),o+=c.length,c=[0,0],a.set(c,o),o+=c.length}));break;case"SYLT":c=[1].concat(t.language).concat(t.timestampFormat).concat(t.type),a.set(c,o),o+=c.length,c=[].concat(e),a.set(c,o),o+=c.length,c=s(t.description),a.set(c,o),o+=c.length,o+=2,t.value.forEach((t=>{c=[].concat(e),a.set(c,o),o+=c.length,c=s(t[0].toString()),a.set(c,o),o+=c.length,c=[0,0],a.set(c,o),o+=c.length,c=i(t[1]),a.set(c,o),o+=c.length}))}})),o+=this.padding,a.set(new Uint8Array(this.arrayBuffer),o),this.arrayBuffer=r,r}getBlob(){return new Blob([this.arrayBuffer],{type:"audio/mpeg"})}getURL(){return this.url||(this.url=URL.createObjectURL(this.getBlob())),this.url}revokeURL(){URL.revokeObjectURL(this.url)}}}}]);