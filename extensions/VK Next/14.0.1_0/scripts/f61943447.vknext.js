"use strict";(globalThis.webpackChunkvknext=globalThis.webpackChunkvknext||[]).push([[9920],{90603:(e,t,n)=>{n.d(t,{A:()=>s});var o=n(95728);const s=()=>{const e=document.getElementById("profile_redesigned");if(!e)return{state:void 0,profileRedesigned:void 0,store:void 0};const t=document.getElementById("react_rootprofile"),{container:n}=(0,o.A)(t);let{env:s,store:i}=n?.memoizedState?.element?.props||{};if(!i){const{fiber:t}=(0,o.A)(e);i=t?.return?.return?.memoizedProps?.value?.store}const a=i?.getState?.();return a||console.warn("profile state not found"),{state:a||void 0,profileRedesigned:e,store:i,env:s}}},68284:(e,t,n)=>{n.d(t,{A:()=>o});const o=(e,t)=>({type:"UPDATE_OWNER_FIELD",key:e,value:t})},38444:(e,t,n)=>{n.d(t,{A:()=>v});var o=n(22440),s=n(1145),i=n(14943),a=n(95684),r=n(38729),l=n(4107),c=n(2006);const f=(0,o.A)(),d=(0,r.NS)(),p=(0,r.NS)(),u=[],_=async(e,t)=>{for(const n of u){const o=n[t];o&&(await(0,a.A)(),o(e))}},m=(e,t)=>{t[d]||(t[d]=new MutationObserver((async n=>{for(const o of n)if("attributes"===o.type&&"style"===o.attributeName&&(await(0,a.A)(),"none"===t.style.display)){const t=e.querySelector(".Profile");t&&_(t,"onProfileLoadComplited")}})),t[d].observe(t,{attributes:!0}),c.A.add(t))},y=e=>{const t=e.querySelector(".Profile");return!!t&&(_(t,"onProfileLoadComplited"),!0)},A=()=>{for(const e of document.querySelectorAll(".ProfileWrapper,.ProfileWrapper__root")){_(e,"onProfileLoad");const t=e.querySelector("#profile_skeleton"),n=e.querySelector(".ProfileWrapper__root,#react_rootprofile");n?.firstChild?y(n)||n&&!n[p]&&(n[p]=new MutationObserver(((e,t)=>{y(n)&&t.disconnect()})),n[p].observe(n,{childList:!0}),c.A.add(n)):t?m(e,t):_(e,"onErrorFindSkeleton")}};let b=!1;const v=async e=>{if(u.push(e),(0,s.A)(A),b)return;b=!0;(await(0,l.A)()).subscribeOnModuleEvaluated((async()=>{await(0,i.A)(),f.cur?.module&&"profile"!==f.cur?.module||requestIdleCallback(A)}))}},47809:(e,t,n)=>{n.d(t,{A:()=>r});var o=n(4255),s=n(76299),i=n(47875),a=n(93819);class r{static async chatDetails(e){const t=Object.keys(e).filter((t=>+t>0&&0===e[t]?.can_see));if(!t.length)return;const{response:n}=await i.A.call("users.getBypassedOnlineInfo",{ids:t.join(","),json:1});for(const o of t){const t=n[o];t&&(e[o]={can_see:1,platform:t.is_online?t.platform:0,time:t.last_seen,mobile:t.is_mobile})}}static async peerStart(e,t){if(o.A.isGroupId(e)||o.A.isChatId(e)||0!==t?.can_see)return;const{response:n}=await i.A.call("users.getBypassedOnlineInfo",{ids:e,json:1}),s=n[e];s&&(t.can_see=1,t.platform=s.is_online?s.platform:0,t.time=s.last_seen,t.mobile=s.is_mobile)}static async apiUsers(e){const t=[...new Set(e.filter((e=>"number"==typeof e.id&&e.id!==vk.id&&!e.online&&!e.online_info?.visible)).map((e=>e.id)))];if(!t.length)return;const{response:n}=await i.A.call("users.getBypassedOnlineInfo",{ids:t.join(","),json:1});for(const t of e){const e=n[t.id];e&&(t.online=e.online,t.online_mobile=e.online_mobile,t.online_app=e.online_app,t.online_info={visible:!0,last_seen:e.last_seen,is_online:e.is_online,is_mobile:e.is_mobile,app_id:e.app_id},t.last_seen={platform:e.platform,time:e.last_seen})}}static async profileTooltip(e,t){if(!/^id(\d+)$/.test(e))return t;e=e.slice(2);const{response:{items:n}}=await i.A.call("users.getBypassedOnlineInfo",{ids:e,sex:1}),[o]=n;if(!o)return t;if(o&&(o.is_online||o.last_seen)){const e=o.is_mobile?'<b class="mob_onl im_status_mob_onl"></b>':"";let n="online";if(!o.is_online){const e=await a.A;n=`${e.use("vkcom_last_seen_sex",null,"raw")[1===o.sex?1:0]} ${getDateText(o.last_seen,null)}`}return n=(0,s.A)(n)+e,t.includes('class="mention_tt_row mention_tt_online"')?t.replace(/<div.*?class="mention_tt_row mention_tt_online".*?>(.*?)<\/div>/,((e,t)=>t?e.replace(t,n):e.replace("</div>",`${n}</div>`))):t.replace(/class="mention_tt_name"((.|\n)+?)<\/div>/,(e=>`${e}<div class="mention_tt_row mention_tt_online">${n}</div>`))}return t}}},49920:(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.r(t);var s=n(57580),i=n(5305),a=n(43024),r=n(2969),l=n(96446),c=n(47809),f=e([s]);s=(f.then?(await f)():f)[0];let d=null;const p=()=>{d||(d=(0,i.A)((e=>{const[t,n,o]=e;if(o)if(t.includes("al_im.php")){if("a_get_chat_details"===n.act){const{onDone:e}=o;o.onDone=async function(...t){const[{lastSeen:n}]=t;return await c.A.chatDetails(n),Reflect.apply(e,this,t)}}else if("a_start"===n.act){const{onDone:e}=o;o.onDone=async function(...t){const[{peerId:n,last_seen:o}]=t;return await c.A.peerStart(n,o),Reflect.apply(e,this,t)}}}else if(t.includes("al_wall.php")&&"mention_tt"===n.act){const{onDone:e}=o;o.onDone=async function(...t){const[o]=t;return t[0]=await c.A.profileTooltip(n.mention,o),Reflect.apply(e,this,t)}}return e})))};0,a.default.onInited((()=>{a.default.getValue("offlinebypass")&&(p(),(0,l.A)().catch(console.error),(0,r.A)().catch(console.error))})),a.default.addChangeKeyListener("offlinebypass",((e,t)=>{t?p():d&&(d(),d=null)})),o()}catch(e){o(e)}}))},2969:(e,t,n)=>{n.d(t,{A:()=>c});var o=n(90603),s=n(68284),i=n(88495),a=n(38444),r=n(47809);const l=async()=>{const e=(0,o.A)()?.store,t=e?.dispatch;if(!t)return;const n=e.getState()?.owner?.id,a=await(0,i.A)();if(!n||n===a.id)return;const l={id:n};await r.A.apiUsers([l]);for(const e of Object.keys(l)){if("id"===e)continue;t((0,s.A)(e,l[e]))}},c=async()=>{(0,a.A)({onProfileLoad:l})}},96446:(e,t,n)=>{n.d(t,{A:()=>i});var o=n(43883),s=n(47809);const i=async()=>{const e=await(0,o.A)(),t=e.api;e.api=async(...n)=>{const o=await Reflect.apply(t,e,n);try{const e=[];if(Array.isArray(o?.profiles)&&e.push(...o.profiles),Array.isArray(o))for(const t of o)Array.isArray(t?.profiles)&&e.push(...t.profiles);e.length&&await s.A.apiUsers(e)}catch(e){console.error(e)}return o}}},76299:(e,t,n)=>{n.d(t,{A:()=>i});var o=n(42838);const s=document.createElement("textarea"),i=e=>(s.innerText=(0,o.sanitize)(e),s.innerHTML)}}]);