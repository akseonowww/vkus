"use strict";(globalThis.webpackChunkvknext=globalThis.webpackChunkvknext||[]).push([[8975,122],{14694:(t,e,a)=>{a.d(e,{A:()=>s});const s=()=>"https://api.vknext.net"},88400:(t,e,a)=>{a.d(e,{A:()=>s});const s=async t=>{const e=await t.json(),s=t.headers.get("Content-Type");if(s&&s.startsWith("application/x-vknextpack")&&e)try{const t=new Uint8Array(Object.values(e)),{decode:s}=await a.e(7802).then(a.bind(a,77802));return s(t)}catch(t){console.error(t)}return e}},46140:(t,e,a)=>{a.d(e,{A:()=>u});var s=a(22440),n=a(82050),r=a(98570),i=a(75412);const o=(0,s.A)(),c=async t=>{const e=(0,r.A)().browserApi;if(e){return(await e.storage.local.get(t))[t]}if(o?.localStorage)return o.localStorage.getItem(t);const{storage:s}=await a.e(6815).then(a.t.bind(a,96815,23));return(await s.local.get(t))[t]},d=async(t,e)=>{const s=(0,r.A)().browserApi;if(s)return void await s.storage.local.set({[t]:e});if(o?.localStorage)return void o.localStorage.setItem(t,e);const{storage:n}=await a.e(6815).then(a.t.bind(a,96815,23));await n.local.set({[t]:e})},l=async(t,e)=>{const a=`vknLP${t}`,s=`vknLPD${t}`,r=await c(a),o=await c(s);if(r&&Date.now()-(parseInt(o||"")||0)<216e5)return r?.response||r;try{const{view_url:r}=await e.apps.getEmbeddedUrl({app_id:await(0,i.A)(),v:"5.123"});if(!r)return await(0,n.A)(5e3),l(t,e);const o=r.split("?")[1].split("#")[0];return await d(a,o),await d(s,Date.now().toString()),o}catch(a){return console.error(a),await(0,n.A)(1500),l(t,e)}},u=l},47961:(t,e,a)=>{a.d(e,{A:()=>n});var s=a(387);const n=async(t,e,a)=>{try{delete Uint8Array.prototype.toJSON}catch(t){console.error(t)}const n=(0,s.A)(),r=((t,e)=>{const a=t.toString().length,s=new Uint8Array(16);for(let n=0;n<e.length;n++){const r=e.charCodeAt(n)*t/a;s[n%16]^=255&r}return s})(t,e),i=await(t=>crypto.subtle.importKey("raw",t,{name:"AES-CBC"},!1,["encrypt"]))(r),o={version:await a.getVersion(),udGltZS5p:await a.getRuntimeId(),cGlkb3I:t,fdhjiD:"ba05681e16c97c31e1be20e84f250d55",v9Cdi3sD:n},c=JSON.stringify(o),d=(new TextEncoder).encode(c),l={name:"AES-CBC",iv:crypto.getRandomValues(new Uint8Array(16))},u=await crypto.subtle.encrypt(l,i,d),p=new Uint8Array(l.iv.length+u.byteLength);return p.set(new Uint8Array(l.iv),0),p.set(new Uint8Array(u),l.iv.length),p}},75412:(t,e,a)=>{a.d(e,{A:()=>n});var s=a(14694);const n=async()=>{try{const t=await fetch(`${(0,s.A)()}/internal.getAuthAppId`,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json","Api-Version":"3"}});if(t.ok)return parseInt(await t.text())}catch(t){console.error("[VK Next/getAuthAppId] Error:",t)}return 8194076}},24370:(t,e,a)=>{a.d(e,{Q:()=>c});var s=a(82050),n=a(14694),r=a(88400),i=a(46140),o=a(47961);class c{vkapi;vkAgents;userId;constructor({api:t}){this.vkapi=t,this.userId=0,this.vkAgents=new Map}async call(t,e,a){const i=await this.getVkAgent(),o={...e,"vknext-agent":await this.gvkna()};let c=0;const d=`${(0,n.A)()}/${t}`,l=JSON.stringify(o),u={Accept:"application/json","Content-Type":"application/json","VK-Agent":i,"VK-User-ID":`${this.userId||0}`,"9603a224b40d7b67210b78f2e390d00f":"ba05681e16c97c31e1be20e84f250d55","Api-Version":"3",...a};let p=new Response(JSON.stringify({error_code:408}),{status:408});for(;c<3;){const t=new AbortController,e=setTimeout((()=>t.abort()),15e3);try{if(p=await fetch(d,{body:l,method:"POST",headers:u,signal:t.signal}),502!==p.status)return(0,r.A)(p);{await(0,s.A)(2e3);const t=await p.text();if(!t.toLowerCase().includes("cloudflare"))return(0,r.A)(p);await(0,s.A)(c)}}catch(t){console.error(t),await(0,s.A)(2e3)}clearTimeout(e),c++}return(0,r.A)(p)}async getVkAgent(){if(0===this.userId&&(this.userId=await this.getUserId()),this.vkAgents.has(this.userId))return this.vkAgents.get(this.userId);return(0,i.A)(this.userId,this.vkapi)}async gvkna(){return await(0,o.A)(this.userId,"ba05681e16c97c31e1be20e84f250d55",this)}resetUserId(){this.userId=0}async getUserId(){return 0}async getRuntimeId(){return""}async getVersion(){return""}}},23878:(t,e,a)=>{a.d(e,{A:()=>r});const s=async({app_id:t,scope:e="",access_token:a,force:s=0})=>{const n=new URLSearchParams({scope:e.toString(),app_id:t.toString(),access_token:a,force:s.toString()}),r=await fetch(`https://id.vk.com/mini_app_token?${n}`,{method:"GET",credentials:"include"});return await r.json()};var n=a(87251);const r=async t=>{const e=await n.default._getToken(),r=n.default.user_id,i=await s({...t,access_token:e});if("response"in i&&i?.response?.access_token){const e=i.response.access_token,s=(await a.e(9817).then(a.bind(a,69817))).default,n=await s.getStorage()||{};n[r]||(n[r]={}),n[r][t.app_id]={token:e},await s.setStorage(n)}return i}},70122:(t,e,a)=>{a.r(e),a.d(e,{default:()=>c});var s=a(98570),n=a(24370),r=a(87251);const i=new n.Q({api:r.default});let o=!1;i.getUserId=async()=>"number"==typeof window.vk?.id?window.vk.id:o?await new Promise((t=>{const e=setInterval((()=>{o||(t(r.default.user_id),clearInterval(e))}),200)})):(r.default.user_id||(o=!0,await r.default.forceUpdateToken(),o=!1),r.default.user_id),i.getRuntimeId=async()=>{const{getManifest:t}=(0,s.A)().browserApi;return t().id},i.getVersion=async()=>{const{getManifest:t}=(0,s.A)().browserApi;return t().version};const c=i},69541:(t,e,a)=>{a.d(e,{A:()=>d});var s=a(74848),n=a(57087),r=a(39107);const i="N_g1H4Nhw_pSSmdY",o="Xdpm9PB7Wq29dybv",c=({item:t,children:e,className:a,...c})=>{const{viewer:d}=(0,n.ur)(),{id:l,name:u,images:p}=t,w=d?.image_status?.id===l||void 0;return(0,s.jsxs)(r.SB4,{className:(0,r.xWm)(i,a),activated:w,...c,children:[(0,s.jsx)("img",{src:p[0]?.url,className:o}),(0,s.jsx)(r.EYj,{children:u}),e]})};c.Skeleton=()=>(0,s.jsxs)(r.SB4,{className:i,children:[(0,s.jsx)(r.EAD,{width:24,height:24,borderRadius:"50%",className:o}),(0,s.jsx)(r.EYj,{children:(0,s.jsx)(r.EAD,{width:"7rem"})})]});const d=c},404:(t,e,a)=>{a.d(e,{A:()=>r});var s=a(74848);const n="d2Yh7R5YAaDVMi8A",r=({children:t})=>(0,s.jsx)("div",{className:n,children:t})},68975:(t,e,a)=>{a.a(t,(async(t,s)=>{try{a.r(e),a.d(e,{default:()=>k});var n=a(74848),r=a(82295),i=a(23878),o=a(70122),c=a(1883),d=a(61699),l=a(8015),u=a(57087),p=a(82050),w=a(48081),g=a(39107),h=a(96540),A=a(74225),f=a.n(A),m=a(69541),y=a(404),_=t([l]);l=(_.then?(await _)():_)[0];const v=({appId:t})=>{const e=(0,l.A)(),{viewer:s,forceUpdateViewer:c}=(0,u.ur)(),[A,_]=(0,h.useState)(null),[v,k]=(0,h.useState)(null),b=(0,w.Gz)(),{showSnackbar:j,hideSnackbar:x}=(0,u.Qs)(),[I,S]=(0,h.useState)(!1),{createTab:C}=(0,d.A)();(0,h.useEffect)((()=>{_(null),S(!1)}),[t]);const T=(0,h.useCallback)((async()=>(0,(await a.e(4547).then(a.bind(a,94547))).default)({getDefaultToken:()=>{t&&(0,i.A)({app_id:t}).then((t=>{("error"in t||"response"in t&&!1===t.response.status)&&S(!0)}))},appId:t,userId:s?.id||0})),[t,s?.id]),U=(0,h.useCallback)((async({id:a,images:i,name:o})=>{await b.showPopout((0,n.jsx)(g.WHT,{state:"loading"}));const d=await T(),l=s?.image_status?.id===a?0:a;if((await d.call(v?.set?.[t]||"status.setImage",{status_id:l})).error)return await b.showPopout((0,n.jsx)(g.WHT,{state:"error"})),(0,p.A)(1e3).then((()=>b.hidePopout())),void j((0,n.jsx)(g.qb_,{onClose:x,duration:5e3,action:e.use("settings_emoji_status_action"),onActionClick:()=>{C({url:`https://${r.A}/app${t}`})},children:e.use("settings_emoji_status_set_error")}));await c(),await b.showPopout((0,n.jsx)(g.WHT,{state:"done"})),(0,p.A)(1e3).then((()=>b.hidePopout()));const u=i.at(-1)?.url||i[0]?.url;j((0,n.jsx)(g.qb_,{duration:2e3,onClose:x,before:u&&(0,n.jsx)("img",{width:24,height:24,src:u}),children:e.use(0===l?"settings_emoji_status_deleted":"settings_emoji_status_set",{emojiName:o})}))}),[v,T,b,j,x,t,s?.image_status?.id,c]);return f()((async t=>{const e=await o.default.call("status.getMethods");t()&&k(e||{})}),[]),f()((async e=>{if(!s)return;if(null===v)return;const a=await T();let{items:n}=await a.call(v.default||"status.getImageList",{});if(v.get?.[t]){const e=await a.call(v.get[t],{}),s=new Set;for(const t of n)s.add(t);for(const t of e.items)Array.isArray(t.images)||(t.images=Object.values(t.images).map((t=>({url:t})))),t.name||(t.name=t.title),s.add(t);n=Array.from(s).reverse()}e()&&_(n)}),[t,s,v]),I?(0,n.jsx)(g.OrA,{title:e.use("settings_emoji_status_error_getting_title"),children:e.use("settings_emoji_status_error_getting_text")}):A?0===A.length?(0,n.jsx)(g.OrA,{children:e.use("global_not_found")}):(0,n.jsx)(y.A,{children:A.map((e=>(0,n.jsx)(m.A,{"data-test":`cell${t}_${e.id}`,item:e,onClick:()=>U(e)},`cell${t}_${e.id}`)))}):(0,n.jsx)(y.A,{children:new Array(21).fill(1).map(((e,a)=>(0,n.jsx)(m.A.Skeleton,{},`app${t}-skeleton${a}`)))})},k=()=>{const t=(0,l.A)(),{appId:e}=(0,w.g)()??{};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(g.aOn,{children:t.use("settings_menu_emoji_status_title")}),(0,n.jsx)(c.A,{children:(0,n.jsx)(v,{appId:Number(e)},e)})]})};s()}catch(t){s(t)}}))},22440:(t,e,a)=>{a.d(e,{A:()=>s});const s=()=>"undefined"!=typeof unsafeWindow?unsafeWindow:"undefined"!=typeof window?window:globalThis}}]);