"use strict";(globalThis.webpackChunkvknext=globalThis.webpackChunkvknext||[]).push([[8287,5544],{3881:(e,t,n)=>{n.d(t,{T:()=>o});var o=(0,n(93543).mT)("Icon24AddOutline","add_outline_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="add_outline_24"><g fill="none" fill-rule="evenodd"><path d="M0 0h24v24H0z" /><path fill="currentColor" fill-rule="nonzero" d="M12 3a.9.9 0 0 1 .9.9v7.2h7.2a.9.9 0 1 1 0 1.8l-7.2-.001V20.1a.9.9 0 1 1-1.8 0V12.9l-7.2.001a.9.9 0 1 1 0-1.8h7.2V3.9A.9.9 0 0 1 12 3" /></g></symbol>',24,24,!1,void 0)},50767:(e,t,n)=>{n.d(t,{P:()=>o});var o=(0,n(93543).mT)("Icon24DeleteOutline","delete_outline_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" id="delete_outline_24"><path fill-rule="evenodd" d="M14.556 8.102a.9.9 0 0 1 .842.954l-.5 8a.9.9 0 0 1-1.796-.112l.5-8a.9.9 0 0 1 .954-.842m-5.112 0a.9.9 0 0 0-.842.954l.5 8a.9.9 0 1 0 1.796-.112l-.5-8a.9.9 0 0 0-.954-.842" clip-rule="evenodd" /><path fill-rule="evenodd" d="M3 4.1a.9.9 0 1 0 0 1.8h1.18l1.155 12.316c.045.484.084.898.143 1.237.062.359.157.704.351 1.03a2.9 2.9 0 0 0 1.249 1.137c.342.162.695.225 1.057.253.344.027.76.027 1.246.027h5.238c.486 0 .902 0 1.246-.027.362-.028.715-.09 1.057-.253a2.9 2.9 0 0 0 1.249-1.137c.194-.326.289-.671.35-1.03.06-.34.099-.753.144-1.237L19.82 5.9H21a.9.9 0 1 0 0-1.8h-5.204a3.901 3.901 0 0 0-7.592 0zm4.124 13.915c.05.526.082.869.128 1.13.043.252.087.356.124.417a1.1 1.1 0 0 0 .474.432c.064.03.172.065.426.085.265.02.61.021 1.138.021h5.172c.528 0 .873 0 1.138-.021.254-.02.362-.055.426-.085a1.1 1.1 0 0 0 .474-.432c.037-.06.08-.166.124-.416.046-.262.079-.605.128-1.131L18.012 5.9H5.988zM12 2.9a2.1 2.1 0 0 0-1.898 1.2h3.796A2.1 2.1 0 0 0 12 2.9" clip-rule="evenodd" /></symbol>',24,24,!1,void 0)},48513:(e,t,n)=>{n.d(t,{V:()=>o});var o=(0,n(93543).mT)("Icon24MusicOutline","music_outline_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" id="music_outline_24"><path fill="currentColor" fill-rule="evenodd" d="M16.716 4.105c.61-.127 1.01-.21 1.317-.246.299-.036.408-.013.457.004a.9.9 0 0 1 .485.395c.026.043.07.146.097.446.027.304.028.705.028 1.314L8.9 8.143v-.54c0-.477 0-.786.018-1.024.017-.228.046-.328.073-.39a1.1 1.1 0 0 1 .374-.46c.055-.039.147-.088.366-.15.23-.067.533-.13 1-.227zM7.1 15.1h-.2c-1.795 0-3.125.452-4.02 1.215-.903.768-1.28 1.782-1.28 2.71A3.375 3.375 0 0 0 4.975 22.4c.928 0 1.942-.377 2.71-1.28.763-.895 1.215-2.225 1.215-4.02V9.982l10.2-2.125V13.1h-.2c-1.795 0-3.125.452-4.021 1.215-.902.768-1.279 1.782-1.279 2.71a3.375 3.375 0 0 0 3.375 3.375c.928 0 1.942-.377 2.71-1.28.763-.895 1.215-2.225 1.215-4.02V6.004c0-.573 0-1.061-.035-1.457-.036-.412-.116-.824-.34-1.204a2.7 2.7 0 0 0-1.457-1.185c-.417-.141-.836-.135-1.247-.087-.395.047-.873.147-1.434.264l-.038.007-5.985 1.247-.03.007c-.429.089-.797.166-1.099.252-.32.092-.624.21-.908.41a2.9 2.9 0 0 0-.987 1.214c-.139.32-.192.642-.217.974-.023.313-.023.689-.023 1.126v.031zm8.946.585c-.473.403-.646.901-.646 1.34 0 .87.705 1.575 1.575 1.575.439 0 .937-.173 1.34-.646.408-.479.785-1.349.785-2.854v-.2h-.2c-1.505 0-2.375.377-2.854.785M3.4 19.025c0-.439.173-.937.646-1.34.479-.408 1.349-.785 2.854-.785h.2v.2c0 1.505-.377 2.375-.785 2.854-.403.473-.901.646-1.34.646-.87 0-1.575-.705-1.575-1.575" clip-rule="evenodd" /></symbol>',24,24,!1,void 0)},38121:(e,t,n)=>{n.d(t,{A:()=>c});var o=n(35277);const r=async e=>{try{const t=await(0,o._)({blob:e,filename:e.name,type:"convertAudioToMono"});return new File([t],e.name,{type:"audio/mp3"})}catch(e){console.error("convertAudioToMono",e)}return e};var a=n(43883),s=n(52968);const c=class{api;constructor(e){this.api=e}async uploadVoice(e,{convertToMono:t}={convertToMono:!0}){t||console.warn("[Uploader] convert to mono is disabled");const n=t?await r(e):e,o=new FormData;o.append("file",n);const{upload_url:c}=await this.api("messages.getAudioMessageUploadServer",{group_id:Math.abs((0,s.A)())}),i=await fetch(c,{method:"POST",body:o}).then((e=>e.text())),d=await(0,a.A)(),l=await d.api("messages.saveAudioMessage",{file:i});return{ownerId:l.owner_id,id:l.id,accessKey:l.access_key,duration:l.duration,linkMp3:l.link_mp3,linkOgg:l.link_ogg,waveform:l.waveform}}}},51005:(e,t,n)=>{n.d(t,{A:()=>i});var o=n(22440),r=n(82050),a=n(2519),s=n(44497);const c=(0,o.A)(),i=async(e,t=(0,s.A)())=>{if(c.cur.lastAddMedia&&!c.vkmeIntegration){const t=c.cur.lastAddMedia.onChange;try{if(c.cur.lastAddMedia.onChange=async function(...e){const n=e[0];if(c.cur.lastAddMedia.onChange=t,t&&Reflect.apply(t,this,e),"doc"!==n)return;const o=`._im_text_wrap .im-send-btn, #reply_button${c.cur.editing}, #reply_button${c.cur.oid}_${c.cur.pid}`,a=document.body.querySelector(o);a?.onclick?(await(0,r.A)(200),a.onclick()):a?.click()},c.cur.chooseMedia("doc",[e.ownerId,e.id].join("_"),{}),!c.vkmeIntegration)return}catch(e){console.error(e)}}(await(0,a.A)()).store.dispatch({peerId:t,type:"UserChangedComposerDraft",kind:"addAttaches",attaches:{voice:{kind:"Voice",id:e.id,ownerId:e.ownerId,duration:e.duration||0,waveform:e.waveform,linkMp3:e.linkMp3,linkOgg:e.linkOgg}}}),await(0,r.A)(200),document.querySelector(".Composer__button.Composer__button--submit,.ConvoComposer__button.ConvoComposer__sendButton--submit")?.click()}},84833:(e,t,n)=>{n.d(t,{A:()=>c});var o=n(74848),r=n(39107),a=n(96540),s=n(17100);const c=({children:e,noClose:t=!1,...n})=>{const{open:c,setOpen:i,onClose:d,onClosed:l,onOpen:u,onOpened:p}=(0,s.Fs)(),m=(0,a.useId)();return(0,o.jsx)(r.VWm,{nav:m,open:c,onClose:(e,n)=>{t||(i(!1),d?.(e,n))},onClosed:l,onOpen:u,onOpened:p,...n,children:(0,o.jsx)(a.Suspense,{fallback:(0,o.jsx)(r.qBl,{}),children:e})})}},67078:(e,t,n)=>{n.d(t,{A:()=>c});var o=n(74848),r=n(3068),a=n(75511);const s=document.createElement("div");s.className=a.A.Snackbars;const c=async e=>{const t=(await Promise.all([n.e(2551),n.e(7983),n.e(2020),n.e(3543),n.e(7759)]).then(n.bind(n,28582))).default;document.body.contains(s)||document.body.appendChild(s);const a=document.createElement("div");s.appendChild(a);const{unmount:c}=await(0,r.A)({root:a,content:(0,o.jsx)(t,{onClose:()=>{c(),a.remove(),0===s.children.length&&s.remove()},...e}),disableParentTransformForPositionFixedElements:!0,noStyling:!0})}},9796:(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{A:()=>g});var r=n(74848),a=n(48513),s=n(50767),c=n(39107),i=n(96540),d=n(74225),l=n.n(d),u=n(43027),p=n(51005),m=n(55517),h=n(87675),w=n(1003),f=e([h]);h=(f.then?(await f)():f)[0];const v=({audios:e,setAudioMessages:t})=>{const o=(0,h.A)(),i=(0,m.A)();return null===e?(0,r.jsx)(A,{}):0===e?.length?(0,r.jsx)(c.OrA,{children:o.use("global_not_found")}):(0,r.jsx)("div",{children:e.map(((d,l)=>{const m=`${d.owner_id}_${d.id}`;return(0,r.jsx)(c.T6P,{subtitle:o.use("vkcom_add_date",{date:window.getDateText(d.time,null)}),onClick:()=>(0,p.A)({id:d.id,ownerId:d.owner_id,accessKey:d.access_key},i),before:(0,r.jsx)(a.V,{}),after:(0,r.jsx)(c.K0,{activeMode:"opacity",style:{color:"var(--vkui--color_text_negative)"},"aria-label":o.use("global_remove"),onClick:async o=>{(0,u.A)(o);const{default:r}=await n.e(2827).then(n.bind(n,22827)),a=[...e];a.splice(l,1),await r.setAudios((0,w.A)(),a),t(a)},children:(0,r.jsx)(s.P,{})}),children:d.name},m)}))})},A=()=>{const e=[...Array(10).keys()];return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(c.KzX,{size:12,children:(0,r.jsx)(c.wvv,{})}),e.map((e=>(0,r.jsx)(c.T6P,{subtitle:(0,r.jsx)(c.EAD,{width:70}),before:(0,r.jsx)(c.EAD,{borderRadius:"50%",width:28,height:28,style:{marginLeft:4,marginRight:16}}),children:(0,r.jsx)(c.EAD,{width:150})},e)))]})},g=()=>{const e=(0,i.useRef)(null),[t,o]=(0,i.useState)(null),[a,s]=(0,i.useState)("");(0,i.useEffect)((()=>{e.current&&e.current.focus()}),[e]),l()((async e=>{const t=(await n.e(2827).then(n.bind(n,22827))).default,r=await t.getAudios((0,w.A)());e()&&o(r.reverse())}),[]);const d=(0,i.useCallback)((()=>{if(!t)return t;if(0===a.trim().length)return t;return t.filter((({name:e})=>e.toLowerCase().indexOf(a.toLowerCase())>-1))}),[t,a]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(c.vji,{getRef:e,after:null,value:a,onChange:e=>{s(e.target.value)}}),(0,r.jsx)(v,{audios:d(),setAudioMessages:o})]})};o()}catch(e){o(e)}}))},17158:(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{A:()=>A});var r=n(74848),a=n(82050),s=n(387),c=n(3881),i=n(39107),d=n(96540),l=n(38121),u=n(51005),p=n(67078),m=n(55517),h=n(87675),w=n(1003),f=n(23155),v=e([h]);h=(v.then?(await v)():v)[0];const A=()=>{const e=(0,h.A)(),t=(0,d.useRef)(null),[o,v]=(0,d.useState)(null),A=(0,m.A)();return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(i.DzN,{centered:!0,before:(0,r.jsx)(c.T,{}),onClick:()=>t.current?.click(),children:[e.use("vkcom_upload_new_file"),(0,r.jsx)(i.s6o,{Component:"input",getRootRef:t,type:"file",accept:f.A.join(","),onChange:async t=>{const o=t.target.files?.[0];if(!o)return v((0,r.jsx)(i.WHT,{state:"error"})),await(0,a.A)(1e3),void v(null);v((0,r.jsx)(i.WHT,{state:"loading"}));try{t.target.value="";const e=new l.A(window.vkApi.api),c=await e.uploadVoice(o);await(0,u.A)(c,A),v((0,r.jsx)(i.WHT,{state:"done"})),await(0,a.A)(1e3),v(null);const d=(await n.e(2827).then(n.bind(n,22827))).default,p=await d.getAudios((0,w.A)());p.push({owner_id:c.ownerId,id:c.id,access_key:c.accessKey,name:o.name,time:(0,s.A)()}),await d.setAudios((0,w.A)(),p)}catch(t){await(0,p.A)({type:"error",text:`${e.use("global_error")}: ${t.message}`}),v((0,r.jsx)(i.WHT,{state:"error"})),await(0,a.A)(1e3),v(null)}}})]}),o]})};o()}catch(e){o(e)}}))},2161:(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{A:()=>d});var r=n(74848),a=n(39107),s=n(9796),c=n(17158),i=e([s,c]);[s,c]=i.then?(await i)():i;const d=()=>(0,r.jsxs)(a.iau,{children:[(0,r.jsx)(c.A,{}),(0,r.jsx)(s.A,{})]});o()}catch(e){o(e)}}))},23155:(e,t,n)=>{n.d(t,{A:()=>o});const o=["audio/mp3","audio/ogg","audio/wav","audio/mpeg","audio/flac","audio/aac","audio/m4a","audio/mp4","audio/x-m4a"]},88726:(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{default:()=>l});var r=n(74848),a=n(39107),s=n(84833),c=n(87675),i=n(2161),d=e([c,i]);[c,i]=d.then?(await d)():d;const l=()=>{const e=(0,c.A)();return(0,r.jsx)(s.A,{size:600,header:(0,r.jsx)(a.aO9,{children:e.use("vkcom_send_audio_message")}),children:(0,r.jsx)(i.A,{})})};o()}catch(e){o(e)}}))},55517:(e,t,n)=>{n.d(t,{A:()=>i});var o=n(22440),r=n(96540),a=n(5679),s=n(44497);const c=(0,o.A)(),i=()=>{const[e,t]=(0,r.useState)(c.cur?.peer||(0,s.A)());return(0,r.useEffect)((()=>{if(c.vkmeIntegration)return(0,a.A)((e=>{"UserOpenedConvo"===e.type&&t(e.peerId),"UserClosedConvo"===e.type&&t(0)}))}),[]),(0,r.useEffect)((()=>{if(c.vkmeIntegration)return;return c.nav.onLocationChange((()=>{e!==c.cur.peer&&c.cur.peer&&t(c.cur.peer)}))}),[]),e}},87675:(e,t,n)=>{n.a(e,(async(e,o)=>{try{n.d(t,{A:()=>a});var r=n(93819);const e=await r.A,a=()=>e;o()}catch(e){o(e)}}),1)},52968:(e,t,n)=>{n.d(t,{A:()=>a});var o=n(4255),r=n(1003);const a=()=>{if(window.cur.gid&&o.A.isGroupId(window.cur.gid))return window.cur.gid;const e=(0,r.A)();return o.A.isGroupId(e)?e:0}},5679:(e,t,n)=>{n.d(t,{A:()=>i});var o=n(67992),r=n(2519);const a=new o.A,s=new o.A,c=async()=>{(e=>{if(e._meAppHooked)return;e._meAppHooked=!0;const t=e.store.dispatch;let n=e.store.getState()?.ownerId;e.store.dispatch=function(...o){const[r]=o;n||(n=e.store.getState()?.ownerId);let c=!1;for(const e of s.listeners)try{const t=e(r);"boolean"==typeof t&&t&&(c=!0)}catch(e){console.error(e)}if(c)return;const i=Reflect.apply(t,e.store,o);for(const e of a.listeners)try{e(r)}catch(e){console.error(e)}return i}})(await(0,r.A)())},i=(e,t=!1)=>{const n=(t?a:s).addListener(e);return c(),n}},44497:(e,t,n)=>{n.d(t,{A:()=>o});const o=()=>{const e=window.location.pathname.match(/\/convo\/(-?\d+)/);if(e)return Number(e[1])||0;const t=new URLSearchParams(window.location.search),n=Number(t.get("sel"));return n||0}},43027:(e,t,n)=>{n.d(t,{A:()=>o});const o=e=>{e.preventDefault?.(),e.stopPropagation?.(),e.stopImmediatePropagation?.()}},75511:(e,t,n)=>{n.d(t,{A:()=>o});const o={Snackbars:"fuEF5ymRhcBAxInE",BaseSnackbar:"Fu47p889xWCKEooV"}},40961:(e,t,n)=>{!function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(e){console.error(e)}}(),e.exports=n(22551)},74225:(e,t,n)=>{var o=n(96540);function r(e,t,n){var r="function"==typeof t;o.useEffect((function(){var n,o=!0,a=e((function(){return o}));return Promise.resolve(a).then((function(e){n=e})),function(){o=!1,r&&t(n)}}),r?n:t)}e.exports=r,e.exports.useAsyncEffect=r},55073:(e,t,n)=>{n.d(t,{c:()=>o});const o=()=>{let e,t;return{promise:new Promise(((n,o)=>{e=n,t=o})),resolve:e,reject:t}}},35277:(e,t,n)=>{n.d(t,{_:()=>d});var o=n(55073);const r=e=>new Promise((t=>setTimeout(t,e)));let a,s=null,c=0;const i=async()=>{a||(a=(async()=>{if(await r(6e4),!s)return;const e=await s;e&&(0===c&&await r(1e4),0===c&&(s=null,e.remove()))})(),a.finally((()=>{a=null})))},d=async({onProgress:e,type:t,iframeURL:r="https://vknext.net/ffmpeg",...a})=>{const{promise:d,reject:l,resolve:u}=(0,o.c)(),p="request-"+Math.random().toString(36).substr(2,9),m=await(e=>{if(s)return s;const{promise:t,resolve:n,reject:r}=(0,o.c)();s=t;const a=document.querySelector(`iframe[src="${e}"]`);if(a)return n(a),t;const c=document.createElement("iframe");return c.src=e,c.style.setProperty("display","none","important"),c.onload=()=>n(c),c.onerror=r,(document.body||document.documentElement).appendChild(c),t})(r),{Bridge:h}=await n.e(2692).then(n.bind(n,42692)),w=new h(m.contentWindow,{prefix:"vknext-net-bridge"});return c++,e&&w.on("progress",(t=>{const n=t;n?.requestId===p&&e(n.progress,n.total)})),w.on("error",(e=>{const t=e;t?.requestId===p&&(l(t?.error||"unknown error"),w.destroy(),c--,i())})),w.on("response",(e=>{const t=e;t?.requestId===p&&(u(t.response),w.destroy(),c--,i())})),w.on("getBlob",(e=>{const t=e;if(t?.requestId===p)return fetch(t.url).then((e=>e.blob()))})),w.post(t,{...a,requestId:p}),d}}}]);