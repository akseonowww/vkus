"use strict";(globalThis.webpackChunkvknext=globalThis.webpackChunkvknext||[]).push([[3627],{36008:(e,s,n)=>{n.d(s,{default:()=>a});const t=class{SOURCE_NAME="vkcom-vkn-13";messageHandlers=new Map;pendingMessages=new Map;messageHandler;constructor(){this.messageHandler=async e=>{if(e.origin!==window.origin)return;const s=e.data;if(s?.source!==this.SOURCE_NAME)return;const{type:n,payload:t,id:a,answer:r}=s;if(!0!==r)for(const e of this.messageHandlers.get(n)||[]){const s=e=>{window.postMessage({source:this.SOURCE_NAME,type:n,payload:e,id:a,answer:!0},window.origin)};try{await e(t,s)}catch(e){console.error(e)}}else for(const e of this.pendingMessages.get(a)||[])e&&(e.resolve(t),this.pendingMessages.delete(a))},window.addEventListener("message",this.messageHandler)}sendMessage(e,s){const n=this.generateUniqueId(),t=new Promise((e=>{const s=this.pendingMessages.get(n)||[];s.push({resolve:e}),this.pendingMessages.set(n,s)}));return window.postMessage({source:this.SOURCE_NAME,type:e,payload:s,id:n,answer:!1},window.origin),t}addMessageHandler(e,s){const n=this.messageHandlers.get(e)||[];return n.push(s),this.messageHandlers.set(e,n),()=>this.removeMessageHandler(e,s)}removeMessageHandler(e,s){const n=this.messageHandlers.get(e)||[],t=n.indexOf(s);-1!==t&&n.splice(t,1),this.messageHandlers.set(e,n)}requestCount=0;generateUniqueId(){return this.requestCount++}};n(96708);const a=new class extends t{sendMessage(e,s){return super.sendMessage(e,s)}}},96708:(e,s,n)=>{n.d(s,{r:()=>a});const t=new BroadcastChannel("vknext");t.addEventListener("message",(({data:e})=>{if("object"==typeof e&&"vkb_rp"===e.t)window.location.reload()}));const a=t}}]);