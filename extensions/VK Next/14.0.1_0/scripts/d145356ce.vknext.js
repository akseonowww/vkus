"use strict";(globalThis.webpackChunkvknext=globalThis.webpackChunkvknext||[]).push([[119],{119:(e,t,s)=>{s.a(e,(async(e,r)=>{try{s.r(t);var o=s(57580),a=s(99381),n=s(52968),c=s(2519),d=s(5679),i=s(11860),p=s(37573),u=s(43024),l=e([o]);o=(l.then?(await l)():l)[0];const A=new Set,h=new Map;(0,d.A)((e=>{switch(e.type){case"UserChangedConvo":"mark_read"===e?.userAction&&(A.add(e.peerId),h.has(e.peerId)||h.set(e.peerId,setTimeout((()=>{A.delete(e.peerId),h.delete(e.peerId)}),1500)));break;case"UserSeenMessages_ThrottleTimedOut":case"UserSeenMessages_RequestCompleted":case"UserSeenMessages":if((0,i.A)(e.peerId,Math.abs((0,n.A)())))return!0;break;case"UserPlayedMessage_RequestCompleted":case"UserPlayedMessage":if(u.default.getValue("silentListen"))return!0}return!1}));const w=e=>{if(e?._actAppHooked)return;e._actAppHooked=!0;const t=e.browserEnv.api.fetch;e.browserEnv.api.fetch=function(e,s,...r){let o=!1;return"messages.setActivity"===e&&(0,p.A)(s?.peer_id,s?.group_id)&&(o=!0),"messages.markAsRead"===e&&!A.has(s?.peer_id)&&(0,i.A)(s?.peer_id,s?.group_id)&&(o=!0),o?new Promise(a.A):Reflect.apply(t,this,[e,s,...r])}};0,(async()=>{w(await(0,c.A)())})().catch(console.error),r()}catch(e){r(e)}}))},52968:(e,t,s)=>{s.d(t,{A:()=>a});var r=s(4255),o=s(1003);const a=()=>{if(window.cur.gid&&r.A.isGroupId(window.cur.gid))return window.cur.gid;const e=(0,o.A)();return r.A.isGroupId(e)?e:0}},5679:(e,t,s)=>{s.d(t,{A:()=>d});var r=s(67992),o=s(2519);const a=new r.A,n=new r.A,c=async()=>{(e=>{if(e._meAppHooked)return;e._meAppHooked=!0;const t=e.store.dispatch;let s=e.store.getState()?.ownerId;e.store.dispatch=function(...r){const[o]=r;s||(s=e.store.getState()?.ownerId);let c=!1;for(const e of n.listeners)try{const t=e(o);"boolean"==typeof t&&t&&(c=!0)}catch(e){console.error(e)}if(c)return;const d=Reflect.apply(t,e.store,r);for(const e of a.listeners)try{e(o)}catch(e){console.error(e)}return d}})(await(0,o.A)())},d=(e,t=!1)=>{const s=(t?a:n).addListener(e);return c(),s}}}]);