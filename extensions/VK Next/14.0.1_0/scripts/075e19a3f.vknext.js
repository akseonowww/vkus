"use strict";(globalThis.webpackChunkvknext=globalThis.webpackChunkvknext||[]).push([[7292],{8155:(e,t,n)=>{n.d(t,{A:()=>r});var s=n(65578);const r=()=>(0,s.A)("Stories","web/stories.js")},13674:(e,t,n)=>{n.d(t,{A:()=>i});var s=n(84060),r=n(79068),o=n(67992);const i=e=>{const t=new o.A,n=n=>{let s=n[e];Object.defineProperty(n,e,{get:()=>s,set:e=>{s=e;for(const e of t.listeners)try{e(s)}catch(e){console.error(e)}return!0},configurable:!0,enumerable:!0})};let i=!1;const a=async o=>{i||(i=!0,await(async()=>{let o=await(0,s.A)();n(o),(0,r.A)((s=>{if(o[e]!==s[e])for(const n of t.listeners)try{n(s[e])}catch(e){console.error(e)}n(s),o=s}))})());o((await(0,s.A)())[e])};return e=>{const n=t.addListener(e);return a(e),n}}},79068:(e,t,n)=>{n.d(t,{A:()=>c});var s=n(67992),r=n(84060);const o=new s.A;let i=!1;const a=async e=>{i?await(0,r.A)():(i=!0,await(async()=>{let e=await(0,r.A)();Object.defineProperty(window,"cur",{get:()=>e,set:t=>{e=t;for(const e of o.listeners)try{e(t)}catch(e){console.error(e)}return!0},configurable:!0})})()),e(window.cur)},c=e=>{const t=o.addListener(e);return a(e),t}},8362:(e,t,n)=>{n.d(t,{A:()=>s});const s=(0,n(13674).A)("storyLayer")},9794:(e,t,n)=>{n.a(e,(async(e,s)=>{try{n.d(t,{A:()=>l});var r=n(387),o=n(26555),i=n(52352),a=n(93819);const e=await a.A;let c=0;class d{id;listeners=new Map;icon;title;subtitle;progressTotal;progress;onCancel;timeLeft;indicator;progressText;iconUrl;_bytesPerSecond;startTime;interval;constructor(e){const t=e;this.id=`${c++}_${(0,r.A)()}`;const n=this.notifyListeners.bind(this),s=["title","subtitle","progress","progressTotal","onCancel","icon","timeLeft","indicator","progressText","iconUrl"];for(const e of s)Object.defineProperty(this,e,{get:()=>t[e],set(s){t[e]=s,n(e,s)}});this._bytesPerSecond=0,this.startTime=Date.now()}notifyListeners=(e,t)=>{if(this.listeners.has(e))for(const n of this.listeners.get(e))n(t)};addChangePropertyListener=(e,t)=>{const n=this.listeners.get(e)||new Set;return n.add(t),this.listeners.set(e,n),()=>{n.delete(t),this.listeners.set(e,n)}};updateBytesPerSecond=e=>{this._bytesPerSecond+=e};updateTimeLeft=(t,n=this.progress,s=this.progressTotal,r=0)=>{if(void 0===n)return;r||(r=(0,i.A)(n,0,s||100)),this.updateBytesPerSecond(t);const o=Date.now()-this.startTime;let a=`0${e.use("vkcom_time_s")}`;r<100&&(a=new Date(100*o/r-o),a=[[a.getUTCFullYear()-1970,e.use("vkcom_time_y")],[a.getUTCMonth(),e.use("vkcom_time_mo")],[a.getUTCDate()-1,e.use("vkcom_time_d")],[a.getUTCHours(),e.use("vkcom_time_h")],[a.getUTCMinutes(),e.use("vkcom_time_m")],[a.getUTCSeconds(),e.use("vkcom_time_s")]].filter((e=>!!e[0])).slice(0,2).map((e=>e.join(""))).join(" ")||`0${e.use("vkcom_time_s")}`),this.timeLeft=a};startSpeed(){return this.stopSpeed(),this.indicator=(0,o.A)(0),this.interval=setInterval((()=>{this.indicator=(0,o.A)(this._bytesPerSecond)+"/s",this._bytesPerSecond=0}),1e3),()=>{this.stopSpeed()}}clearIndicator(){this.stopSpeed(),this.progress=this.progressTotal=this.timeLeft=this.indicator=void 0}stopSpeed(){this.interval&&(clearInterval(this.interval),delete this.interval)}}const l=d;s()}catch(e){s(e)}}),1)},4336:(e,t,n)=>{n.d(t,{A:()=>a});var s=n(74848),r=n(1145),o=n(3068),i=n(70459);const a=new class{wrapper=document.createElement("li");_unsafeUnmount=null;listeners=[];events=[];getEvents(){return[...this.events]}addEvent(e){return this.events.push(e),this.onEventsChange(),()=>{this.events=this.events.filter((t=>t!==e)),this.onEventsChange()}}removeEvent(e){this.events=this.events.filter((t=>t.id!==e)),this.onEventsChange()}addEventsChangeListener(e){return this.listeners.push(e),()=>{this.listeners=this.listeners.filter((t=>t!==e))}}onEventsChange(){for(const e of this.listeners)e(this.getEvents());this.events.length>=1?(0,r.A)((()=>this.renderManager())):this.removeManager()}async downloadFileFromLink(e,t){const s=(await n.e(7746).then(n.bind(n,37746))).default;await s(e,t)}async renderManager(){if(this.wrapper.parentElement)return;this.wrapper.className="HeaderNav__item";const e=document.querySelector(".HeaderNav,#top_nav");if(!e)return void console.error("HeaderNav not found");const t=e.querySelector(".HeaderNav__audio");t?(t.insertAdjacentElement("afterend",this.wrapper),this.wrapper.style.order=""):(e.appendChild(this.wrapper),this.wrapper.style.order="-1"),this._unsafeUnmount&&this._unsafeUnmount();const{default:r}=await Promise.all([n.e(2551),n.e(7983),n.e(2020),n.e(3543),n.e(9452),n.e(2477),n.e(6052)]).then(n.bind(n,86052)),{unmount:a}=await(0,o.A)({root:this.wrapper,content:(0,s.jsx)(r,{}),disableParentTransformForPositionFixedElements:!0,disablePortal:!0,wrapperProps:{className:i.A.DownloadManagerPopup}});this._unsafeUnmount=a}removeManager(){0===this.events.length&&(this.wrapper.parentElement&&this.wrapper.remove(),this._unsafeUnmount&&(this._unsafeUnmount(),this._unsafeUnmount=null))}}},88298:(e,t,n)=>{n.a(e,(async(e,s)=>{try{n.d(t,{N:()=>o.A,j:()=>r.A});var r=n(9794),o=n(4336),i=e([r]);r=(i.then?(await i)():i)[0],s()}catch(e){s(e)}}))},17292:(e,t,n)=>{n.a(e,(async(e,s)=>{try{n.r(t);var r=n(43027),o=n(82050),i=n(38729),a=n(8155),c=n(93819),d=n(2006),l=n(8362),u=n(88298),h=e([u]);u=(h.then?(await h)():h)[0];const p=(0,i.NS)(),w=()=>{if(!window.cur.storyLayer)return;const e=window.cur.storyLayer.activeStory.story.data,t=e.raw_id||[e.owner_id,e.id].join("_");"photo"===e.type?u.N.downloadFileFromLink(e.photo_url,`story${t}.jpg`):u.N.downloadFileFromLink(e.video_url,`story${t}.mp4`)},y=async e=>{if(!e||e.vkn_down_inj)return;e.vkn_down_inj=!0;const t=await c.A,n=document.createElement("div");n.className="StoryMenuItem ui_actions_menu_item",n.innerText=t.use("global_download"),n.addEventListener("click",(e=>{(0,r.A)(e),w()})),e.prepend(n)},_=".stories_author_buttons .StoryViewerHeaderButton .ui_actions_menu_wrap > .ui_actions_menu",m=async()=>{if(!window.cur.storyLayer)return;const e=window.cur.storyLayer?.activeStory?.actionButtons;if(e){const t=e.querySelector(".ui_actions_menu");t&&await y(t)}const t=window.cur.storyLayer.stories;if(!t)return;t.querySelector(_)||await(0,o.A)(1e3);const n=t.querySelector(_);n&&await y(n)},v=async()=>{window.cur.storyLayer||await(0,o.A)(1e3),m();const e=document.querySelector(".stories_author_buttons");e&&(e[p]||(e[p]=new MutationObserver((()=>m())),e[p].observe(e,{childList:!0,subtree:!0}),d.A.add(e)))};(async()=>{await(0,a.A)();const e=window.Stories.show;window.Stories.show=function(...t){const n=e(...t);try{v()}catch(e){console.error(e)}return n}})().catch(console.error),(0,l.A)((e=>{e&&v()})),s()}catch(e){s(e)}}))},43027:(e,t,n)=>{n.d(t,{A:()=>s});const s=e=>{e.preventDefault?.(),e.stopPropagation?.(),e.stopImmediatePropagation?.()}},52352:(e,t,n)=>{n.d(t,{A:()=>s});const s=(e,t,n)=>e<t?0:e>n?100:(e-t)/(n-t)*100},70459:(e,t,n)=>{n.d(t,{A:()=>s});const s={AudioPageMainTabBtn:"XYzoAKWs2KhH02Ye",AudioArtistHeaderActions:"v8VBorduCtZgTyyi",VideoPlayerDownloadIcon:"eaSw45y_1KLlo4Gw",SecondaryAttachment__afterItem:"RZ6NWD1WvjAOxG2Y",DownloadManagerPopup:"o9vy1XhnZrkvykUb",VideoPlayerHlsWarning__tooltip:"P9MhdlrtilEQt7Am",VideoPlayerHlsWarning__text:"Xq2PVks6OK6Z74Al",AudioPlaylistSnippet__actions:"FawmW4_Zd1R1BI1E",AudioPlaylistSnippet__actionButton:"ZPr5mXzL52VUPaRe",ActionButton__icon:"_5bFyslOmNjqqP7y",ActionButton__text:"o7YAH98fI9KVToa5",AudioPlayerUserControlsContainer__userButton:"e47qq1XqMPp6oTp7",AudioPlayerPlaybackButton:"wqb5e3cgYZFgHCc1",AudioRowReact__button:"q7d6KTdMjs6HYpKm"}}}]);