"use strict";(globalThis.webpackChunkvknext=globalThis.webpackChunkvknext||[]).push([[7847],{36843:(t,e,o)=>{o.d(e,{A:()=>a});var n=o(65578);const a=()=>(0,n.A)("AudioUtils")},98169:(t,e,o)=>{o.d(e,{A:()=>m});var n=o(25915),a=o(1145),i=o(67992),r=o(36843),s=o(4107);const l=new i.A,c=t=>{for(const e of l.listeners)e(t)},d=()=>{for(const t of document.querySelectorAll(".AudioPlayerBlock__root"))c(t)};let u=!1;const m=t=>{const e=l.addListener(t);return(0,a.A)(d),u||(u=!0,(0,s.A)().then((t=>{t.onLocationChange((t=>{t.startsWith("audio")&&d()})),(async()=>{const t=(await(0,r.A)()).getLayer();t._initSection||(t._initSection=void 0),(0,n.A)(t,"_initSection",d)})().catch(console.error)}))),e}},67078:(t,e,o)=>{o.d(e,{A:()=>s});var n=o(74848),a=o(3068),i=o(75511);const r=document.createElement("div");r.className=i.A.Snackbars;const s=async t=>{const e=(await Promise.all([o.e(2551),o.e(7983),o.e(2020),o.e(3543),o.e(7759)]).then(o.bind(o,28582))).default;document.body.contains(r)||document.body.appendChild(r);const i=document.createElement("div");r.appendChild(i);const{unmount:s}=await(0,a.A)({root:i,content:(0,n.jsx)(e,{onClose:()=>{s(),i.remove(),0===r.children.length&&r.remove()},...t}),disableParentTransformForPositionFixedElements:!0,noStyling:!0})}},88213:(t,e,o)=>{o.d(e,{A:()=>u});var n=o(82050),a=o(60962),i=o(14943),r=o(67992),s=o(4107);const l=new r.A;let c=!1;const d=async()=>{if(c)return;c=!0;(await(0,s.A)()).onLocationChange((async t=>{(t.startsWith("music/album")||t.startsWith("music/playlist"))&&(await(0,n.A)(1e3),await(0,i.A)(),(()=>{for(const t of l.listeners)t()})())}))},u=t=>{const e=l.addListener(t);return(0,a.A)((()=>{(window.location.pathname.startsWith("/music/album")||window.location.pathname.startsWith("/music/playlist"))&&requestAnimationFrame((()=>t())),d()})),e}},5024:(t,e,o)=>{o.a(t,(async(t,n)=>{try{o.d(e,{A:()=>A,u:()=>f});var a=o(97992),i=o(63499),r=o(88908),s=o(93819),l=o(67078),c=o(43024),d=o(88298),u=o(84896),m=o(14692),w=o(15991),p=t([d]);d=(p.then?(await p)():p)[0];const f=async({event:t,audio:e,lastModified:o,signal:n,playlist:a,audioIndex:r})=>{if(n.aborted)return null;if(!e.url)return null;try{const s=await(0,m.G)({audio:e,playlist:a,signal:n,playlistEvent:t}),l=[];return c.default.getValue("numTracksInPlaylist")&&l.push(`${r}. `),l.push(`${e.artist} - ${e.title}`),e.subtitle&&l.push(` (${e.subtitle})`),l.push(".mp3"),t&&(t.progress=(t.progress||0)+1),{name:(0,i.A)(l.join("")),lastModified:e.date?new Date(1e3*e.date):o,input:s}}catch(t){return console.error("error download audio",t),null}},A=async t=>{const[e,n,i]=t.split("_"),c=await s.A;await(0,l.A)({text:c.use("vkcom_downloading")});const m=await(0,w.A)({owner_id:parseInt(e),playlist_id:parseInt(n),access_key:i,fixAudioUrl:!0});if(!m)return void await(0,l.A)({text:"Playlist not found",type:"error"});if(m?.error?.error_msg)return void await(0,l.A)({text:m.error.error_msg,type:"error"});if(!m.audios?.length)return void await(0,l.A)({text:c.use("vkcom_playlist_is_empty"),type:"error"});const p=new AbortController,{signal:A}=p,h=(m.main_artists||[]).map((t=>t.name)),_=[];h.length&&_.push(`${h.join(", ")} - `),m.title?_.push(m.title):_.push("playlist");const v=new d.j({icon:"playlist_music",title:(0,r.A)(`${_.join("")}.zip`),onCancel:()=>p.abort(),progress:0,progressTotal:m.audios.length,iconUrl:(0,u.Z)(m)||void 0}),b=d.N.addEvent(v),y=new Date,g=[];let k=1;for(const t of(0,a.A)(m.audios,8)){if(A.aborted)return;for(const e of t)g.push(f({event:v,audio:e,lastModified:y,signal:A,audioIndex:k++,playlist:m}));await Promise.all(g)}v.clearIndicator(),v.indicator=c.use("vkcom_processing");const x=(await Promise.all(g)).filter(Boolean);if(!A.aborted){if(1===x.length){const t=x[0],e=URL.createObjectURL(t.input);await d.N.downloadFileFromLink(e,t.name),URL.revokeObjectURL(e)}else{v.indicator=c.use("vkcom_archivation");const{downloadZip:t}=await o.e(1941).then(o.bind(o,71941)),e=await t(x).blob(),n=URL.createObjectURL(e);await d.N.downloadFileFromLink(n,v.title),URL.revokeObjectURL(n)}b(),v.stopSpeed()}};n()}catch(t){n(t)}}))},77135:(t,e,o)=>{o.a(t,(async(t,n)=>{try{o.d(e,{A:()=>w});var a=o(97992),i=o(88908),r=o(43883),s=o(93819),l=o(67078),c=o(88298),d=o(5024),u=t([c,d]);async function*m(t){let e=0,o=201;do{const n=await(0,r.A)(),a=await n.api("audio.get",{owner_id:t,offset:e,count:200});o=a.count,e+=200,yield a}while(0===e||e<o)}[c,d]=u.then?(await u)():u;const w=async t=>{const e=await s.A;await(0,l.A)({text:e.use("vkcom_downloading")});const n=new AbortController,{signal:r}=n,u=new c.j({icon:"owner_music",title:(0,i.A)(`audios${t}.zip`),subtitle:e.use("vkcom_downloading"),onCancel:()=>n.abort(),progress:0,progressTotal:0});try{const o=(await window.vkApi.api("users.get",{fields:"photo_100,is_nft",user_ids:t}))[0];o&&(u.iconUrl=o.photo_100||void 0,u.title=e.use("vkcom_user_music",{name:`${o.first_name} ${o.last_name}.zip`}),o.is_nft&&(u.icon="nft_owner_music"))}catch(t){console.error(t)}u.subtitle="";const w=c.N.addEvent(u),p=new Date,f=[];let A=1;try{for await(const{count:e,items:o}of m(t)){if(r.aborted)return;u.progressTotal!==e&&(u.progressTotal=e);for(const t of(0,a.A)(o,8)){if(r.aborted)return;for(const e of t)f.push((0,d.u)({event:u,audio:e,lastModified:p,signal:r,audioIndex:A++}));await Promise.all(f)}}}catch(t){console.error(t),await(0,l.A)({text:t.message,type:"error"})}u.clearIndicator(),u.indicator=e.use("vkcom_archivation");const h=(await Promise.all(f)).filter(Boolean);if(r.aborted)return;const{downloadZip:_}=await o.e(1941).then(o.bind(o,71941)),v=await _(h).blob(),b=URL.createObjectURL(v);await c.N.downloadFileFromLink(b,u.title),URL.revokeObjectURL(b),w(),u.stopSpeed()};n()}catch(p){n(p)}}))},51652:(t,e,o)=>{o.a(t,(async(t,n)=>{try{o.r(e);var a=o(74848),i=o(53644),r=o(94229),s=o(98570),l=o(38729),c=o(98169),d=o(93819),u=o(88213),m=o(3068),w=o(19533),p=o(77135),f=o(70459),A=t([p]);p=(A.then?(await A)():A)[0];const h=(0,l.sr)(),_=(0,l.sr)(),v=async t=>{if(t.vkn_down_inj)return;t.vkn_down_inj=!0;const e=await d.A,n=(0,s.A)(),l=document.getElementsByClassName("audio_section_tabs_actions");for(const t of l){if(n?.vms_installed)continue;if(t.getElementsByClassName(f.A.AudioPageMainTabBtn).length)continue;const o=document.createElement("button");o.className=f.A.AudioPageMainTabBtn,o.addEventListener("click",(()=>(0,p.A)(window.cur.oid||window.vk.id).catch(console.error))),o.addEventListener("mouseover",(function(){window.showTooltip(this,{text:e.use("vkcom_download_all_music"),black:1,noZIndex:!0,needLeft:!0,shift:[5,2]})})),o.appendChild((0,i.A)(r.A)),t.prepend(o)}if(0===l.length&&!n?.vms_installed){const t=document.querySelector(".audio_page_content_block_wrap .page_block_h2 .page_block_header_extra");if(t){const o=document.createElement("button");o.className=f.A.AudioPageMainTabBtn,o.addEventListener("click",(()=>(0,p.A)(window.cur.oid||window.vk.id).catch(console.error))),o.addEventListener("mouseover",(function(){window.showTooltip(this,{text:e.use("vkcom_download_all_music"),black:1,noZIndex:!0,needLeft:!0,shift:[5,2]})})),o.appendChild((0,i.A)(r.A)),t.appendChild(o)}}const c=await(0,w.A)(t);if(c){if(!n?.vms_installed&&!c.querySelector(`#${_}`)){const t=document.createElement("div");t.id=_,t.className=f.A.AudioPlayerUserControlsContainer__userButton,c.prepend(t);const{default:e}=await Promise.all([o.e(2551),o.e(7983),o.e(2020),o.e(3543),o.e(1434),o.e(5544)]).then(o.bind(o,50150));await(0,m.A)({root:t,content:(0,a.jsx)(e,{type:"audio_page",getAudioObject:()=>window.AudioUtils.audioTupleToAudioObject(window.ap.getCurrentAudio()),tooltipProps:{placement:"bottom",appearance:"black",enableInteractive:!0}}),disableAppRoot:!0,disableConfig:!0,disableParentTransformForPositionFixedElements:!0})}if(!n?.vms_installed&&!c.querySelector(`#${h}`)){const t=document.createElement("div");t.id=h,t.className=f.A.AudioPlayerUserControlsContainer__userButton,c.prepend(t);const{default:e}=await Promise.all([o.e(2551),o.e(7983),o.e(2020),o.e(3543),o.e(1434),o.e(6966)]).then(o.bind(o,16135));await(0,m.A)({root:t,content:(0,a.jsx)(e,{}),disableAppRoot:!0,disableConfig:!0,disableParentTransformForPositionFixedElements:!0})}}};(0,c.A)(v),(0,u.A)((()=>{for(const t of document.querySelectorAll('[data-testid="audioplayerblocksectionslayout"],[class*="AudioPlayerBlockSectionsLayout__root"]'))v(t)})),n()}catch(t){n(t)}}))},19533:(t,e,o)=>{o.d(e,{A:()=>i});var n=o(82050);const a=async(t,e=0)=>{if(5===e)throw new Error("[audio hooks] users controls not found");const o=t.querySelector('[class*="AudioPlayerUserControlsContainer__userButtonsContainer--"]');return o||(await(0,n.A)(1e3),a(t,e+1))},i=a},25915:(t,e,o)=>{o.d(e,{A:()=>n});const n=(t,e,o)=>{if(!(e in t))throw console.warn("[VK Next objectHook]:",t,t[e]),new Error(`[VK Next objectHook]: object "${String(e)}" not found`);let n=t[e];try{o(n)}catch(t){console.error(t)}return Object.defineProperty(t,e,{get:()=>n,set(t){n=t;try{o(n)}catch(t){console.error(t)}return n}}),{remove:()=>{delete t[e],t[e]=n}}}},53644:(t,e,o)=>{o.d(e,{A:()=>a});let n=0;const a=t=>{const e=!!document.importNode;let o=(new DOMParser).parseFromString(t,"image/svg+xml").documentElement;e&&(o=document.importNode(o,!0));for(const t of o.querySelectorAll("title,desc"))t.remove();for(const t of o.querySelectorAll("[id]")){if(!t.id)continue;const e="vknext_icon-"+n++;let a=!1;for(const n of o.querySelectorAll(`[fill="url(#${t.id})"]`))n.setAttribute("fill",`url(#${e})`),a=!0;a&&(t.id=e)}return o}},97992:(t,e,o)=>{o.d(e,{A:()=>n});const n=(t,e=100)=>{const o=[...t],n=[];for(;o.length;)n.push(o.splice(0,e||o.length));return n}},63499:(t,e,o)=>{o.d(e,{A:()=>a});const n=/\/|\\|:|\*|\?|"|<|>|\||\+|%|@|@\\0/g;function a(t){return t.replaceAll(n,"_")}},75511:(t,e,o)=>{o.d(e,{A:()=>n});const n={Snackbars:"fuEF5ymRhcBAxInE",BaseSnackbar:"Fu47p889xWCKEooV"}},94229:(t,e,o)=>{o.d(e,{A:()=>n});const n='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M12.002 2a.9.9 0 0 1 .9.9v11.002l4.562-4.631a.9.9 0 1 1 1.283 1.263l-6.104 6.195a.9.9 0 0 1-1.284-.001l-6.09-6.206a.9.9 0 1 1 1.286-1.26l4.547 4.633V2.9a.9.9 0 0 1 .9-.9Zm-8 18.1a.9.9 0 0 1 .9-.9h14.2a.9.9 0 1 1 0 1.8h-14.2a.9.9 0 0 1-.9-.9Z" clip-rule="evenodd"/></svg>\n'}}]);