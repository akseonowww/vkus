"use strict";(globalThis.webpackChunkvknext=globalThis.webpackChunkvknext||[]).push([[122],{14694:(t,e,n)=>{n.d(e,{A:()=>a});const a=()=>"https://api.vknext.net"},88400:(t,e,n)=>{n.d(e,{A:()=>a});const a=async t=>{const e=await t.json(),a=t.headers.get("Content-Type");if(a&&a.startsWith("application/x-vknextpack")&&e)try{const t=new Uint8Array(Object.values(e)),{decode:a}=await n.e(7802).then(n.bind(n,77802));return a(t)}catch(t){console.error(t)}return e}},46140:(t,e,n)=>{n.d(e,{A:()=>u});var a=n(22440),r=n(82050),s=n(98570),i=n(75412);const o=(0,a.A)(),c=async t=>{const e=(0,s.A)().browserApi;if(e){return(await e.storage.local.get(t))[t]}if(o?.localStorage)return o.localStorage.getItem(t);const{storage:a}=await n.e(6815).then(n.t.bind(n,96815,23));return(await a.local.get(t))[t]},d=async(t,e)=>{const a=(0,s.A)().browserApi;if(a)return void await a.storage.local.set({[t]:e});if(o?.localStorage)return void o.localStorage.setItem(t,e);const{storage:r}=await n.e(6815).then(n.t.bind(n,96815,23));await r.local.set({[t]:e})},l=async(t,e)=>{const n=`vknLP${t}`,a=`vknLPD${t}`,s=await c(n),o=await c(a);if(s&&Date.now()-(parseInt(o||"")||0)<216e5)return s?.response||s;try{const{view_url:s}=await e.apps.getEmbeddedUrl({app_id:await(0,i.A)(),v:"5.123"});if(!s)return await(0,r.A)(5e3),l(t,e);const o=s.split("?")[1].split("#")[0];return await d(n,o),await d(a,Date.now().toString()),o}catch(n){return console.error(n),await(0,r.A)(1500),l(t,e)}},u=l},47961:(t,e,n)=>{n.d(e,{A:()=>r});var a=n(387);const r=async(t,e,n)=>{try{delete Uint8Array.prototype.toJSON}catch(t){console.error(t)}const r=(0,a.A)(),s=((t,e)=>{const n=t.toString().length,a=new Uint8Array(16);for(let r=0;r<e.length;r++){const s=e.charCodeAt(r)*t/n;a[r%16]^=255&s}return a})(t,e),i=await(t=>crypto.subtle.importKey("raw",t,{name:"AES-CBC"},!1,["encrypt"]))(s),o={version:await n.getVersion(),udGltZS5p:await n.getRuntimeId(),cGlkb3I:t,fdhjiD:"ba05681e16c97c31e1be20e84f250d55",v9Cdi3sD:r},c=JSON.stringify(o),d=(new TextEncoder).encode(c),l={name:"AES-CBC",iv:crypto.getRandomValues(new Uint8Array(16))},u=await crypto.subtle.encrypt(l,i,d),w=new Uint8Array(l.iv.length+u.byteLength);return w.set(new Uint8Array(l.iv),0),w.set(new Uint8Array(u),l.iv.length),w}},75412:(t,e,n)=>{n.d(e,{A:()=>r});var a=n(14694);const r=async()=>{try{const t=await fetch(`${(0,a.A)()}/internal.getAuthAppId`,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json","Api-Version":"3"}});if(t.ok)return parseInt(await t.text())}catch(t){console.error("[VK Next/getAuthAppId] Error:",t)}return 8194076}},24370:(t,e,n)=>{n.d(e,{Q:()=>c});var a=n(82050),r=n(14694),s=n(88400),i=n(46140),o=n(47961);class c{vkapi;vkAgents;userId;constructor({api:t}){this.vkapi=t,this.userId=0,this.vkAgents=new Map}async call(t,e,n){const i=await this.getVkAgent(),o={...e,"vknext-agent":await this.gvkna()};let c=0;const d=`${(0,r.A)()}/${t}`,l=JSON.stringify(o),u={Accept:"application/json","Content-Type":"application/json","VK-Agent":i,"VK-User-ID":`${this.userId||0}`,"9603a224b40d7b67210b78f2e390d00f":"ba05681e16c97c31e1be20e84f250d55","Api-Version":"3",...n};let w=new Response(JSON.stringify({error_code:408}),{status:408});for(;c<3;){const t=new AbortController,e=setTimeout((()=>t.abort()),15e3);try{if(w=await fetch(d,{body:l,method:"POST",headers:u,signal:t.signal}),502!==w.status)return(0,s.A)(w);{await(0,a.A)(2e3);const t=await w.text();if(!t.toLowerCase().includes("cloudflare"))return(0,s.A)(w);await(0,a.A)(c)}}catch(t){console.error(t),await(0,a.A)(2e3)}clearTimeout(e),c++}return(0,s.A)(w)}async getVkAgent(){if(0===this.userId&&(this.userId=await this.getUserId()),this.vkAgents.has(this.userId))return this.vkAgents.get(this.userId);return(0,i.A)(this.userId,this.vkapi)}async gvkna(){return await(0,o.A)(this.userId,"ba05681e16c97c31e1be20e84f250d55",this)}resetUserId(){this.userId=0}async getUserId(){return 0}async getRuntimeId(){return""}async getVersion(){return""}}},70122:(t,e,n)=>{n.r(e),n.d(e,{default:()=>c});var a=n(98570),r=n(24370),s=n(87251);const i=new r.Q({api:s.default});let o=!1;i.getUserId=async()=>"number"==typeof window.vk?.id?window.vk.id:o?await new Promise((t=>{const e=setInterval((()=>{o||(t(s.default.user_id),clearInterval(e))}),200)})):(s.default.user_id||(o=!0,await s.default.forceUpdateToken(),o=!1),s.default.user_id),i.getRuntimeId=async()=>{const{getManifest:t}=(0,a.A)().browserApi;return t().id},i.getVersion=async()=>{const{getManifest:t}=(0,a.A)().browserApi;return t().version};const c=i},22440:(t,e,n)=>{n.d(e,{A:()=>a});const a=()=>"undefined"!=typeof unsafeWindow?unsafeWindow:"undefined"!=typeof window?window:globalThis}}]);