"use strict";(globalThis.webpackChunkvknext=globalThis.webpackChunkvknext||[]).push([[277],{83730:(e,s,t)=>{t.a(e,(async(e,n)=>{try{t.d(s,{A:()=>_});var a=t(74848),o=t(89230),r=t(4255),i=t(39107),c=t(96540),d=t(74225),l=t.n(d),u=t(55517),h=t(87675),g=t(1003),w=t(40473),f=t(96832),p=e([h,w]);[h,w]=p.then?(await p)():p;const _=()=>{const{messages:e,setIsPopoverShown:s}=(0,f.p)(),n=(0,h.A)(),[d,p]=(0,c.useState)(!1),[_,m]=(0,c.useState)(null),[A,x]=(0,c.useState)([]),v=(0,u.A)(),j=(0,g.A)();return l()((async s=>{if(null===e)return;const{default:n}=await t.e(1691).then(t.bind(t,31691));if(!s())return;const a=Object.keys(e);if(!a.length)return p(!0);const o=[],i=new Set,c=new Set,d=[];for(const s of a){const t=await n.getMessages(`${j}_${s}`,[]);if(!t.length)continue;d.push(s);const a=t.at(-1);a&&(a.peer_id===v&&((r.A.isUserId(a.from_id)?i:c).add(Math.abs(a.from_id)),a.time=e[a.id].time,o.push(a)))}if(!o.length)return p(!0);const l=[...i],u=[...c];let h=[],g=[];try{if(l.length>0&&(h=await window.vkApi.api("users.get",{user_ids:l.join(","),fields:"photo_50,image_status,screen_name"})),u.length>0){const e=await window.vkApi.api("groups.getById",{group_ids:u.join(","),fields:"photo_50,screen_name"});e.groups&&(g=e.groups)}}catch(e){console.error(e)}const w={};for(const e of h)e.name=`${e.first_name} ${e.last_name}`,e.screen_name||(e.screen_name=`id${e.id}`),w[e.id]=e;for(const e of g)e.screen_name||(e.screen_name=`club${e.id}`),w[-e.id]=e;s()&&(m(w),x(o))}),[e,v]),(0,c.useEffect)((()=>{s(!d)}),[d]),d?(0,a.jsx)(i.OrA,{children:n.use("global_not_found")}):A.length?(0,a.jsx)(w.A,{messages:A,users:_}):(0,a.jsx)(i.YJl,{children:[...Array(5).keys()].map((e=>(0,a.jsx)(o.A,{},e)))})};n()}catch(e){n(e)}}))},96832:(e,s,t)=>{t.d(s,{L:()=>l,p:()=>d});var n=t(74848),a=t(96540),o=t(74225),r=t.n(o),i=t(1003);const c=(0,a.createContext)(null),d=()=>{const e=(0,a.useContext)(c);if(!e)throw new Error("useExpiredMessages must be used within a ExpiredMessagesContext");return e},l=({children:e})=>{const[s,o]=(0,a.useState)(!1),[d,l]=(0,a.useState)(null);return r()((async e=>{const s=(0,i.A)(),n=(await t.e(1243).then(t.bind(t,21243))).default,a=await n.getMessages(s,{});e()&&l(a)}),[]),(0,n.jsx)(c.Provider,{value:{messages:d,setMessages:l,isPopoverShown:s,setIsPopoverShown:o},children:e})}},30904:(e,s,t)=>{t.a(e,(async(e,n)=>{try{t.d(s,{A:()=>p});var a=t(74848),o=t(90275),r=t(99381),i=t(3178),c=t(39107),d=t(67078),l=t(55517),u=t(87675),h=t(1003),g=t(44497),w=t(96832),f=e([u]);u=(f.then?(await f)():f)[0];const p=()=>{const{setMessages:e,isPopoverShown:s,setIsPopoverShown:n}=(0,w.p)(),f=(0,u.A)(),p=(0,l.A)();return s?(0,a.jsx)(o.Ku,{trigger:"hover",placement:"bottom-end",actions:(0,a.jsx)(o.vH,{onClick:async()=>{const{default:s}=await t.e(1243).then(t.bind(t,21243)),{default:a}=await t.e(1691).then(t.bind(t,31691)),o=p||(0,g.A)(),r=(0,h.A)(),i=await a.getStorage(),c=await s.getMessages(r);for(const[e,s]of Object.entries(i))if(e.startsWith(r.toString())&&s[0]?.peer_id===o){delete i[e];for(const e of s)delete c[e.id]}await s.setMessages(r,c),await a.saveStorage(i),e({}),await(0,d.A)({type:"done",text:f.use("vkcom_deleted_messages_cleared")}),n(!1)},children:f.use("vkcom_deleted_messages_clear")}),children:(0,a.jsx)(c.qAe,{"aria-label":f.use("global_close"),onClick:r.A,hasActive:!1,children:(0,a.jsx)(i.o,{})})}):null};n()}catch(e){n(e)}}))},78278:(e,s,t)=>{t.a(e,(async(e,n)=>{try{t.d(s,{default:()=>g});var a=t(74848),o=t(39107),r=t(96540),i=t(84833),c=t(87675),d=t(83730),l=t(96832),u=t(30904),h=e([c,d,u]);[c,d,u]=h.then?(await h)():h;const g=()=>{const e=(0,c.A)();return(0,r.useLayoutEffect)((()=>{window.stManager&&window.stManager.add(window.stDeps["/css/al/im.css"])}),[]),(0,a.jsx)(l.L,{children:(0,a.jsx)(i.A,{size:600,header:(0,a.jsx)(o.aO9,{after:(0,a.jsx)(u.A,{}),children:e.use("vkcom_action_item_expired_msg")}),children:(0,a.jsx)(d.A,{})})})};n()}catch(e){n(e)}}))}}]);