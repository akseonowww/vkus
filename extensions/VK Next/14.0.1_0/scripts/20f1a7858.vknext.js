"use strict";(globalThis.webpackChunkvknext=globalThis.webpackChunkvknext||[]).push([[3179],{25632:(t,e,n)=>{n.d(e,{A:()=>_});var s=n(82050),a=n(95728),o=n(60962),i=n(14943),r=n(95684),c=n(67992),l=n(38729),d=n(78105),u=n(88213);const f=new c.A,A=(0,l.NS)(),w='[class*="AudioRow__root"]',h=async t=>{if(await(0,r.A)(),t.attributes.getNamedItem("disabled"))return;const e=(t=>{const{props:e}=(0,a.A)(t);if(e?.children?.props?.audio?.apiAudio)return e.children.props.audio.apiAudio;if(t.parentElement){const{props:e}=(0,a.A)(t.parentElement);if(e.children?.props?.audio?.apiAudio)return e.children.props.audio.apiAudio}return null})(t);for(const n of f.listeners)n(t,e)},p=async(t=0)=>{if(document.querySelector('.vkui__root .vkuiFlex [class*="Skeleton__skeleton"]'))return await(0,s.A)(1e3),p(t+1);await(0,r.A)(),await(0,i.A)();const e=document.querySelectorAll(w);for(const t of e)await(0,r.A)(),await h(t);await(async()=>{for(const t of document.querySelectorAll('[class*="AudioListItems__root--"] > div'))t[A]||(t[A]=new MutationObserver((t=>{for(const e of t)if("childList"===e.type)for(const t of e.addedNodes)if(t instanceof HTMLElement)if(t.matches(w))h(t);else for(const e of t.querySelectorAll(w))h(e)})),t[A].observe(t,{childList:!0}))})()};let m=!1;const _=t=>{const e=f.addListener(t);return(0,o.A)(p),m||(m=!0,(0,d.A)((()=>p())),(0,u.A)((()=>p()))),e}},78105:(t,e,n)=>{n.d(e,{A:()=>f});var s=n(82050),a=n(60962),o=n(14943),i=n(67992),r=n(4107);const c=new i.A,l=t=>t.replace("audio_playlist","").replace("/","_");let d=!1;const u=async()=>{if(d)return;d=!0;const t=await(0,r.A)();t.onLocationChange((async()=>{const e=t.objLoc.z;e&&e.startsWith("audio_playlist")&&(await(0,s.A)(1e3),await(0,o.A)(),(t=>{const e=l(t);for(const t of c.listeners)t(e)})(e))}))},f=t=>{const e=c.addListener(t);return(0,a.A)((()=>{const e=new URLSearchParams(window.location.search).get("z");e&&e.startsWith("audio_playlist")&&requestAnimationFrame((()=>t(l(e)))),u()})),e}},88213:(t,e,n)=>{n.d(e,{A:()=>u});var s=n(82050),a=n(60962),o=n(14943),i=n(67992),r=n(4107);const c=new i.A;let l=!1;const d=async()=>{if(l)return;l=!0;(await(0,r.A)()).onLocationChange((async t=>{(t.startsWith("music/album")||t.startsWith("music/playlist"))&&(await(0,s.A)(1e3),await(0,o.A)(),(()=>{for(const t of c.listeners)t()})())}))},u=t=>{const e=c.addListener(t);return(0,a.A)((()=>{(window.location.pathname.startsWith("/music/album")||window.location.pathname.startsWith("/music/playlist"))&&requestAnimationFrame((()=>t())),d()})),e}},13179:(t,e,n)=>{var s=n(98570),a=n(82050),o=n(1145),i=n(14943),r=n(95684),c=n(67992),l=n(38729),d=n(2006),u=n(4107),f=n(5305);const A=new c.A,w=(0,l.NS)(),h=(0,l.Ln)(),p=async t=>{await(0,i.A)();for(const e of A.listeners)e(t)},m=async t=>{await(0,r.A)(),t[h]||(t[h]=new IntersectionObserver((async e=>{for(const n of e)n.isIntersecting&&await p(t)}),{threshold:0,rootMargin:"50px 0% 50px 0%"}),t[h].observe(t),d.A.add(t))},_=async t=>{t&&await(0,a.A)(1e3),await(0,r.A)(),await(0,i.A)();const e=document.querySelectorAll(".audio_row");for(const t of e)await(0,r.A)(),m(t);(()=>{const t=document.querySelectorAll(".audio_pl_snippet__list");for(const e of t)e[w]||(e[w]=new MutationObserver((t=>{for(const e of t)if("childList"===e.type&&e.addedNodes.length)for(const t of e.addedNodes)t instanceof HTMLElement&&t.classList.contains("audio_row")&&m(t)})),e[w].observe(e,{childList:!0}),d.A.add(e))})()},y=["section","load_catalog_section","load_block_playlist","load_section"],b=()=>{(0,f.A)((t=>{const[e,n,s]=t,a=e.startsWith("al_audio.php")||e.startsWith("/audio");let o=n.act;if(a&&!o){o=new URL(e,window.location.origin).searchParams.get("act")}if(o&&y.includes(o)&&s.onDone){const t=s.onDone;s.onDone=function(...e){const n=Reflect.apply(t,this,e);n instanceof Promise?n.finally((()=>_(!0))):_(!0).catch(console.error)}}}))};let g=!1;const v=t=>{const e=A.addListener(t);return(0,o.A)(_),g||(g=!0,b(),(0,u.A)().then((t=>{t.onLocationChange((t=>{(t.startsWith("audio")||t.startsWith("music"))&&_()}))}))),e};var L=n(25632),S=n(93819);const k="x0lsHsEKRus160bW",N="vYonF2e_Bl6cN8_e",E="K3ZK9kirXVPTwpMC";v((async t=>{if((0,s.A)()?.vms_installed)return;const e=t.dataset.audio;if(!e)return;const a=AudioUtils.audioTupleToAudioObject(JSON.parse(e));if(!a)return;if(a?.restrictionStatus||t.classList.contains("audio_row__deleted"))return;const o=t.querySelector(".audio_row__info");if(!o)return;if(o.getElementsByClassName(N).length)return;const i=await S.A,r=document.createElement("span");r.className=N,r.innerText=i.use("global_loading"),o.classList.add(k),o.appendChild(r);new IntersectionObserver((async(t,e)=>{t.forEach((async t=>{if(t.isIntersecting){const{default:t}=await n.e(3099).then(n.bind(n,83099)),s=await t(a);r.innerText=s?.bitrate?`${s.bitrate}`:i.use("global_error"),e.unobserve(r)}}))}),{threshold:0}).observe(r)})),(0,L.A)((async(t,e)=>{if((0,s.A)()?.vms_installed)return;if(!e)return;const a=t.querySelector('[class*="AudioRow__after--"]');if(!a)return;if(a.getElementsByClassName(N).length)return;const o=await S.A,i=document.createElement("span");i.className=N,i.innerText=o.use("global_loading"),a.classList.add(E),a.appendChild(i);new IntersectionObserver((async(t,s)=>{t.forEach((async t=>{if(t.isIntersecting){const{default:t}=await n.e(3099).then(n.bind(n,83099)),a=await t(e);i.innerText=a?.bitrate?`${a.bitrate}`:o.use("global_error"),s.unobserve(i)}}))}),{threshold:.1}).observe(i)}))}}]);