"use strict";(globalThis.webpackChunkvknext=globalThis.webpackChunkvknext||[]).push([[1434],{89150:(t,e,o)=>{o.d(e,{W:()=>a});var a=(0,o(93543).mT)("Icon20DownloadOutline","download_outline_20","0 0 20 20",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20" id="download_outline_20"><g fill="currentColor"><path fill-rule="evenodd" d="M4 17.75a.75.75 0 0 1 .75-.75h10.5a.75.75 0 0 1 0 1.5H4.75a.75.75 0 0 1-.75-.75" clip-rule="evenodd" /><path d="M10.75 2.726c0-.401-.336-.726-.75-.726a.74.74 0 0 0-.75.726v9.722l-3.97-3.97a.75.75 0 0 0-1.06 1.06l5.245 5.246a.75.75 0 0 0 1.06 0l5.257-5.256a.75.75 0 0 0-1.061-1.061l-3.972 3.972z" /></g></symbol>',20,20,!1,void 0)},76382:(t,e,o)=>{o.d(e,{q:()=>a});var a=(0,o(93543).mT)("Icon24DownloadOutline","download_outline_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" id="download_outline_24"><path fill-rule="evenodd" d="M12.002 2a.9.9 0 0 1 .9.9v11.002l4.562-4.631a.9.9 0 1 1 1.283 1.263l-6.104 6.195a.9.9 0 0 1-1.284-.001l-6.09-6.206a.9.9 0 1 1 1.286-1.26l4.547 4.633V2.9a.9.9 0 0 1 .9-.9m-8 18.1a.9.9 0 0 1 .9-.9h14.2a.9.9 0 1 1 0 1.8h-14.2a.9.9 0 0 1-.9-.9" clip-rule="evenodd" /></symbol>',24,24,!1,void 0)},5622:(t,e,o)=>{o.d(e,{A:()=>n});var a=o(65578);const n=()=>(0,a.A)("colorScheme")},50150:(t,e,o)=>{o.a(t,(async(t,a)=>{try{o.d(e,{default:()=>b});var n=o(74848),r=o(43027),i=o(76382),s=o(89150),c=o(39107),l=o(96540),d=o(74225),u=o.n(d),f=o(49423),w=o(87675),h=o(70459),p=o(23972),_=o(83099),v=o(73746),m=t([w,v]);[w,v]=m.then?(await m)():m;const A=({type:t,getRootRef:e,className:o,CustomIcon:a,...r})=>"audio_row_react"===t?(0,n.jsx)(c.K0,{Component:"button",className:(0,c.xWm)(h.A.AudioRowReact__button,o),getRootRef:e,hoverMode:"opacity",activeMode:"opacity",activeEffectDelay:200,...r,children:a?(0,n.jsx)(a,{}):(0,n.jsx)(i.q,{})}):"audio_row"===t?(0,n.jsx)("button",{className:(0,c.xWm)("audio_row__action",o),ref:e,...r,children:(0,n.jsx)("div",{className:"audio_row__icon",children:a?(0,n.jsx)(a,{}):(0,n.jsx)(s.W,{})})}):"audio_page"===t?(0,n.jsx)(c.K0,{className:(0,c.xWm)(h.A.AudioPlayerPlaybackButton,o),getRootRef:e,hoverMode:"opacity",activeMode:"opacity",...r,children:a?(0,n.jsx)(a,{}):(0,n.jsx)(i.q,{})}):"secondary_attachment"===t?(0,n.jsx)("div",{className:`SecondaryAttachment__afterItem ${h.A.SecondaryAttachment__afterItem}`,ref:e,...r,children:a?(0,n.jsx)(a,{}):(0,n.jsx)(i.q,{})}):null,y=({audioObject:t,getAudioObject:e})=>{const o=(0,w.A)(),[a,r]=(0,l.useState)(null);return u()((async o=>{if(a)return;const n=t||e&&await e();if(!n)return void(o()&&r(""));const i=await(0,_.default)(n);o()&&r(i?(0,p.A)(i.bitrate,i.size):"")}),[t,e]),null===a?(0,n.jsxs)(n.Fragment,{children:[o.use("vkcom_bitrate"),": ",o.use("global_loading")]}):""===a.trim()?null:(0,n.jsxs)(n.Fragment,{children:[o.use("vkcom_bitrate"),": ",a]})},b=({type:t,tooltipProps:e,audioObject:o,getAudioObject:a,onClick:i,...s})=>{const d=(0,f.A)(),u=(0,w.A)(),h=(0,l.useCallback)((async()=>{const t=o||a&&await a();if(t)return await(0,v.A)(t)}),[o,a]);return(0,n.jsx)(c.SvD,{value:d,children:(0,n.jsx)(c.m_M,{hideWhenReferenceHidden:!0,usePortal:document.body,title:e?.title?e.title:u.use("global_download"),description:(0,n.jsx)(y,{audioObject:o,getAudioObject:a}),...e,children:(0,n.jsx)(A,{type:t,onClick:t=>{(0,r.A)(t),i&&i(t),h().catch(console.error)},...s})})})};a()}catch(t){a(t)}}))},73746:(t,e,o)=>{o.a(t,(async(t,a)=>{try{o.d(e,{A:()=>w});var n=o(88908),r=o(93819),i=o(67078),s=o(88298),c=o(14692),l=o(54869),d=t([s]);s=(d.then?(await d)():d)[0];const u=(t=[])=>t.map((t=>t.name)).join(", "),f=t=>{let e=t.performer||t.artist;if(!e){const o=u(t.main_artists||t.mainArtists),a=u(t.featured_artists||t.featArtists);e=o,a&&(e+=` feat. ${a}`)}return e},w=async t=>{if(!t)return void await(0,i.A)({text:"Audio not found",type:"error"});const e=await r.A,o=new AbortController,{signal:a}=o,d=new s.j({icon:"music",title:(0,n.A)(`${t.title}.mp3`),subtitle:e.use("vkcom_downloading"),onCancel:()=>o.abort()}),u=s.N.addEvent(d),w=await(0,l.A)(t);await(0,i.A)({text:e.use("vkcom_downloading")});let h=[f(w).trim(),w.title].join(" - ");w.subtitle&&(h+=` (${w.subtitle})`);try{const t=await(0,c.G)({audio:w,signal:a,event:d});if(a.aborted)return;const e=URL.createObjectURL(t);await s.N.downloadFileFromLink(e,`${h}.mp3`),URL.revokeObjectURL(e),u()}catch(t){throw console.error("Error downloading audio:",t),new Error("Failed to download audio")}};a()}catch(t){a(t)}}))},23972:(t,e,o)=>{o.d(e,{A:()=>n});var a=o(26555);const n=(t,e)=>{const o=`${t} kb/s`;return"number"==typeof e?`${o} | ~${(0,a.A)(e,2)}`:o}},83099:(t,e,o)=>{o.d(e,{default:()=>f});var a=o(37352),n=o(5932),r=o(55073),i=o(64115);var s=o(54869);const c=new Map,l=[];let d=0;const u=async()=>{if(d>=2||0===l.length)return;d++;const t=l.shift();await t(),d--,l.length>0&&setTimeout(u,500)},f=async t=>{const e=`${t.owner_id}_${t.id}`;if(c.has(e))return c.get(e);if(c.has(e))return await c.get(e);const{promise:o,resolve:d}=(0,a.A)();var f;return c.set(e,o),f=async()=>{const e=t.url?t:await(0,s.A)(t);if(!e.url)return void d(null);const o=await(async({url:t})=>{const{promise:e,resolve:o,reject:a}=(0,r.c)(),n=await(0,i.g)(),s=new n,c=new Audio;let l,d=0,u=null;const f=t=>{a(t),s.stopLoad(),s.destroy()};return s.on(n.Events.MANIFEST_PARSED,((t,e)=>{const o=e.levels[0]?.details;o&&(l=o.totalduration)})),s.on(n.Events.BUFFER_APPENDING,((t,e)=>{u=e.data})),s.on(n.Events.FRAG_BUFFERED,((t,e)=>{if(u)return s.detachMedia(),void((t,e)=>{const a=Math.min(32*Math.round(t/4096/e),320);o({bitrate:a,size:t,duration:e})})(u.length/e.frag.duration*l,l)})),s.on(n.Events.ERROR,((t,e)=>{if(!["bufferFullError","fragLoadError"].includes(e.details))return e.type==n.ErrorTypes.MEDIA_ERROR&&d<2?(++d>1&&s.swapAudioCodec(),void s.recoverMediaError()):void f(t);f(t)})),s.loadSource(t),s.attachMedia(c),await e})({url:(0,n.audioUnmaskSource)(e.url)});d(o)},l.push(f),u(),await o}},54869:(t,e,o)=>{o.d(e,{A:()=>i});var a=o(96058),n=o(36843),r=o(43883);const i=async t=>{const e=[t.owner_id,t.id];t.access_key?e.push(t.access_key):t.accessKey&&e.push(t.accessKey);const i=await(0,r.A)(),s=await i.api("audio.getById",{audios:e.join("_"),v:"5.204"}),{audioUnmaskSource:c}=await Promise.resolve().then(o.bind(o,5932));for(const t of s)if(t?.url)return t.url=c(t.url),t;const l=t.hashes?.split("/");let d="",u="";l?(d=l[2],u=l[5]):(d=t.actionHash||"",u=t.urlHash||"");const f=await(0,a.A)(),[w]=await f.promisifiedPost("al_audio.php",{act:"reload_audio",ids:[t.owner_id,t.id,d,u].join("_"),al:1}),h=(await(0,n.A)()).audioTupleToAudioObject(w[0]);return h.url=c(h.url),h}},49423:(t,e,o)=>{o.d(e,{A:()=>d});var a=o(14943),n=o(95684),r=o(96540),i=o(74225),s=o.n(i),c=o(5622);const l=()=>{const t=window.colorScheme?.currentMode;return"auto"===t?window.colorScheme.currentIsDark?"dark":"light":t},d=()=>{const[t,e]=(0,r.useState)(l()),[o,i]=(0,r.useState)(!!window.colorScheme?.subscribe);return s()((async t=>{await(0,c.A)(),t()&&i(!0)}),[]),(0,r.useEffect)((()=>{if(window.colorScheme?.subscribe)return window.colorScheme.subscribe((async()=>{await(0,n.A)(),await(0,a.A)(),e(l())}));i(!1)}),[o]),t}},87675:(t,e,o)=>{o.a(t,(async(t,a)=>{try{o.d(e,{A:()=>r});var n=o(93819);const t=await n.A,r=()=>t;a()}catch(t){a(t)}}),1)},43027:(t,e,o)=>{o.d(e,{A:()=>a});const a=t=>{t.preventDefault?.(),t.stopPropagation?.(),t.stopImmediatePropagation?.()}},40961:(t,e,o)=>{!function t(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(t){console.error(t)}}(),t.exports=o(22551)},74225:(t,e,o)=>{var a=o(96540);function n(t,e,o){var n="function"==typeof e;a.useEffect((function(){var o,a=!0,r=t((function(){return a}));return Promise.resolve(r).then((function(t){o=t})),function(){a=!1,n&&e(o)}}),n?o:e)}t.exports=n,t.exports.useAsyncEffect=n},5932:(t,e,o)=>{o.d(e,{audioUnmaskSource:()=>a});const a=t=>{const e={v:t=>t.split("").reverse().join(""),r:(t,e)=>{t=t.split("");for(let a,n=o+o,r=t.length;r--;)~(a=n.indexOf(t[r]))&&(t[r]=n.substr(a-e,1));return t.join("")},s:(t,e)=>{const o=t.length;if(o){let a=function(t,e){const o=t.length,a=[];if(o){let t=o;for(e=Math.abs(e);t--;)e=(o*(t+1)^e+t)%o,a[t]=e}return a}(t,e),n=0;for(t=t.split("");++n<o;)t[n]=t.splice(a[o-1-n],1,t[n])[0];t=t.join("")}return t},i:(t,o)=>e.s(t,o^vk.id),x:(t,e)=>{const o=[];return e=e.charCodeAt(0),each(t.split(""),((t,a)=>{o.push(String.fromCharCode(a.charCodeAt(0)^e))})),o.join("")}},o="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMN0PQRSTUVWXYZO123456789+/=",a=t=>{if(!t||t.length%4==1)return!1;for(var e,a,n=0,r=0,i="";a=t.charAt(r++);)~(a=o.indexOf(a))&&(e=n%4?64*e+a:a,n++%4)&&(i+=String.fromCharCode(255&e>>(-2*n&6)));return i};if((!window.wbopen||!~(window.open+"").indexOf("wbopen"))&&~t.indexOf("audio_api_unavailable")){let o=t.split("?extra=")[1].split("#"),s=""===o[1]?"":a(o[1]);if(o=a(o[0]),"string"!=typeof s||!o)return t;for(var n,r,i=(s=s?s.split(String.fromCharCode(9)):[]).length;i--;){if(n=(r=s[i].split(String.fromCharCode(11))).splice(0,1,o)[0],!e[n])return t;o=e[n].apply(null,r)}if(o&&"http"===o.substr(0,4))return o}return t}}}]);