"use strict";(globalThis.webpackChunkvknext=globalThis.webpackChunkvknext||[]).push([[6474],{56022:(e,t,n)=>{n.d(t,{T:()=>r});var r=(0,n(33610).mT)("Icon28TelegramOutline","telegram_outline_28","0 0 28 28",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 28 28" id="telegram_outline_28"><path fill="currentColor" d="M23.525 5.92c-1.52.62-3.082 1.247-4.659 1.88-4.885 1.963-9.905 3.979-14.185 5.965l-.037.017-.038.014c-.15.054-.275.106-.377.152l3.06.93c.714.211 1.221.189 1.52.136a1.603 1.603 0 0 0 .351-.1L17.09 9.6c.728-.489 1.302-.805 1.747-.956.214-.073.494-.142.787-.105.354.044.729.25.903.667.136.327.082.637.04.8a2.248 2.248 0 0 1-.207.51c-.16.293-.385.59-.618.82l-.008.007-6 5.641-.014.013c-.152.131-.199.217-.21.244l-.002.003c.004.008.01.022.024.041a.71.71 0 0 0 .124.133l.01.008c.658.572 1.972 1.48 3.2 2.295.603.4 1.17.77 1.602 1.049.07.044.137.088.201.13.313.201.56.36.633.415l.011.008.012.01c.085.067.479.338.96.56.525.242.919.315 1.11.273.106-.024.21-.101.308-.32a1.492 1.492 0 0 0 .11-.394l.003-.022 1.37-8.844c.2-1.499.429-2.939.613-4.095v-.003c.19-1.187.322-2.015.347-2.358v-.008l.002-.007c.013-.15.004-.24-.006-.288a1.36 1.36 0 0 0-.425.037 2.027 2.027 0 0 0-.192.056ZM9.64 15.695l.488.773-.001.001-.002.001-.005.003-.01.006a1.56 1.56 0 0 1-.09.05 3.462 3.462 0 0 1-.888.282c-.583.101-1.383.107-2.376-.187l-.006-.002-3.816-1.159-.103-.063.49-.773-.49.772H2.83l-.003-.002-.004-.002-.01-.007a1.291 1.291 0 0 1-.106-.074 2.059 2.059 0 0 1-.222-.194c-.15-.151-.4-.45-.468-.88-.078-.495.114-.96.483-1.324.33-.326.813-.59 1.432-.816 4.32-2.004 9.393-4.04 14.275-6.002a984.84 984.84 0 0 0 4.63-1.868l.008-.003.009-.004.334.85-.334-.85h.003l.004-.002.01-.004.029-.01a3.89 3.89 0 0 1 .395-.114 3.2 3.2 0 0 1 .977-.083c.384.033.894.171 1.276.614.383.444.493 1.027.44 1.645-.032.425-.171 1.295-.34 2.345l-.025.162c-.185 1.16-.411 2.583-.609 4.06v.009l-1.365 8.811a2.502 2.502 0 0 1-.047.278c-.035.167-.099.4-.21.648-.215.483-.68 1.164-1.597 1.365-.835.183-1.722-.138-2.292-.401a7.558 7.558 0 0 1-1.312-.773c-.013-.01-.072-.048-.202-.132l-.318-.206-.214-.139c-.434-.28-1.009-.654-1.622-1.06-1.205-.8-2.62-1.772-3.385-2.436-.27-.23-.67-.66-.769-1.276-.112-.695.196-1.348.808-1.883l2.787-2.62-5.132 3.438-.015.009-.49-.773Z" /></symbol>',28,28,!1,void 0)},95075:(e,t,n)=>{n.d(t,{A:()=>d});var r=n(22440),a=n(82050),s=n(2519);const c=(e,t)=>{switch(e){case"csv":case"dat":case"ecsv":case"ods":case"tsv":case"xar":case"xl":case"xlr":case"xls":case"xlsb":case"xlsm":case"xlsx":case"xlt":case"xltm":case"xltx":case"xlw":return"spreadsheet";case"ppt":case"ppta":case"pptm":case"pptx":return"default";default:switch(t){case 1:return"text";case 2:return"archive";case 3:return"gif";case 4:return"image";case 5:return"audio";case 6:return"video";case 7:return"ebook";default:return"default"}}};const o=function(e){if(!e.url)return;const t=e.preview?.photo?.sizes,n=!!t&&t.length>0,r=n?new Map:void 0;if(n&&r)for(const{type:e,src:n,width:a,height:s}of t)r.set(e,{url:n,width:a,height:s});const a={kind:"Doc",id:e.id,ownerId:e.owner_id,title:e.title||"image.png",size:e.size||0,ext:e.ext||"png",date:e.date||0,url:e.url||"",isUnsafe:Boolean(e.is_unsafe),type:c(e.ext,e.type)};return r&&(a.image=r),a};var i=n(44497);const l=(0,r.A)(),d=async(e,t=(0,i.A)())=>{const n=o(e);if(!n)return;const r=`${n.ownerId}_${n.id}`,c=(()=>{if(!l.vkmeIntegration)return!1;const e=l.cur.lastAddMedia?.menu;return!e?.menuNode||!e.menuNode.closest(".reply_box")})();if(l.cur.lastAddMedia&&!c){const e=l.cur.lastAddMedia.onChange;try{if(l.cur.lastAddMedia.onChange=async function(...t){const n=t[0];if(l.cur.lastAddMedia.onChange=e,e&&Reflect.apply(e,this,t),"doc"!==n)return;const r=(()=>{const e=l.cur.lastAddMedia.menu?.menuNode?.closest(".reply_box,.im-chat-input")||document.body,t=`._im_text_wrap .im-send-btn, #reply_button${l.cur.editing}, #reply_button${l.cur.oid}_${l.cur.pid}, .reply_send_button`;return e.querySelector(t)})();r?.onclick?(await(0,a.A)(200),r.onclick()):r?.click()},l.cur.chooseMedia("doc",r,{}),!c)return}catch(e){console.error(e)}}(await(0,s.A)()).store.dispatch({peerId:t,type:"UserChangedComposerDraft",kind:"addAttaches",attaches:{docs:[n]}}),await(0,a.A)(200);const d=document.querySelector(".Composer__button.Composer__button--submit,.ConvoComposer__button.ConvoComposer__sendButton--submit");d&&d.click()}},67078:(e,t,n)=>{n.d(t,{A:()=>o});var r=n(74848),a=n(3068),s=n(75511);const c=document.createElement("div");c.className=s.A.Snackbars;const o=async e=>{const t=(await Promise.all([n.e(2551),n.e(7983),n.e(2020),n.e(3543),n.e(7759)]).then(n.bind(n,28582))).default;document.body.contains(c)||document.body.appendChild(c);const s=document.createElement("div");c.appendChild(s);const{unmount:o}=await(0,a.A)({root:s,content:(0,r.jsx)(t,{onClose:()=>{o(),s.remove(),0===c.children.length&&c.remove()},...e}),disableParentTransformForPositionFixedElements:!0,noStyling:!0})}},76474:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Z});var r=n(74848),a=n(62353),s=n(75623),c=n(82050),o=n(56022),i=n(39107),l=n(96540),d=n(74225),u=n.n(d),m=n(94249);const h="shK_c6LSD7bImstc",p="xEwyA0XkkWpKIhiH",x="hEG0Mok3nZHeTBGZ",g="sbPegwabb70ufV75",f=({imageUrl:e,isActive:t,...n})=>(0,r.jsx)("div",{className:h,...n,children:(0,r.jsx)("div",{className:(0,i.xWm)(p,t&&x),children:(0,r.jsx)("img",{className:g,src:e})})});var v=n(84144);const w="lFWeTd5o7V191iG_",y={wide:"DZSDKZccPFYffqjH",compact:"tjZATcq4hOAjqjwY",regular:"IOCpolW00G3r1UOK",adaptive:"mDuxk8WZdpYGX4OV"},b=({variant:e,title:t,className:n})=>(n=(0,i.xWm)(w,y[e],n),t?(0,r.jsx)("div",{className:n,children:(0,r.jsx)(i.LEX,{weight:"3",useAccentWeight:!0,children:t})}):(0,r.jsx)("div",{className:n,children:(0,r.jsx)(i.LEX,{children:(0,r.jsx)(i.EAD,{width:128,colorFrom:"var(--vkui--color_transparent--active)",noAnimation:!0})})})),j="FD2Bt8I32TsHZ5VL",k=({children:e,className:t,...n})=>(0,r.jsx)("div",{className:(0,i.xWm)(j,t),...n,children:e}),A="JFtFC6nG5yDTOoiJ",C="UQTD0zCy6M7V84R2",S=({url:e,onClick:t,className:n,onLoadImage:a})=>{const s=(0,l.useRef)(null);return(0,r.jsx)("div",{onClick:t,className:(0,i.xWm)(A,!e&&C,n),children:e&&(0,r.jsx)("img",{loading:"lazy",src:e,ref:s,onLoad:()=>{a&&a(s.current)}})})};var _=n(97992);const N="rM1CgcXeoG4SjDkw",T="s9EO8flADKs57zdO",W="MVlSQr1fCQuhApzi",E="KxGIItND2XVcjQs4",R="L1j7UmXGhgmZGnUZ",I="SOEpJhOWXdUpa2yV",D=({pack:e,getRootRef:t,onStickerClick:n})=>{const a=(0,l.useMemo)((()=>(0,_.A)(e.stickers,4)),[e]);return(0,r.jsxs)("div",{ref:t,children:[(0,r.jsx)(b,{variant:"regular",title:e.title}),(0,r.jsx)("div",{className:I,children:a.map(((e,t)=>(0,r.jsx)(k,{children:e.map((e=>(0,r.jsx)(S,{url:"data:image/webp;base64,"+e.data,onClick:()=>n(e)},e.file_id)))},t)))})]})};D.Skeleton=()=>{const e=new Array(5).fill(null).map((()=>new Array(3).fill(null)));return(0,r.jsxs)("div",{children:[(0,r.jsx)(b,{variant:"regular"}),(0,r.jsx)("div",{className:I,children:e.map(((e,t)=>(0,r.jsx)(k,{children:e.map(((e,t)=>(0,r.jsx)(S,{},`skeleton-${t}`)))},`row-${t}`)))})]})};const F=D,P=({onStickerClick:e})=>{const[t,n]=(0,l.useState)(null),a=(0,l.useRef)({});u()((async e=>{const t=await v.default.getPacks();e()&&n(t)}),[]);const s=t&&t.length>1;return(0,r.jsxs)("div",{className:(0,i.xWm)(N,s&&W),children:[(0,r.jsx)(m.Z,{style:{height:s?"calc(var(--viewer-height) - 51px)":"var(--viewer-height)",width:"var(--viewer-width)"},children:(0,r.jsx)("div",{className:T,children:t?t.map((t=>(0,r.jsx)(F,{onStickerClick:e,getRootRef:e=>{a.current[t.name]=e},pack:t},t.name))):(0,r.jsx)(F.Skeleton,{})})}),s&&(0,r.jsx)(i.ox2,{className:E,scrollOnAnyWheel:!0,showArrows:!0,children:(0,r.jsx)("div",{className:R,children:t.map((e=>(0,r.jsx)(f,{imageUrl:`data:image/webp;base64,${e.thumb||e.stickers[0]?.data}`,onClick:()=>{return t=e.name,void a.current[t]?.scrollIntoView({behavior:"smooth",block:"start"});var t}},e.name)))})})]})};var V=n(95075),M=n(93819),O=n(67078),U=n(44497);const B=async e=>{const t=document.createElement("canvas");t.height=512,t.width=512;const n=t.getContext("2d"),r=new Image;return((e,t)=>{const n=e.split(","),r=n[0].match(/:(.*?);/)[1],a=atob(n[1]);let s=a.length;const c=new Uint8Array(s);for(;s;)c[s-1]=a.charCodeAt(s-1),s-=1;return new File([c],t,{type:r})})(await new Promise((a=>{r.onload=()=>{n&&n.drawImage(r,0,0),a(t.toDataURL("image/png")),t.remove()},document.documentElement.append(t),r.src=e})),"sticker.png")},L=async e=>{const t=await M.A;try{const r=await B(e),a=new FormData;a.append("file",r,r.name);const s=(await n.e(2893).then(n.bind(n,12893))).default,{upload_url:c}=await s.docs.getMessagesUploadServer({type:"graffiti",peer_id:window.cur?.peer||(0,U.A)()}),o=await fetch(c,{method:"POST",body:a}).then((e=>e.text()));if(o.includes("error"))throw await(0,O.A)({type:"error",text:`${t.use("global_error")}: ${o}`}),new Error(JSON.parse(o).error);const i=await s.docs.save(JSON.parse(o)),l=i[i.type];await(0,V.A)(l)}catch(e){throw console.error(e),await(0,O.A)({type:"error",text:`${t.use("global_error")}: ${e.message}`}),e}},Z=({isReply:e})=>{const[t,n]=(0,l.useState)(!1),[d,u]=(0,l.useState)(null);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.A,{shown:t,onShownChange:n,trigger:"hover",disableCloseOnEscKey:!0,hideWhenReferenceHidden:!0,content:(0,r.jsx)(P,{onStickerClick:async e=>{n(!1),u((0,r.jsx)(i.WHT,{}));try{await L(`data:image/webp;base64,${e.data}`),u((0,r.jsx)(i.WHT,{state:"done"}))}catch(e){console.error(e),u((0,r.jsx)(i.WHT,{state:"error"}))}await(0,c.A)(1e3),u(null)}}),placement:"top",children:e?(0,r.jsx)(o.T,{width:20,height:20}):(0,r.jsx)(a.A,{icon:o.T})}),d]})}},44497:(e,t,n)=>{n.d(t,{A:()=>r});const r=()=>{const e=window.location.pathname.match(/\/convo\/(-?\d+)/);if(e)return Number(e[1])||0;const t=new URLSearchParams(window.location.search),n=Number(t.get("sel"));return n||0}},62353:(e,t,n)=>{n.d(t,{A:()=>c});var r=n(74848);const a="AVY0jdkXtVbJ02Rd",s="lPnlEF1aJomtaWvb",c=({icon:e,getRootRef:t,...n})=>(0,r.jsx)("div",{className:a,ref:t,...n,children:(0,r.jsx)("i",{role:"img",className:s,children:(0,r.jsx)(e,{width:24,height:24})})})},75623:(e,t,n)=>{n.d(t,{A:()=>o});var r=n(74848),a=n(39107),s=n(96540),c=n(61166);const o=({hideOnClick:e=!1,noBackground:t=!1,mode:n,onClick:o,onShownChange:i,className:l,contentWrapperClassName:d,shown:u,content:m,...h})=>{const[p,x]=(0,s.useState)(!1),g=(0,s.useRef)(null),f=(0,s.useRef)(null),v=(0,s.useCallback)((e=>{e?x(!0):g.current=setTimeout((()=>{x(!1)}),100),i?.(e)}),[n,i,x]);return(0,s.useEffect)((()=>{"boolean"==typeof u&&v(u)}),[u,v]),(0,r.jsx)(a.AMh,{shown:p,className:(0,a.xWm)(c.A.PopoverReforged,t&&c.A["PopoverReforged--noBackground"],l),onShownChange:v,onClick:e=>{if("side"===n&&g.current)clearTimeout(g.current);else try{o?.(e)}catch(e){console.error(e)}},content:(0,r.jsx)("div",{ref:f,className:(0,a.xWm)(d),onClick:t=>{e&&f.current?.contains(t.target)&&x(!1)},children:m}),...h})}},94249:(e,t,n)=>{n.d(t,{Z:()=>i});var r=n(74848),a=n(39107),s=n(96540),c=n(62295);const o="Pab4lyLnWDTPLKdr",i=({children:e,height:t=537,style:n={},saveKey:i,isScrollBottom:l,ThumbVerticalClassName:d,...u})=>{const m=(0,s.useRef)(null);return(0,s.useEffect)((()=>{if(!i)return;if(!m.current)return;const e=(e=>{const t=sessionStorage.getItem(e);return t?parseFloat(t):null})(i);e&&m.current.scrollTop(e)}),[i,m]),(0,s.useEffect)((()=>{l&&m.current&&m.current.scrollToBottom()})),(0,r.jsx)(c.ur,{ref:m,style:{height:t,...n},renderThumbVertical:e=>{var t,n;return i&&m.current&&(t=i,n=m.current.getScrollTop(),sessionStorage.setItem(t,n.toString())),(0,r.jsx)("div",{...e,className:(0,a.xWm)(o,d)})},renderTrackHorizontal:()=>(0,r.jsx)("div",{}),...u,children:e})}},97992:(e,t,n)=>{n.d(t,{A:()=>r});const r=(e,t=100)=>{const n=[...e],r=[];for(;n.length;)r.push(n.splice(0,t||n.length));return r}},75511:(e,t,n)=>{n.d(t,{A:()=>r});const r={Snackbars:"fuEF5ymRhcBAxInE",BaseSnackbar:"Fu47p889xWCKEooV"}},61166:(e,t,n)=>{n.d(t,{A:()=>r});const r={PopoverReforged:"V5vFILKwsuTAoDXp","reforged-anim-fade-in":"aKnVnnmt_OsWj600","reforged-anim-fade-out":"uvPWUxQQgpV6cgFC","PopoverReforged--noBackground":"h4DVtB6f3FyJCExI"}},74225:(e,t,n)=>{var r=n(96540);function a(e,t,n){var a="function"==typeof t;r.useEffect((function(){var n,r=!0,s=e((function(){return r}));return Promise.resolve(s).then((function(e){n=e})),function(){r=!1,a&&t(n)}}),a?n:t)}e.exports=a,e.exports.useAsyncEffect=a}}]);