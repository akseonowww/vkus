"use strict";(globalThis.webpackChunkvknext=globalThis.webpackChunkvknext||[]).push([[2893,6289],{51157:(t,e,a)=>{a.d(e,{W:()=>c});var n=a(63898),s=a(98570),o=a(82295);const r=async(t,e,n)=>{const o=await(async()=>{const t=(0,s.A)().browserApi;if(t?.storage)return t.storage;const{storage:e}=await a.e(6815).then(a.t.bind(a,96815,23));return e})(),r=(await o.local.get("tokens"))?.tokens||{};return r[t]={[e]:{token:n},...r[t]},await o.local.set({tokens:r}),n},i=async(t,e,a)=>{const s=await(0,n.A)(((t,e)=>{const a=new URLSearchParams({scope:e.toString(),client_id:t.toString(),redirect_uri:`https://oauth.${o.A}/blank.html`,response_type:"token",display:"mobile",revoke:"1",state:t.toString()});return`https://oauth.${o.A}/authorize?${a}#vknext=1`})(t,e),{method:"GET",credentials:"include"}),i=await s.text();let c="";if(i){const t=i.match(/https.+act=grant_access.+html/);c=t&&t[0]?t[0]:s.url}else c=s.url;if(c){const e=new URL(c);e.searchParams.get("no_session")&&e.searchParams.delete("no_session");const s=e.href,o=await(await(0,n.A)(s,{method:"GET",credentials:"include"})).text(),i=o.match(/access_token=([^&]+)/);if(i)return await r(a,t,i[1]),{access_token:i[1]};{const t=JSON.parse(o);return console.log(s,t),t}}return console.log(s,i),{error:"error",error_description:"unknown error"}},c=t=>i(5776857,501202911,t)},80894:(t,e,a)=>{a.d(e,{API:()=>n.n,TelegramAPI:()=>s.A});var n=a(19575),s=(a(51157),a(64556))},64556:(t,e,a)=>{a.d(e,{A:()=>r});var n=a(99381),s=a(63898);const o=["getMe","getFile","getStickerSet"];const r=class{token;constructor(t){this.token=t;for(const t of o)this[t]=new Proxy(n.A,{get:(e,a)=>e=>this.call(`${t}.${a}`,e),apply:(e,a,n)=>a.call(t,n[0])})}isValidToken(){if(!this.token)return!1;const t=this.token.split(":");return!(2!==t.length||t[0].length<4||35!==t[1].length)}async call(t,e){const a=await(0,s.A)(`https://api.telegram.org/bot${this.token}/${t}`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(e)}),n=await a.json();return n.ok,n}getFileUrl(t){return`https://api.telegram.org/file/bot${this.token}/${t}`}}},12893:(t,e,a)=>{a.r(e),a.d(e,{default:()=>l});var n=a(80894),s=a(36008),o=a(88495),r=a(96289);const i=5776857;let c=null;const l=new n.API({appId:i,getToken:async()=>await(c||(c=new Promise((async t=>{const e=(await(0,o.A)()).id,a=(await r.default.getTokens(e))?.[i]?.token;if(a)return c=null,t(a);const n=r.default.addListener(((a,s)=>{const o=s[e]?.[i]?.token;o&&o!==a?.[e]?.[i]?.token&&(c=null,t(o),n.remove())}));await s.default.sendMessage("vkn-b-gvt",{vk_id:e})})),c)),onErrorValidToken:async()=>{await(async()=>{const t=(await Promise.resolve().then(a.bind(a,96289))).default,e=(await(0,o.A)()).id,n=await t.getStorage();return delete n[e]?.[i],await t.saveStorage(n),!0})()},onError:t=>{console.error("[VK ADMIN ERROR]",t)}})},96289:(t,e,a)=>{a.r(e),a.d(e,{default:()=>o});var n=a(53778);class s extends n.default{constructor(){super("tokens")}async getTokens(t){const e=await this.getStorage();return 0===t?e[0]||{}:e[t]||{}}async setTokens(t,e){const a=await this.getStorage();a[t]=e,await this.saveStorage(a)}}const o=new s},63898:(t,e,a)=>{a.d(e,{A:()=>n});const n=async(t,e)=>await fetch(t,e)}}]);